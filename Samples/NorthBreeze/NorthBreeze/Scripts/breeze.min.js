<<<<<<< HEAD
!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define?define(e):breeze=e()}(function(){function e(e,t){for(var r in e)B(e,r)&&t(r,e[r])}function t(e,t){for(var r in e)if(B(e,r)){var n=e[r];if(t(r,n))return{key:r,value:n}}return null}function r(e,t){var r=[];for(var n in e)if(B(e,n)){var a=t?t(n,e[n]):e[n];void 0!==a&&r.push(a)}return r}function n(e,t){return function(r){return r[e]===t}}function a(e){return function(t){return t[e]}}function i(e){var t=[];for(var r in e)B(e,r)&&t.push(e[r]);return t}function o(e,t){if(!t)return e;for(var r in t)B(t,r)&&(e[r]=t[r]);return e}function s(e,t){for(var r in t)void 0===e[r]&&(e[r]=t[r]);return e}function u(e,t){return t.defaultInstance=s(new t(e),t.defaultInstance),e}function p(e,t){var r={};for(var n in t)if(n in e){var a=e[n],i=t[n];a!=i&&(Array.isArray(a)&&0===a.length||("function"==typeof i?a=i(a):"object"==typeof a&&a&&a.parentEnum&&(a=a.name),void 0!==a&&(r[n]=a)))}return r}function c(e,t){var r={},n=e.length;return t.forEach(function(t){for(var a=0;n>a;a++){var i=e[a];if(i){var o=i[t];if(void 0!==o){r[t]=o;break}}}}),r}function y(e){return e?Array.isArray(e)?e:[e]:[]}function l(e,t){for(var r=0,n=e.length;n>r;r++)if(t(e[r]))return e[r];return null}function f(e,t){for(var r=0,n=e.length;n>r;r++)if(t(e[r]))return r;return-1}function h(e,t,r){for(var n=O(t)?t:void 0,a=e.length-1,i=!1,o=a;o>=0;o--)if((n?n(e[o]):e[o]===t)&&(e.splice(o,1),i=!0,!r))return i;return i}function d(e,t,r){for(var n=[],a=Math.min(e.length,t.length),i=0;a>i;++i)n.push(r(e[i],t[i]));return n}function m(e,t,r){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(Array.isArray(e[n])){if(!m(e[n],t[n]))return!1}else if(r){if(!r(e[n],t[n]))return!1}else if(e[n]!==t[n])return!1;return!0}function v(e,t){var r=e[t];return r||(r=[],e[t]=r),r}function g(e,t){for(var r=e.split(";"),n=0,a=r.length;a>n;n++){var i=E(r[n]);if(i)return i}if(t)throw new Error("Unable to initialize "+e+".  "+t||"")}function E(e){var t;try{if(this.window){var r=this.window;if(t=r[e])return t;if(r.require&&(t=r.require(e)),t)return t}require&&(t=require(e))}catch(n){}return t}function w(e,t,r,n){var a=e[t];if(r===a)return n();e[t]=r;try{return n()}finally{void 0===a?delete e[t]:e[t]=a}}function S(e,t,r){var n;try{return n=e(),r()}catch(a){throw"object"==typeof n&&(n.error=a),a}finally{t(n)}}function _(e){return function(){for(var t=U(arguments),r="",n=t.length,a=null;n--;)a=t[n],r+=a===Object(a)?JSON.stringify(a):a,e.memoize||(e.memoize={});return r in e.memoize?e.memoize[r]:e.memoize[r]=e.apply(this,t)}}function T(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),r="x"==e?t:8|3&t;return r.toString(16)})}function P(e){if("string"!=typeof e)throw new Error("Invalid ISO8601 duration '"+e+"'");var t=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(e);if(!t)throw new Error("Invalid ISO8601 duration '"+e+"'");for(var r=[2,3,4,6,7,8],n=[31104e3,2592e3,86400,3600,60,1],a=0,i=0;6>i;i++){var o=t[r[i]];o=o?+o.replace(/[A-Za-z]+/g,""):0,a+=o*n[i]}return a}function b(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function N(e){return"date"===b(e)&&!isNaN(e.getTime())}function O(e){return"function"===b(e)}function C(e){return"string"==typeof e&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(e)}function A(e){return"string"==typeof e&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(e)}function x(e){if(null===e||void 0===e)return!0;for(var t in e)if(B(e,t))return!1;return!0}function F(e){return!isNaN(parseFloat(e))&&isFinite(e)}function M(e,t){return e&&t?0===e.indexOf(t,0):!1}function D(e,t){return e&&t?-1!==e.indexOf(t,e.length-t.length):!1}function k(e){var t=arguments,r=RegExp("%([1-"+(arguments.length-1)+"])","g");return e.replace(r,function(e,r){return t[r]})}function I(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function V(e,t,r){void 0===t&&(t=null);var n=r(),a=e.dataType;if(a&&a.parse&&(t=Array.isArray(t)&&!e.isScalar?t.map(function(e){return a.parse(e,typeof e)}):a.parse(t,typeof t)),!(t===n||a&&a.isDate&&t&&n&&t.valueOf()===n.valueOf())){var i,o,s,u=this,p=e.name,c=this.entityAspect;c?i=c:(i=this.complexAspect,c=i.getEntityAspect());var y=i.getPropertyPath(p),l=c._inProcess;if(l){if(l.indexOf(e)>=0)return;l.push(e)}else l=[e],c._inProcess=l;var f=c.entity;try{var h=c.entityManager;if(c.entityState.isUnchangedOrModified()&&void 0===i.originalValues[p]&&e.isDataProperty&&!e.isComplexProperty&&(i.originalValues[p]=void 0!==n?n:e.defaultValue),e.isComplexProperty){if(!e.isScalar)throw new Error(k("You cannot set the non-scalar complex property: '%1' on the type: '%2'.Instead get the property and use array functions like 'push' or 'splice' to change its contents.",e.name,e.parentType.name));if(!t)throw new Error(k("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",e.name,e.dataType.name));if(!n){var d=a.getCtor();n=new d,r(n)}a.dataProperties.forEach(function(e){var r=e.name,a=t.getProperty(r);n.setProperty(r,a)})}else if(e.isDataProperty){if(!e.isScalar)throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.");if(e.isPartOfKey&&!this.complexAspect&&h&&!h.isLoading){var m=this.entityType.keyProperties,v=m.map(function(r){return r===e?t:this.getProperty(r.name)},this),g=new st(this.entityType,v);if(h.findEntityByKey(g))throw new Error("An entity with this key is already in the cache: "+g.toString());var E=this.entityAspect.getKey(),w=h._findEntityGroup(this.entityType);w._replaceKey(E,g)}var S=e.relatedNavigationProperty;if(S&&h)null!=t?(o=new st(S.entityType,[t]),s=h.findEntityByKey(o),s?this.setProperty(S.name,s):h._unattachedChildrenMap.addChild(o,S,this)):this.setProperty(S.name,null);else if(e.inverseNavigationProperty&&h&&!h._inKeyFixup){var _=e.inverseNavigationProperty;if(null!=n&&(o=new st(_.parentType,[n]),s=h.findEntityByKey(o)))if(_.isScalar)s.setProperty(_.name,null);else{var T=s.getProperty(_.name);T.splice(T.indexOf(this),1)}null!=t&&(o=new st(_.parentType,[t]),s=h.findEntityByKey(o),s?_.isScalar?s.setProperty(_.name,this):s.getProperty(_.name).push(this):h._unattachedChildrenMap.addChild(o,_,this))}if(r(t),h&&!h.isLoading&&(c.entityState.isUnchanged()&&!e.isUnmapped&&c.setModified(),h.validationOptions.validateOnPropertyChange&&c._validateProperty(t,{entity:f,property:e,propertyName:y,oldValue:n})),e.isPartOfKey&&!this.complexAspect){var P=this.entityType.keyProperties.indexOf(e);this.entityType.navigationProperties.forEach(function(e){var r=e.inverse,n=r?r.foreignKeyNames:e.invForeignKeyNames;if(0!==n.length){var a=u.getProperty(e.name),i=n[P];if(e.isScalar){if(!a)return;a.setProperty(i,t)}else a.forEach(function(e){e.setProperty(i,t)})}}),c.getKey(!0)}}else{if(!e.isScalar)throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");var b=e.inverse;if(null!=t){var N=t.entityAspect;if(h){if(N.entityState.isDetached())h.isLoading||h.attachEntity(t,ut.Added);else if(N.entityManager!==h)throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.")}else N&&N.entityManager&&(h=N.entityManager,h.isLoading||h.attachEntity(c.entity,ut.Added))}if(b)if(b.isScalar)null!=n&&n.setProperty(b.name,null),null!=t&&t.setProperty(b.name,this);else{if(null!=n){var O=n.getProperty(b.name),C=O.indexOf(this);-1!==C&&O.splice(C,1)}if(null!=t){var A=t.getProperty(b.name);A.push(this)}}else if(e.invForeignKeyNames&&h&&!h._inKeyFixup){var x=e.invForeignKeyNames;if(null!=t){var F=this.entityAspect.getKey().values;x.forEach(function(e,r){t.setProperty(e,F[r])})}else null!=n&&x.forEach(function(e){var t=n.entityType.getProperty(e);t.isPartOfKey||n.setProperty(e,null)})}if(r(t),h&&!h.isLoading&&(c.entityState.isUnchanged()&&!e.isUnmapped&&c.setModified(),h.validationOptions.validateOnPropertyChange&&c._validateProperty(t,{entity:this,property:e,propertyName:y,oldValue:n})),e.relatedDataProperties&&!c.entityState.isDeleted()){var M=e.entityType.keyProperties;M.forEach(function(r,n){var a=e.relatedDataProperties[n];if(t||!a.isPartOfKey){var i=t?t.getProperty(r.name):a.defaultValue;u.setProperty(a.name,i)}})}}var D={entity:f,parent:this,property:e,propertyName:y,oldValue:n,newValue:t};h?h.isLoading||h.isRejectingChanges||(c.propertyChanged.publish(D),h.entityChanged.publish({entityAction:at.PropertyChange,entity:f,args:D})):c.propertyChanged.publish(D)}finally{l.pop()}}}function j(e){return e.indexOf(":#")>=0}function K(e,t){return e+":#"+t}function R(e,t,r){if(t)if(Array.isArray(t))t.forEach(e.addProperty.bind(e));else{if("object"!=typeof t)throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");for(var n in t)if(B(t,n)){var a=t[n];a.name=n;var i=new r(a);e.addProperty(i)}}}function q(e,t){var r;if(r=Array.isArray(t)?t:t.split("."),1===r.length)return e.getProperty(t);for(var n=e,a=0;a<r.length&&(n=n.getProperty(r[a]),null!=n);a++);return n}function z(e){return e&&e.isDate?function(e){return e&&e.getTime()}:e===yt.Time?function(e){return e&&P(e)}:function(e){return e}}var L={version:"1.4.2",metadataVersion:"1.0.5"},B=I(Object.prototype.hasOwnProperty),U=I(Array.prototype.slice);Object.create||(Object.create=function(e){var t=function(){};return t.prototype=e,new t});var $={};$.objectForEach=e,$.extend=o,$.propEq=n,$.pluck=a,$.arrayEquals=m,$.arrayFirst=l,$.arrayIndexOf=f,$.arrayRemoveItem=h,$.arrayZip=d,$.requireLib=g,$.using=w,$.memoize=_,$.getUuid=T,$.durationToSeconds=P,$.isDate=N,$.isGuid=C,$.isDuration=A,$.isFunction=O,$.isEmpty=x,$.isNumeric=F,$.stringStartsWith=M,$.stringEndsWith=D,$.formatString=k,$.parent=L,L.core=$;var G=function(){function e(e,t){return null==t?!1:"string"==typeof t&&t.length>0}function t(e,t){return null==t?!1:typeof t===e.typeName?!0:!1}function r(e,t){return null==t?!1:t instanceof e.type}function n(e,t){return null==t?!1:void 0!==t[e.propertyName]}function a(e,t){return null==t?!1:e.enumType.contains(t)}function i(e,t){return e.allowNull?void 0!==t:null!=t}function s(e,t){if(null==t)return!0;var r=e.prevContext;return r?r.fn(r,t):!0}function u(e,t){var r=e.prevContext,n=r?" or it "+y(r,t):"";return"is optional"+n}function p(e,t){if(!Array.isArray(t))return!1;if(e.mustNotBeEmpty&&0===t.length)return!1;var r=e.prevContext;return r?t.every(function(e){return r.fn(r,e)}):!0}function c(e,t){var r=e.mustNotBeEmpty?"a nonEmpty array":"an array",n=e.prevContext,a=n?" where each element "+y(n,t):"";return" must be "+r+a}function y(e,t){var r=e.msg;return"function"==typeof r&&(r=r(e,t)),r}function l(e,t){if(e._context){for(var r=e._context;null!=r.prevContext;)r=r.prevContext;if(null===r.prevContext)return r.prevContext=t,e;if(null!==t.prevContext)throw new Error("Illegal construction - use 'or' to combine checks");t.prevContext=e._context}return f(e,t)}function f(e,t){return e._contexts[e._contexts.length-1]=t,e._context=t,e}function h(e){var t=e._contexts;return null==t[t.length-1]&&t.pop(),0===t.length?void 0:t.some(function(t){return t.fn(t,e.v)})}function d(e,t){throw new Error(k("Error configuring an instance of '%1'. %2",e&&e._$typeName||"object",t))}var m=function(e,t){this.v=e,this.name=t,this._contexts=[null]},v=m.prototype;return v.isObject=function(){return this.isTypeOf("object")},v.isBoolean=function(){return this.isTypeOf("boolean")},v.isString=function(){return this.isTypeOf("string")},v.isNonEmptyString=function(){return l(this,{fn:e,msg:"must be a nonEmpty string"})},v.isNumber=function(){return this.isTypeOf("number")},v.isFunction=function(){return this.isTypeOf("function")},v.isTypeOf=function(e){return l(this,{fn:t,typeName:e,msg:k("must be a '%1'",e)})},v.isInstanceOf=function(e,t){return t=t||e.prototype._$typeName,l(this,{fn:r,type:e,typeName:t,msg:k("must be an instance of '%1'",t)})},v.hasProperty=function(e){return l(this,{fn:n,propertyName:e,msg:k("must have a '%1' property ",e)})},v.isEnumOf=function(e){return l(this,{fn:a,enumType:e,msg:k("must be an instance of the '%1' enumeration",e.name)})},v.isRequired=function(e){return l(this,{fn:i,allowNull:e,msg:"is required"})},v.isOptional=function(){var e={fn:s,prevContext:null,msg:u};return l(this,e)},v.isNonEmptyArray=function(){return this.isArray(!0)},v.isArray=function(e){var t={fn:p,mustNotBeEmpty:e,prevContext:null,msg:c};return l(this,t)},v.or=function(){return this._contexts.push(null),this._context=null,this},v.check=function(e){var t=h(this);if(void 0!==t){if(!t)throw new Error(this.getMessage());return void 0!==this.v?this.v:e}},v._addContext=function(e){return l(this,e)},v.getMessage=function(){var e=this,t=this._contexts.map(function(t){return y(t,e.v)}).join(", or it ");return k(this.MESSAGE_PREFIX,this.name)+" "+t},v.withDefault=function(e){return this.defaultValue=e,this},v.whereParam=function(e){return this.parent.whereParam(e)},v.applyAll=function(e,t,r){var n=e._$typeName;r=r||n&&this.parent.config._$typeName===n;var a=o({},this.parent.config);if(this.parent.params.forEach(function(n){r||delete a[n.name];try{n.check()}catch(i){d(e,i.message)}!t&&n._applyOne(e)}),!r)for(var i in a)void 0!==a[i]&&d(e,k("Unknown property: '%1'.",i))},v._applyOne=function(e){void 0!==this.v?e[this.name]=this.v:void 0!==this.defaultValue&&(e[this.name]=this.defaultValue)},v.MESSAGE_PREFIX="The '%1' parameter ",m}(),Q=function(e,t){return new G(e,t)},J=function(){var e=function(e){if("object"!=typeof e)throw new Error("Configuration parameter should be an object, instead it is a: "+typeof e);this.config=e,this.params=[]},t=e.prototype;return t.whereParam=function(e){var t=new G(this.config[e],e);return t.parent=this,this.params.push(t),t},e}(),H=function(e){return new J(e)};$.Param=G,$.assertParam=Q,$.assertConfig=H;var Z=function(){function e(){}var t=function(t,r){this.name=t;var n=new e(r);n.parentEnum=this,this._symbolPrototype=n,r&&Object.keys(r).forEach(function(e){n[e]=r[e]})},r=t.prototype;return t.isSymbol=function(t){return t instanceof e},r.fromName=function(e){return this[e]},r.addSymbol=function(e){var t=Object.create(this._symbolPrototype);return e&&Object.keys(e).forEach(function(r){t[r]=e[r]}),setTimeout(function(){t.getName()},0),t},r.seal=function(){this.getSymbols().forEach(function(e){return e.getName()})},r.getSymbols=function(){return this.getNames().map(function(e){return this[e]},this)},r.getNames=function(){var e=[];for(var t in this)this.hasOwnProperty(t)&&("name"===t||"_"===t.substr(0,1)||O(this[t])||e.push(t));return e},r.contains=function(t){return t instanceof e?this[t.getName()]===t:!1},e.prototype.getName=function(){if(!this.name){var e=this;this.name=l(this.parentEnum.getNames(),function(t){return e.parentEnum[t]===e})}return this.name},e.prototype.toString=function(){return this.getName()},e.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},t}();$.Enum=Z;var X=function(){function e(e,r,n){var a=e._subscribers;return a?(a.forEach(function(a){try{a.callback(r)}catch(i){i.context="unable to publish on topic: "+e.name,n?n(i):e._defaultErrorCallback?e._defaultErrorCallback(i):t(i)}}),void 0):!0}function t(){}var r={},n=1,a=function(e,t,n){Q(e,"eventName").isNonEmptyString().check(),Q(t,"publisher").isObject().check(),this.name=e,r[e]=!0,this.publisher=t,n&&(this._defaultErrorCallback=n)},i=a.prototype;return i.publish=function(t,r,n){return a._isEnabled(this.name,this.publisher)?(r===!0?setTimeout(e,0,this,t,n):e(this,t,n),!0):!1},i.publishAsync=function(e,t){this.publish(e,!0,t)},i.subscribe=function(e){this._subscribers||(this._subscribers=[]);var t=n;return this._subscribers.push({unsubKey:t,callback:e}),++n,t},i.unsubscribe=function(e){if(!this._subscribers)return!1;var t=this._subscribers,r=f(t,function(t){return t.unsubKey===e});return-1!==r?(t.splice(r,1),0===t.length&&(this._subscribers=null),!0):!1},i.clear=function(){this._subscribers=null},a.bubbleEvent=function(e,t){e._getEventParent=t},a.enable=function(e,t,r){Q(e,"eventName").isNonEmptyString().check(),Q(t,"obj").isObject().check(),Q(r,"isEnabled").isBoolean().isOptional().or().isFunction().check(),t._$eventMap||(t._$eventMap={}),t._$eventMap[e]=r},a.isEnabled=function(e,t){if(Q(e,"eventName").isNonEmptyString().check(),Q(t,"obj").isObject().check(),!t._getEventParent)throw new Error("This object does not support event enabling/disabling");return a._isEnabled(t,e)},a._isEnabled=function(e,t){var r=null,n=t._$eventMap;if(n&&(r=n[e]),null!=r)return"function"==typeof r?r(t):!!r;var i=t._getEventParent&&t._getEventParent();return i?a._isEnabled(e,i):!0},a}();$.Event=X;var W=function(){function e(e,t,r){var n=t.defaultInstance;return n||(n=new t.ctor,t.defaultInstance=n,n._$impl=t),n.initialize(),r&&(e.defaultInstance=n),a.interfaceInitialized.publish({interfaceName:e.name,instance:n,isDefault:!0}),n.checkForRecomposition&&a.interfaceInitialized.subscribe(function(e){n.checkForRecomposition(e)}),n}function n(e){var r=e.toLowerCase(),n=t(a.interfaceRegistry||{},function(e){return e.toLowerCase()===r});if(!n)throw new Error("Unknown interface name: "+e);return n.value}var a={};a.functionRegistry={},a.typeRegistry={},a.objectRegistry={},a.interfaceInitialized=new X("interfaceInitialized",a);var i=function(e){this.name=e,this.defaultInstance=null,this._implMap={}};return i.prototype.registerCtor=function(e,t){this._implMap[e.toLowerCase()]={ctor:t,defaultInstance:null}},i.prototype.getImpl=function(e){return this._implMap[e.toLowerCase()]},i.prototype.getFirstImpl=function(){var e=t(this._implMap,function(){return!0});return e?e.value:null},a.interfaceRegistry={ajax:new i("ajax"),modelLibrary:new i("modelLibrary"),dataService:new i("dataService")},a.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},a.setProperties=function(e){H(e).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(e),e.remoteAccessImplementation&&a.initializeAdapterInstance("dataService",e.remoteAccessImplementation),e.trackingImplementation&&a.initializeAdapterInstance("modelLibrary",e.trackingImplementation),e.ajaxImplementation&&a.initializeAdapterInstance("ajax",e.ajaxImplementation)},a.registerAdapter=function(e,t){Q(e,"interfaceName").isNonEmptyString().check(),Q(t,"adapterCtor").isFunction().check();var r=new t,a=r.name;if(!a)throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");var i=n(e);i.registerCtor(a,t)},a.getAdapter=function(e,t){var r=n(e);if(t){var a=r.getImpl(t);return a?a.ctor:null}return r.defaultInstance?r.defaultInstance._$impl.ctor:null},a.initializeAdapterInstances=function(e){return H(e).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().applyAll(this,!1),r(e,a.initializeAdapterInstance)},a.initializeAdapterInstance=function(t,r,a){a=void 0===a?!0:a,Q(t,"interfaceName").isNonEmptyString().check(),Q(r,"adapterName").isNonEmptyString().check(),Q(a,"isDefault").isBoolean().check();var i=n(t),o=i.getImpl(r);if(!o)throw new Error("Unregistered adapter.  Interface: "+t+" AdapterName: "+r);return e(i,o,a)},a.getAdapterInstance=function(t,r){var a,i=n(t);return r&&""!==r?(a=i.getImpl(r),a?a.defaultInstance:null):i.defaultInstance?i.defaultInstance:(a=i.getFirstImpl(),a.defaultInstance?a.defaultInstance:e(i,a,!0))},a.registerFunction=function(e,t){Q(e,"fn").isFunction().check(),Q(t,"fnName").isString().check(),e.prototype._$fnName=t,a.functionRegistry[t]=e},a._storeObject=function(e,t,r){var n=("string"==typeof t?t:t.prototype._$typeName)+"."+r;a.objectRegistry[n]=e},a._fetchObject=function(e,t){if(!t)return void 0;var r=("string"==typeof e?e:e.prototype._$typeName)+"."+t,n=a.objectRegistry[r];if(!n)throw new Error("Unable to locate a registered object by the name: "+r);return n},a.registerType=function(e,t){Q(e,"ctor").isFunction().check(),Q(t,"typeName").isString().check(),e.prototype._$typeName=t,a.typeRegistry[t]=e},a.stringifyPad="  ",a}(),Y=W.interfaceRegistry.modelLibrary;$.config=W,L.config=W;var et=function(){function e(e){var t=e.getEntityAspect();t.entityState.isUnchanged()&&t.setModified(),t.entityState.isModified()&&!e._origValues&&(e._origValues=e.slice(0))}function t(e,t){e._processAdds(t),n(e,"arrayChanged",{array:e,added:t})}function r(e,t){e._processRemoves(t),n(e,"arrayChanged",{array:e,removed:t})}function n(e,t,r){var n=e._getPendingPubs();n?e._pendingArgs?a(e._pendingArgs,r):(e._pendingArgs=r,n.push(function(){e[t].publish(e._pendingArgs),e._pendingArgs=null})):e[t].publish(r)}function a(e,t){for(var r in t)if("array"!==r&&e.hasOwnProperty(r)){var n=t[r],a=e[r];if(a){if(!Array.isArray(a))throw new Error("Cannot combine non array args");Array.prototype.push.apply(a,n)}else e[r]=n}}function i(e,t,r){e.parent=t,e.parentProperty=r}var o={};return o.push=function(){if(this._inProgress)return-1;var e=this._getGoodAdds(U(arguments));if(!e.length)return this.length;this._beforeChange();var r=Array.prototype.push.apply(this,e);return t(this,e),r},o._push=function(){if(this._inProgress)return-1;var e=U(arguments);this._beforeChange();var r=Array.prototype.push.apply(this,e);return t(this,e),r},o.unshift=function(){var e=this._getGoodAdds(U(arguments));if(!e.length)return this.length;this._beforeChange();var r=Array.prototype.unshift.apply(this,e);return t(this,U(e)),r},o.pop=function(){this._beforeChange();var e=Array.prototype.pop.apply(this);return r(this,[e]),e},o.shift=function(){this._beforeChange();var e=Array.prototype.shift.apply(this);return r(this,[e]),e},o.splice=function(){var e=this._getGoodAdds(U(arguments,2)),n=U(arguments,0,2).concat(e);this._beforeChange();var a=Array.prototype.splice.apply(this,n);return r(this,a),e.length&&t(this,e),a},o.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()},o._getEventParent=function(){return this.getEntityAspect()},o._getPendingPubs=function(){var e=this.getEntityAspect().entityManager;return e&&e._pendingPubs},o._beforeChange=function(){},{mixin:o,publish:n,updateEntityState:e,initializeParent:i}}(),tt=function(){function t(e,t,r,n,a){for(n=+e[t=e.length-1],a=0;t--;)r=+e[t],n+=++a%2?2*r%10+(r>4):r;return!(n%10)}function r(e,t,r,n){r&&(f.messageTemplates[e]=r);var a="string"==typeof t?new RegExp(t):t,i=function(e){return null==e||""===e?!0:"string"!=typeof e?!1:a.test(e)};return new f(e,i,n)}function n(e,t,r){return t?e.replace(/%([^%]+)%/g,function(e,n){var a;return a=r?t.hasOwnProperty(n)?t[n]:"":t[n],a?O(a)?a(t):a:""}):e}function a(e,t,r,n){return f.messageTemplates[e]=k("'%displayName%' must be an integer between the values of %1 and %2",t,r),function(){var a=function(e,n){return null==e?!0:("string"==typeof e&&n&&n.allowString&&(e=parseInt(e,0)),"number"!=typeof e||isNaN(e)||Math.floor(e)!==e?!1:null!=t&&t>e?!1:null!=r&&e>r?!1:!0)};return new f(e,a,n)}}var i=-32768,s=32767,u=-2147483648,p=2147483647,c=0,y=255,l={displayName:function(e){return e.property?e.property.displayName||e.propertyName||e.property.name:"Value"}},f=function(e,t,r){this._baseContext=r||{},this._baseContext.name=e,r=o(Object.create(l),this._baseContext),r.messageTemplate=r.messageTemplate||f.messageTemplates[e],this.name=e,this.valFn=t,this.context=r},h=f.prototype;return h._$typeName="Validator",h.validate=function(e,t){var r;r=t?o(Object.create(this.context),t):this.context,this.currentContext=r;try{return this.valFn(e,r)?null:(r.value=e,new rt(this,r,this.getMessage()))}catch(n){return new rt(this,r,"Exception occured while executing this validator: "+this.name)}},h.getMessage=function(){try{var e=this.currentContext,t=e.message;return t?"function"==typeof t?t(e):t:e.messageTemplate?n(e.messageTemplate,e):"invalid value: "+this.name||"{unnamed validator}"}catch(r){return"Unable to format error message"+r.toString()}},h.toJSON=function(){return this._baseContext},f.fromJSON=function(e){var t="Validator."+e.name,r=W.functionRegistry[t];if(!r)throw new Error("Unable to locate a validator named:"+e.name);return r(e)},f.register=function(e){W.registerFunction(function(){return e},"Validator."+e.name)},f.registerFactory=function(e,t){W.registerFunction(e,"Validator."+t)},f.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"},f.required=function(){var e=function(e,t){return"string"==typeof e?t&&t.allowEmptyStrings?!0:e.length>0:null!=e};return new f("required",e)},f.maxLength=function(e){var t=function(e,t){return null==e?!0:"string"!=typeof e?!1:e.length<=t.maxLength};return new f("maxLength",t,e)},f.stringLength=function(e){var t=function(e,t){return null==e?!0:"string"!=typeof e?!1:null!=t.minLength&&e.length<t.minLength?!1:null!=t.maxLength&&e.length>t.maxLength?!1:!0};return new f("stringLength",t,e)},f.string=function(){var e=function(e){return null==e?!0:"string"==typeof e};return new f("string",e)},f.guid=function(){var e=function(e){return null==e?!0:C(e)};return new f("guid",e)},f.duration=function(){var e=function(e){return null==e?!0:A(e)};return new f("duration",e)},f.number=f.double=f.single=function(e){var t=function(e,t){return null==e?!0:("string"==typeof e&&t&&t.allowString&&(e=parseInt(e,10)),"number"==typeof e&&!isNaN(e))};return new f("number",t,e)},f.integer=f.int64=function(e){var t=function(e,t){return null==e?!0:("string"==typeof e&&t&&t.allowString&&(e=parseInt(e,10)),"number"==typeof e&&!isNaN(e)&&Math.floor(e)===e)};return new f("integer",t,e)},f.int32=function(e){return a("int32",u,p,e)()},f.int16=function(e){return a("int16",i,s,e)()},f.byte=function(e){return a("byte",c,y,e)()},f.bool=function(){var e=function(e){return null==e?!0:e===!0||e===!1};return new f("bool",e)},f.none=function(){var e=function(){return!0};return new f("none",e)},f.date=function(){var e=function(e){if(null==e)return!0;if("string"!=typeof e)return N(e);try{return!isNaN(Date.parse(e))}catch(t){return!1}};return new f("date",e)},f.creditCard=function(e){function r(e){return null==e||""===e?!0:"string"!=typeof e?!1:(e=e.replace(/(\-|\s)/g,""),!e||/\D/.test(e)?!1:t(e))}return new f("creditCard",r,e)},f.regularExpression=function(e){function t(e,t){if(null==e||""===e)return!0;if("string"!=typeof e)return!1;try{var r=new RegExp(t.expression)}catch(n){throw new Error("Missing or invalid expression parameter to regExp validator")}return r.test(e)}return new f("regularExpression",t,e)},f.emailAddress=function(e){var t=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/;return r("emailAddress",t,null,e)},f.phone=function(e){var t=/^((\+|(0(\d+)?[-/.\s]?))[1-9]\d{0,2}[-/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-/.\s]?)?(\d+[-/.\s]?)+\d+$/;return r("phone",t,null,e)},f.url=function(e){var t=/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;return r("url",t,null,e)},f.makeRegExpValidator=r,e(f,function(e,t){"function"==typeof t&&"fromJSON"!==e&&"register"!==e&&"registerFactory"!==e&&"makeRegExpValidator"!==e&&W.registerFunction(t,"Validator."+e)}),f}(),rt=function(){var e=function(e,t,r,n){Q(e,"validator").isOptional().isInstanceOf(tt).check(),Q(r,"errorMessage").isNonEmptyString().check(),Q(n,"key").isOptional().isNonEmptyString().check(),this.validator=e;var t=t||{};this.context=t,this.errorMessage=r,this.property=t.property,this.propertyName=t.propertyName||t.property&&t.property.name,this.key=n?n:rt.getKey(e||r,this.propertyName),this.isServerError=!1};return e.getKey=function(e,t){return(e.name||e)+(t?":"+t:"")},e}();L.Validator=tt,L.ValidationError=rt;var nt=function(){function e(e,t){return t&&H(t).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(e),e}var t=function(t){e(this,t)},r=t.prototype;return r._$typeName="ValidationOptions",r.using=function(t){if(!t)return this;var r=new nt(this);return e(r,t),r},r.setAsDefault=function(){return u(this,t)},t.defaultInstance=new t({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),t}();L.ValidationOptions=nt,L.makeComplexArray=function(){function e(e,t){return t.filter(function(t){return t.parent!==e.parent})}function t(e,t){t.forEach(function(t){if(null!=t.parent)throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner");a(t,e)})}function r(e,t){t.forEach(function(t){n(t,e)})}function n(e,t){var r=e.complexAspect;
return r.parent!==t.parent?null:(r.parent=null,r.parentProperty=null,r)}function a(e,t){var r=e.complexAspect;return r.parent===t.parent?null:(r.parent=t.parent,r.parentProperty=t.parentProperty,r)}function i(e,t,r){return et.initializeParent(e,t,r),e.arrayChanged=new X("arrayChanged",e),o(e,et.mixin),o(e,s)}var s={};return s._getGoodAdds=function(t){return e(this,t)},s._beforeChange=function(){et.updateEntityState(this)},s._processAdds=function(e){t(this,e)},s._processRemoves=function(e){r(this,e)},s._rejectChanges=function(){if(this._origValues){var e=this;this.forEach(function(t){n(t,e)}),this.length=0,this._origValues.forEach(function(t){e.push(t)}),Array.prototype.push.apply(this,this._origValues)}},s._acceptChanges=function(){this._origValues=null},i}();var at=function(){var e={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},t=new Z("EntityAction",e);return t.Attach=t.addSymbol({isAttach:!0}),t.AttachOnQuery=t.addSymbol({isAttach:!0}),t.AttachOnImport=t.addSymbol({isAttach:!0}),t.Detach=t.addSymbol({isDetach:!0}),t.MergeOnQuery=t.addSymbol({isModification:!0}),t.MergeOnImport=t.addSymbol({isModification:!0}),t.MergeOnSave=t.addSymbol({isModification:!0}),t.PropertyChange=t.addSymbol({isModification:!0}),t.EntityStateChange=t.addSymbol(),t.AcceptChanges=t.addSymbol(),t.RejectChanges=t.addSymbol({isModification:!0}),t.Clear=t.addSymbol({isDetach:!0}),t.seal(),t}();L.EntityAction=at;var it=function(){function t(e){var r=e.entityAspect||e.complexAspect,n=e.entityType||e.complexType,a=r.originalValues;for(var i in a)e.setProperty(i,a[i]);n.complexProperties.forEach(function(r){var n=e.getProperty(r.name);r.isScalar?t(n):(n._rejectChanges(),n.forEach(function(e){t(e)}))})}function r(e){var t=e.entityAspect||e.complexAspect;t.originalValues={};var n=e.entityType||e.complexType;n.complexProperties.forEach(function(t){var n=e.getProperty(t.name);t.isScalar?r(n):(n._acceptChanges(),n.forEach(function(e){r(e)}))})}function n(e){var t=!0,r=e.entityType||e.complexType,a=e.entityAspect||e.complexAspect,i=e.entityAspect||e.complexAspect.getEntityAspect();return r.getProperties().forEach(function(r){var o=e.getProperty(r.name),s=a.getPropertyPath(r.name);if(r.validators.length>0){var u={entity:i.entity,property:r,propertyName:s};t=i._validateProperty(o,u)&&t}r.isComplexProperty&&r.isScalar&&(t=n(o)&&t)}),r.validators.forEach(function(e){t=u(i,e,a.entity)&&t}),t}function a(e,t){var r=t.isDeleted();r?o(e,!0):w(e.entityAspect.entityManager,"isLoading",!0,function(){o(e,!1)})}function o(e,t){e.entityType.navigationProperties.forEach(function(r){var n=r.inverse;if(n){var a=e.getProperty(r.name);if(r.isScalar){if(a){if(n.isScalar)s(a,n,t);else{var i=a.getProperty(n.name);i.length&&h(i,e)}e.setProperty(r.name,null)}}else a.slice(0).forEach(function(e){n.isScalar&&s(e,n,t)}),a.length=0}})}function s(e,t,r){if(r)e.setProperty(t.name,null);else{e.entityAspect.entityManager;var n=t.foreignKeyNames;if(n)var a=n.map(function(t){return e.getProperty(t)});e.setProperty(t.name,null),n&&n.forEach(function(t,r){e.setProperty(t,a[r])})}}function u(e,t,r,n){var a=t.validate(r,n);if(a)return e._addValidationError(a),!1;var i=rt.getKey(t,n?n.propertyName:null);return e._removeValidationError(i),!0}var p=function(e){if(null===e){var t=it._nullInstance;if(t)return t;it._nullInstance=this}else{if(void 0===e)throw new Error("The EntityAspect ctor requires an entity as its only argument.");if(e.entityAspect)return e.entityAspect}if(!(this instanceof it))return new it(e);if(this.entity=e,this.entityGroup=null,this.entityManager=null,this.entityState=ut.Detached,this.isBeingSaved=!1,this.originalValues={},this.hasValidationErrors=!1,this._validationErrors={},this.validationErrorsChanged=new X("validationErrorsChanged",this),this.propertyChanged=new X("propertyChanged",this),null!=e){e.entityAspect=this;var r=e.entityType;if(!r){var n=e.prototype._$typeName;throw n?new Error("Metadata for this entityType has not yet been resolved: "+n):new Error("This entity is not registered as a valid EntityType")}var a=r.getEntityCtor();Y.getDefaultInstance().startTracking(e,a.prototype)}},c=p.prototype;return X.bubbleEvent(c,function(){return this.entityManager}),c.getKey=function(e){if(e=Q(e,"forceRefresh").isBoolean().isOptional().check(!1),e||!this._entityKey){var t=this.entity.entityType,r=t.keyProperties,n=r.map(function(e){return this.entity.getProperty(e.name)},this);this._entityKey=new st(t,n)}return this._entityKey},c.acceptChanges=function(){var e=this.entityManager;this.entityState.isDeleted()?e.detachEntity(this.entity):this.setUnchanged(),e.entityChanged.publish({entityAction:at.AcceptChanges,entity:this.entity})},c.rejectChanges=function(){var e=this.entity,r=this.entityManager;w(r,"isRejectingChanges",!0,function(){t(e)}),this.entityState.isAdded()?(r.detachEntity(e),r._notifyStateChange(e,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(e),this.setUnchanged(),this.propertyChanged.publish({entity:e,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:at.RejectChanges,entity:e}))},c.getPropertyPath=function(e){return e},c.setUnchanged=function(){r(this.entity),delete this.hasTempKey,this.entityState=ut.Unchanged,this.entityManager._notifyStateChange(this.entity,!1)},c.setModified=function(){this.entityState=ut.Modified,this.entityManager._notifyStateChange(this.entity,!0)},c.setDeleted=function(){var e=this.entityManager,t=this.entity;this.entityState.isAdded()?(e.detachEntity(t),e._notifyStateChange(t,!1)):(this.entityState=ut.Deleted,a(t,ut.Deleted),e._notifyStateChange(t,!0))},c.setDetached=function(){var e=this.entityGroup;if(!e)return!1;var t=this.entity;return e.detachEntity(t),a(t,ut.Detached),this.entityManager.entityChanged.publish({entityAction:at.Detach,entity:t}),this._detach(),!0},c.loadNavigationProperty=function(e,t,r){var n=this.entity,a=n.entityType._checkNavProperty(e),i=Tt.fromEntityNavigation(n,a,t,r);return n.entityAspect.entityManager.executeQuery(i,t,r)},c.validateEntity=function(){var e=!0;return this._processValidationOpAndPublish(function(t){e=n(t.entity)}),e},c.validateProperty=function(e,t){var r=this.getPropertyValue(e);return r&&r.complexAspect?n(r):(t=t||{},t.entity=this.entity,"string"==typeof e?(t.property=this.entity.entityType.getProperty(e,!0),t.propertyName=e):(t.property=e,t.propertyName=e.name),this._validateProperty(r,t))},c.getValidationErrors=function(e){Q(e,"property").isOptional().isEntityProperty().or().isString().check();var t=i(this._validationErrors);if(e){var r="string"==typeof e?e:e.name;t=t.filter(function(e){return e.property.name===r})}return t},c.addValidationError=function(e){Q(e,"validationError").isInstanceOf(rt).check(),this._processValidationOpAndPublish(function(t){t._addValidationError(e)})},c.removeValidationError=function(e){Q(e,"validationErrorOrKey").isString().or().isInstanceOf(rt).or().isInstanceOf(tt).check();var t="string"==typeof e?e:e.key;this._processValidationOpAndPublish(function(e){e._removeValidationError(t)})},c.clearValidationErrors=function(){this._processValidationOpAndPublish(function(t){e(t._validationErrors,function(e,r){r&&(delete t._validationErrors[e],t._pendingValidationResult.removed.push(r))}),t.hasValidationErrors=!x(this._validationErrors)})},c.getParentKey=function(e){var t=e.foreignKeyNames;if(0===t.length)return null;var r=this,n=t.map(function(e){return r.entity.getProperty(e)});return new st(e.entityType,n)},c.getPropertyValue=function(e){Q(e,"property").isString().or().isEntityProperty().check();var t;if("string"==typeof e){var r=e.trim().split("."),n=r.shift();for(t=this.entity,t=t.getProperty(n);r.length>0;)n=r.shift(),t=t.getProperty(n)}else{if(!(e.parentType instanceof dt))throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' parameter instead ");t=this.entity.getProperty(e.name)}return t},c._detach=function(){this.entityGroup=null,this.entityManager=null,this.entityState=ut.Detached,this.originalValues={},this._validationErrors={},this.hasValidationErrors=!1,this.validationErrorsChanged.clear(),this.propertyChanged.clear()},c._validateProperty=function(e,t){var r=!0;return this._processValidationOpAndPublish(function(n){t.property.validators.forEach(function(a){r=u(n,a,e,t)&&r})}),r},c._processValidationOpAndPublish=function(e){if(this._pendingValidationResult)e(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]},e(this),(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&(this.validationErrorsChanged.publish(this._pendingValidationResult),this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult))}finally{this._pendingValidationResult=void 0}},c._addValidationError=function(e){this._validationErrors[e.key]=e,this.hasValidationErrors=!0,this._pendingValidationResult.added.push(e)},c._removeValidationError=function(e){var t=this._validationErrors[e];t&&(delete this._validationErrors[e],this.hasValidationErrors=!x(this._validationErrors),this._pendingValidationResult.removed.push(t))},p}(),ot=function(){var e=function(e,t,r){if(!e)throw new Error("The  ComplexAspect ctor requires an entity as its only argument.");if(e.complexAspect)return e.complexAspect;if(!(this instanceof ot))return new ot(e,t,r);this.complexObject=e,e.complexAspect=this,this.originalValues={},null!=t&&(this.parent=t,this.parentProperty=r);var n=e.complexType;if(!n){var a=e.prototype._$typeName;throw a?new Error("Metadata for this complexType has not yet been resolved: "+a):new Error("This entity is not registered as a valid ComplexType")}var i=n.getCtor();Y.getDefaultInstance().startTracking(e,i.prototype)},t=e.prototype;return t.getEntityAspect=function(){var e=this.parent;if(!e)return new it(null);for(var t=e.entityAspect;e&&!t;)e=e.complexAspect&&e.complexAspect.parent,t=e&&e.entityAspect;return t||new it(null)},t.getPropertyPath=function(e){var t=this.parent;if(!t)return null;var r=t.complexAspect||t.entityAspect;return r.getPropertyPath(this.parentProperty.name+"."+e)},e}();L.EntityAspect=it,L.ComplexAspect=ot;var st=function(){function e(e){return e.join(t)}var t=":::",r=function(t,r){Q(t,"entityType").isInstanceOf(dt).check();var n=t.getSelfAndSubtypes();n.length>1&&(this._subtypes=n.filter(function(e){return e.isAbstract===!1})),Array.isArray(r)||(r=U(arguments,1)),this.entityType=t,t.keyProperties.forEach(function(e,t){e.dataType===yt.Guid&&(r[t]=r[t]&&r[t].toLowerCase())}),this.values=r,this._keyInGroup=e(r)};r._$typeName="EntityKey";var n=r.prototype;return n.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},r.fromJSON=function(e,t){var r=t._getEntityType(e.entityType,!0);return new st(r,e.values)},n.equals=function(e){return e instanceof st?this.entityType===e.entityType&&m(this.values,e.values):!1},n.toString=function(){return this.entityType.name+"-"+this._keyInGroup},r.equals=function(e,t){return e instanceof st?e.equals(t):!1},n._isEmpty=function(){return 0===this.values.join("").length},r.createKeyString=e,r}();L.EntityKey=st;var ut=function(){var e={isUnchanged:function(){return this===t.Unchanged},isAdded:function(){return this===t.Added},isModified:function(){return this===t.Modified},isDeleted:function(){return this===t.Deleted},isDetached:function(){return this===t.Detached},isUnchangedOrModified:function(){return this===t.Unchanged||this===t.Modified},isAddedModifiedOrDeleted:function(){return this===t.Added||this===t.Modified||this===t.Deleted}},t=new Z("EntityState",e);return t.Unchanged=t.addSymbol(),t.Added=t.addSymbol(),t.Modified=t.addSymbol(),t.Deleted=t.addSymbol(),t.Detached=t.addSymbol(),t.seal(),t}();L.EntityState=ut,L.makePrimitiveArray=function(){function e(e,r,n){return et.initializeParent(e,r,n),e.arrayChanged=new X("arrayChanged",e),o(e,et.mixin),o(e,t)}var t={};return t._getGoodAdds=function(e){return e},t._beforeChange=function(){var e=this.getEntityAspect();e.entityState.isUnchanged()&&e.setModified(),e.entityState.isModified()&&!this._origValues&&(this._origValues=this.slice(0))},t._processAdds=function(){},t._processRemoves=function(){},t._rejectChanges=function(){this._origValues&&(this.length=0,Array.prototype.push.apply(this,this._origValues))},t._acceptChanges=function(){this._origValues=null},e}(),L.makeRelationArray=function(){function e(e,t){var r=n(e,t);if(!r.length)return r;var a=e.parentEntity,i=a.entityAspect.entityManager;return i&&!i.isLoading&&r.forEach(function(t){if(t.entityAspect.entityState.isDetached()){e._inProgress=!0;try{i.attachEntity(t,ut.Added)}finally{e._inProgress=!1}}}),r}function t(e,t){var r=e.parentEntity,n=e.navigationProperty,a=e._addsInProcess,i=n.inverse,o=a.length;try{t.forEach(function(e){if(a.push(e),i)e.setProperty(i.name,r);else{var t=r.entityType.keyProperties;n.invForeignKeyNames.forEach(function(n,a){e.setProperty(n,r.getProperty(t[a].name))})}})}finally{a.splice(o,t.length)}}function r(e,t){var r=e.navigationProperty.inverse;r&&t.forEach(function(e){e.setProperty(r.name,null)})}function n(e,t){var r,n=e.parentEntity,a=e.navigationProperty,i=a.inverse;if(i)r=t.filter(function(t){if(e._addsInProcess.indexOf(t)>=0)return!1;var r=t.getProperty(i.name);return r!==n});else{var o=a.invForeignKeyNames,s=n.entityType.keyProperties;r=t.filter(function(t){return e._addsInProcess.indexOf(t)>=0?!1:o.some(function(e,r){var a=s[r].name,i=n.getProperty(a),o=t.getProperty(e);return i!==o})})}return r}function a(e,t,r){return e.parentEntity=t,e.navigationProperty=r,e.arrayChanged=new X("arrayChanged",e),e._addsInProcess=[],o(e,et.mixin),o(e,i)}var i={};return i.load=function(e,t){var r=this.parentEntity,n=Tt.fromEntityNavigation(this.parentEntity,this.navigationProperty),a=r.entityAspect.entityManager;return a.executeQuery(n,e,t)},i._getEventParent=function(){return this.parentEntity.entityAspect},i._getPendingPubs=function(){var e=this.parentEntity.entityAspect.entityManager;return e&&e._pendingPubs},i._getGoodAdds=function(t){return e(this,t)},i._processAdds=function(e){t(this,e)},i._processRemoves=function(e){r(this,e)},a}();var pt=function(){function e(e,t){return t&&(H(t).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(ct).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(e),e.serviceName=e.serviceName&&pt._normalizeServiceName(e.serviceName),e.adapterInstance=e.adapterName&&W.getAdapterInstance("dataService",e.adapterName)),e}var t=function(t){e(this,t)},r=t.prototype;return r._$typeName="DataService",r.using=function(t){if(!t)return this;var r=new pt(this);return e(r,t)},t.resolve=function(e){e.push({hasServerMetadata:!0,useJsonp:!1});var t=new pt(c(e,["serviceName","adapterName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!t.serviceName)throw new Error("Unable to resolve a 'serviceName' for this dataService");return t.adapterInstance=t.adapterInstance||W.getAdapterInstance("dataService",t.adapterName),t.jsonResultsAdapter=t.jsonResultsAdapter||t.adapterInstance.jsonResultsAdapter,t},t._normalizeServiceName=function(e){return e=e.trim(),"/"!==e.substr(-1)?e+"/":e},r.toJSON=function(){return p(this,{serviceName:null,adapterName:null,hasServerMetadata:null,jsonResultsAdapter:function(e){return e&&e.name},useJsonp:null})},t.fromJSON=function(e){return e.jsonResultsAdapter=W._fetchObject(ct,e.jsonResultsAdapter),new pt(e)},r.makeUrl=function(e){var t=this.serviceName;return $.stringEndsWith(t,"/")&&(t=t.substr(0,t.length-1)),e="/"+e,$.stringEndsWith(t,e)||(t+=e),t},t}(),ct=function(){function e(e){return e.results}var t=function(t){if(1!==arguments.length)throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");H(t).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(e).whereParam("visitNode").isFunction().applyAll(this),W._storeObject(this,r._$typeName,this.name)},r=t.prototype;return r._$typeName="JsonResultsAdapter",t}();L.DataService=pt,L.JsonResultsAdapter=ct;var yt=function(){function e(e,t){throw e=k(e,t),new Error(e)}function t(e){switch(e){case P.String:return tt.string;case P.Int64:return tt.int64;case P.Int32:return tt.int32;case P.Int16:return tt.int16;case P.Decimal:return tt.number;case P.Double:return tt.number;case P.Single:return tt.number;case P.DateTime:return tt.date;case P.DateTimeOffset:return tt.date;case P.Boolean:return tt.bool;case P.Guid:return tt.guid;case P.Byte:return tt.byte;case P.Binary:return tt.none;case P.Time:return tt.duration;case P.Undefined:return tt.none}}var r={},n={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1},a=function(){return n.stringPrefix+i().toString()},i=function(){var e=n.nextNumber;return n.nextNumber+=n.nextNumberIncrement,e},o=function(){return T()},s=function(){return new Date},u=function(e){return null==e?e:e.toString()},p=function(e,t){if("string"===t){var r=e.trim();if(""===r)return null;var n=parseInt(r,10);return isNaN(n)?e:n}return"number"===t?Math.round(e):e},c=function(e,t){if("string"===t){var r=e.trim();if(""===r)return null;var n=parseFloat(r);return isNaN(n)?e:n}return e},y=function(e,t){var r;if("string"===t){var n=e.trim();return""===n?null:(r=new Date(Date.parse(n)),N(r)?r:e)}return"number"===t?(r=new Date(e),N(r)?r:e):e},l=function(e,t){if("string"===t){var r=e.trim().toLowerCase();return"false"===r||""===r?!1:"true"===r?!0:e}return e},f=function(e){return null==e?null:"'"+e+"'"},h=function(e){return null==e?null:"string"==typeof e?parseInt(e,10):e},d=function(e){return function(t){return null==t?null:("string"==typeof t&&(t=parseFloat(t)),t+e)}},m=function(t){if(null==t)return null;try{return"datetime'"+t.toISOString()+"'"}catch(r){e("'%1' is not a valid dateTime",t)}},v=function(t){if(null==t)return null;try{return"datetimeoffset'"+t.toISOString()+"'"}catch(r){e("'%1' is not a valid dateTime",t)}},g=function(t){return null==t?null:(A(t)||e("'%1' is not a valid ISO 8601 duration",t),"time'"+t+"'")},E=function(t){return null==t?null:(C(t)||e("'%1' is not a valid guid",t),"guid'"+t+"'")},w=function(e){return null==e?null:"string"==typeof e?"true"===e.trim().toLowerCase():!!e},S=function(e){return null==e?e:"binary'"+e+"'"},_=function(e){return e},P=new Z("DataType",r);P.String=P.addSymbol({defaultValue:"",parse:u,fmtOData:f,getNext:a}),P.Int64=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:p,fmtOData:h,getNext:i}),P.Int32=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:p,fmtOData:h,getNext:i}),P.Int16=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:p,fmtOData:h,getNext:i}),P.Byte=P.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:p,fmtOData:h}),P.Decimal=P.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,parse:c,fmtOData:d("m"),getNext:i}),P.Double=P.addSymbol({defaultValue:0,isNumeric:!0,parse:c,fmtOData:d("d"),getNext:i}),P.Single=P.addSymbol({defaultValue:0,isNumeric:!0,parse:c,fmtOData:d("f"),getNext:i}),P.DateTime=P.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:y,fmtOData:m,getNext:s}),P.DateTimeOffset=P.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:y,fmtOData:v,getNext:s}),P.Time=P.addSymbol({defaultValue:"PT0S",fmtOData:g}),P.Boolean=P.addSymbol({defaultValue:!1,parse:l,fmtOData:w}),P.Guid=P.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",fmtOData:E,getNext:o}),P.Binary=P.addSymbol({defaultValue:null,fmtOData:S}),P.Undefined=P.addSymbol({defaultValue:void 0,fmtOData:_}),P.seal(),P.fromEdmDataType=function(e){var t=null,r=e.split(".");if(r.length>1){var n=r[1];t="image"===n?P.Byte:2===r.length?P.fromName(n)||P.Undefined:P.String}return t},P.fromValue=function(e){if(N(e))return P.DateTime;switch(typeof e){case"string":return C(e)?P.Guid:A(e)&&e.length>3?P.Time:P.String;case"boolean":return P.Boolean;case"number":return P.Int32}return P.Undefined};var b=/.\d{3}$/;return P.parseDateAsUTC=function(e){if("string"==typeof e){var t=b.test(e);e=t?e+"Z":e}return e=new Date(Date.parse(e))},P.parseDateFromServer=P.parseDateAsUTC,P.constants=n,P.getSymbols().forEach(function(e){e.validatorCtor=t(e)}),P}();L.DataType=yt;var lt=g("Q","See https://github.com/kriskowal/q "),ft=function(){function e(e){var t=[];for(var r in e){var n=e[r];r===n.name&&t.push(e[r])}return t}function t(e,t){var r=K(t.shortName,t.namespace),a=e._getEntityType(r,!0);if(a)return a;var i={shortName:t.shortName,namespace:t.namespace,isAbstract:t.isAbstract,autoGeneratedKeyType:Et.fromName(t.autoGeneratedKeyType),defaultResourceName:t.defaultResourceName};if(a=t.isComplexType?new mt(i):new dt(i),t.baseTypeName){a.baseTypeName=t.baseTypeName;var o=e._getEntityType(t.baseTypeName,!0);o?n(e,t,a,o):v(e._deferredTypes,t.baseTypeName).push({json:t,stype:a})}else n(e,t,a,null);return a}function n(e,t,r,a){t.validators&&(r.validators=t.validators.map(tt.fromJSON)),a&&(r.baseEntityType=a,a.dataProperties.forEach(function(e){var t=new vt(e);t.isInherited=!0,r.addProperty(t)}),a.navigationProperties.forEach(function(e){var t=new gt(e);t.isInherited=!0,r.addProperty(t)})),t.dataProperties.forEach(function(e){r.addProperty(vt.fromJSON(e))});var i=!t.isComplexType;i&&t.navigationProperties&&t.navigationProperties.forEach(function(e){r.addProperty(gt.fromJSON(e))}),e.addEntityType(r);var o=e._deferredTypes,s=o[r.name];s&&(s.forEach(function(t){n(e,t.json,t.stype,r)}),delete o[r.name])}function a(e,t,r){if(j(t))return t;var n=e._shortNameMap[t];if(!n&&r)throw new Error("Unable to locate 'entityTypeName' of: "+t);return n}var i=0,s=function(e){e=e||{},H(e).whereParam("namingConvention").isOptional().isInstanceOf(_t).withDefault(_t.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(St).withDefault(St.defaultInstance).applyAll(this),this.dataServices=[],this._resourceEntityTypeMap={},this._structuralTypeMap={},this._shortNameMap={},this._ctorRegistry={},this._incompleteTypeMap={},this._incompleteComplexTypeMap={},this._id=i++},u=s.prototype;return u._$typeName="MetadataStore",s.ANONTYPE_PREFIX="_IB_",u.addDataService=function(e,t){Q(e,"dataService").isInstanceOf(pt).check(),Q(t,"shouldOverwrite").isBoolean().isOptional().check();var r=this._getDataServiceIndex(e.serviceName);if(r>=0){if(!t)throw new Error("A dataService with this name '"+e.serviceName+"' already exists in this MetadataStore");this.dataServices[r]=e}else this.dataServices.push(e)},u._getDataServiceIndex=function(e){return f(this.dataServices,function(t){return t.serviceName===e})},u.addEntityType=function(e){if(e instanceof dt||e instanceof mt||(e=e.isComplexType?new mt(e):new dt(e)),!e.isComplexType&&0===e.keyProperties.length&&!e.isAbstract)throw new Error("Unable to add "+e.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.");if(e.metadataStore=this,e.isAnonymous||(this._structuralTypeMap[e.name]=e,this._shortNameMap[e.shortName]=e.name),e.getProperties().forEach(function(t){e._updateNames(t),t.isUnmapped||e._mappedPropertiesCount++}),e._updateCps(),!e.isComplexType){e._updateNps();var t=e.defaultResourceName||e.baseEntityType&&e.baseEntityType.defaultResourceName;t&&!this.getEntityTypeNameForResourceName(t)&&this.setEntityTypeForResourceName(t,e.name),e.defaultResourceName=t,e.getEntityCtor()}e.baseEntityType&&e.baseEntityType.subtypes.push(e)},u.exportMetadata=function(){var e=JSON.stringify({metadataVersion:L.metadataVersion,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:r(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,W.stringifyPad);return e},u.importMetadata=function(e){this._deferredTypes={};var r="string"==typeof e?JSON.parse(e):e;if(r.schema)return ht.parse(this,r.schema);if(r.metadataVersion&&r.metadataVersion!==L.metadataVersion){var n=k("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",r.metadataVersion,L.metadataVersion);throw new Error(n)}var a=r.namingConvention,i=r.localQueryComparisonOptions;if(this.isEmpty())this.namingConvention=W._fetchObject(_t,a)||this.namingConvention,this.localQueryComparisonOptions=W._fetchObject(St,i)||this.localQueryComparisonOptions;else{if(a&&this.namingConvention.name!==a)throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(i&&this.localQueryComparisonOptions.name!==i)throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore")}var s=this;return r.dataServices&&r.dataServices.forEach(function(e){e=pt.fromJSON(e),s.addDataService(e,!0)}),this._structuralTypeMap,r.structuralTypes.forEach(function(e){t(s,e)}),o(this._resourceEntityTypeMap,r.resourceEntityTypeMap),o(this._incompleteTypeMap,r.incompleteTypeMap),this},s.importMetadata=function(e){var t=new ft;return t.importMetadata(e),t},u.hasMetadataFor=function(e){return!!this.getDataService(e)},u.getDataService=function(e){return Q(e,"serviceName").isString().check(),e=pt._normalizeServiceName(e),l(this.dataServices,function(t){return t.serviceName===e})},u.fetchMetadata=function(e,t,r){if(Q(e,"dataService").isString().or().isInstanceOf(pt).check(),Q(t,"callback").isFunction().isOptional().check(),Q(r,"errorCallback").isFunction().isOptional().check(),"string"==typeof e&&(e=this.getDataService(e)||new pt({serviceName:e})),e=pt.resolve([e]),this.hasMetadataFor(e.serviceName))throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+e.serviceName);return e.adapterInstance.fetchMetadata(this,e).then(function(e){return t&&t(e),lt.resolve(e)}).fail(function(e){return r&&r(e),lt.reject(e)})},u.trackUnmappedType=function(e,t){Q(e,"entityCtor").isFunction().check(),Q(t,"interceptor").isFunction().isOptional().check();var r=new dt(this);r._setCtor(e,t)},u.registerEntityTypeCtor=function(e,t,r){Q(e,"structuralTypeName").isString().check(),Q(t,"aCtor").isFunction().isOptional().check(),Q(r,"initializationFn").isOptional().isFunction().or().isString().check();var n=a(this,e,!1),i=n||e;if(this._ctorRegistry[i]={ctor:t,initFn:r},n){var o=this._structuralTypeMap[n];o&&o.getCtor(!0)}},u.toQueryString=function(e){if(!e)throw new Error("query cannot be empty");if("string"==typeof e)return e;if(e instanceof Tt)return e._toUri(this);throw new Error("unable to recognize query parameter as either a string or an EntityQuery")},u.isEmpty=function(){return x(this._structuralTypeMap)},u.getEntityType=function(e,t){return Q(e,"structuralTypeName").isString().check(),Q(t,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(e,t)},u._getEntityType=function(e,t){var r=a(this,e,!1),n=this._structuralTypeMap[r];if(!n){if(t)return null;var i=k("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",e);throw new Error(i)}if(n.length){var o=n.join(",");throw new Error("There are multiple types with this 'shortName': "+o)}return n},u.getEntityTypes=function(){return e(this._structuralTypeMap)},u.getIncompleteNavigationProperties=function(){return r(this._incompleteTypeMap,function(e,t){return t})},u.getEntityTypeNameForResourceName=function(e){return Q(e,"resourceName").isString().check(),this._resourceEntityTypeMap[e]},u.setEntityTypeForResourceName=function(e,t){Q(e,"resourceName").isString().check(),Q(t,"entityTypeOrName").isInstanceOf(dt).or().isString().check();var r;r=t instanceof dt?t.name:a(this,t,!0),this._resourceEntityTypeMap[e]=r;var n=this._getEntityType(r,!0);n&&!n.defaultResourceName&&(n.defaultResourceName=e)},u._checkEntityType=function(e){if(!e.entityType){var t=e.prototype._$typeName;if(!t)throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");var r=this._getEntityType(t);r&&(e.entityType=r)}},s}(),ht=function(){function e(e,r){e._entityTypeResourceMap={},y(r).forEach(function(r){if(r.cSpaceOSpaceMapping){var a=JSON.parse(r.cSpaceOSpaceMapping),i={};a.forEach(function(e){i[e[0]]=e[1]}),r.cSpaceOSpaceMapping=i}r.entityContainer&&y(r.entityContainer).forEach(function(t){y(t.entitySet).forEach(function(t){var n=d(t.entityType,r).typeName;e.setEntityTypeForResourceName(t.name,n),e._entityTypeResourceMap[n]=t.name})}),r.complexType&&y(r.complexType).forEach(function(t){n(t,r,e)}),r.entityType&&y(r.entityType).forEach(function(n){t(n,r,e)})});var a=e.getIncompleteNavigationProperties();if(a.length>0)throw new Error("Bad nav properties");return e}function t(e,t,n){var a=e.name,i=m(a,t),o=new dt({shortName:a,namespace:i,isAbstract:e.abstract&&"true"===e.abstract});if(e.baseType){var s=d(e.baseType,t).typeName;o.baseTypeName=s;var u=n._getEntityType(s,!0);if(u)r(o,e,t,n,u);else{var p=n._deferredTypes[s];p||(p=[],n._deferredTypes[s]=p),p.push({entityType:o,csdlEntityType:e})}}else r(o,e,t,n,null);return o}function r(e,t,n,o,s){var p=[];s&&(e.baseEntityType=s,e.autoGeneratedKeyType=s.autoGeneratedKeyType,p=s.keyProperties.map(a("name")),s.dataProperties.forEach(function(t){var r=new vt(t);r.isInherited=!0,e.addProperty(r)}),s.navigationProperties.forEach(function(t){var r=new gt(t);r.isInherited=!0,e.addProperty(r)}));var c=t.key?y(t.key.propertyRef).map(a("name")):[];c=p.concat(c),y(t.property).forEach(function(t){i(e,t,n,c)}),y(t.navigationProperty).forEach(function(t){u(e,t,n)}),o.addEntityType(e),e.defaultResourceName=o._entityTypeResourceMap[e.name];var l=o._deferredTypes,f=l[e.name];f&&(f.forEach(function(t){r(t.entityType,t.csdlEntityType,n,o,e)}),delete l[e.name])}function n(e,t,r){var n=e.name,a=m(n,t),o=new mt({shortName:n,namespace:a});return y(e.property).forEach(function(e){i(o,e,t)}),r.addEntityType(o),o}function i(e,t,r,n){var a,i=t.type.split(".");return 2===i.length?a=o(e,t,n):p(t,r)?(a=o(e,t,n),a&&(a.enumType=t.type)):a=s(e,t,r),a&&(e.addProperty(a),c(a)),a}function o(e,t,r){var n=yt.fromEdmDataType(t.type);if(null==n)return e.warnings.push("Unable to recognize DataType for property: "+t.name+" DateType: "+t.type),null;var a="true"===t.nullable||null==t.nullable,i=null!=r&&r.indexOf(t.name)>=0;i&&e.autoGeneratedKeyType===Et.None&&f(t)&&(e.autoGeneratedKeyType=Et.Identity);var o=t.maxLength;o=null==o||"Max"===o?null:parseInt(o,10);var s=new vt({nameOnServer:t.name,dataType:n,isNullable:a,isPartOfKey:i,maxLength:o,concurrencyMode:t.concurrencyMode});return n===yt.Undefined&&(s.rawTypeName=t.type),s}function s(e,t,r){var n=d(t.type,r).typeName,a=new vt({nameOnServer:t.name,complexTypeName:n,isNullable:!1});return a}function u(e,t,r){var n=h(t,r),i=l(n.end,function(e){return e.role===t.toRole}),o="*"!==i.multiplicity,s=d(i.type,r).typeName,u=n.referentialConstraint;if(u){var p,c={nameOnServer:t.name,entityTypeName:s,isScalar:o,associationName:n.name},f=u.principal,m=u.dependent;t.fromRole===f.role?(p=y(f.propertyRef),c.invForeignKeyNamesOnServer=p.map(a("name"))):(p=y(m.propertyRef),c.foreignKeyNamesOnServer=p.map(a("name")));var v=new gt(c);return e.addProperty(v),v}}function p(e,t){if(!t.enumType)return!1;var r=y(t.enumType),n=e.type.split("."),a=n[n.length-1];return r.some(function(e){return e.name===a})}function c(e){var t;if(e.isNullable||e.validators.push(tt.required()),!e.isComplexProperty){if(e.dataType===yt.String)if(e.maxLength){var r={maxLength:e.maxLength};t=tt.maxLength(r)}else t=tt.string();else t=e.dataType.validatorCtor();e.validators.push(t)}}function f(e){var t=l(Object.keys(e),function(e){return e.indexOf("StoreGeneratedPattern")>=0});if(t)return"Identity"===e[t];var r=e.extensions;
if(!r)return!1;var n=l(r,function(e){return"StoreGeneratedPattern"===e.name&&"Identity"===e.value});return!!n}function h(e,t){var r=d(e.relationship,t).shortTypeName,n=t.association;if(!n)return null;Array.isArray(n)||(n=[n]);var a=l(n,function(e){return e.name===r});return a}function d(e,t){if(!e)return null;if(M(e,ft.ANONTYPE_PREFIX))return{shortTypeName:e,namespace:"",typeName:e,isAnonymous:!0};var r=e.split(",")[0],n=r.split(".");if(n.length>1){var a,i=n[n.length-1];if(t)a=m(i,t);else{var o=n.slice(0,n.length-1);a=o.join(".")}return{shortTypeName:i,namespace:a,typeName:K(i,a)}}return{shortTypeName:e,namespace:"",typeName:e}}function m(e,t){var r,n=t.cSpaceOSpaceMapping;if(n){var a=n[t.namespace+"."+e];r=a&&a.substr(0,a.length-(e.length+1))}return r||t.namespace}var v=_(function(e){return e&&d(e).typeName});return{parse:e,normalizeTypeName:v}}(),dt=function(){function t(){return function(){}}function r(e){return e.filter(function(e){return!e.isInherited})}function i(e,t,r){var n=r+"OnServer",a=t[r];if(a&&a.length){if(t.isUnmapped)return;var i=y(a).map(function(r){var n=e.clientPropertyNameToServer(r,t),a=e.serverPropertyNameToClient(n,t);if(r!==a)throw new Error("NamingConvention for this client property name does not roundtrip properly:"+r+"-->"+a);return n});t[n]=Array.isArray(a)?i:i[0]}else{var o=t[n];if(!o||0===o.length)return;var s=y(o).map(function(r){var n=e.serverPropertyNameToClient(r,t),a=e.clientPropertyNameToServer(n,t);if(r!==a)throw new Error("NamingConvention for this server property name does not roundtrip properly:"+r+"-->"+a);return n});t[r]=Array.isArray(o)?s:s[0]}}function o(e,t){var r=t._getEntityType(e.complexTypeName,!0);if(!r)return!1;if(!(r instanceof mt))throw new Error("Unable to resolve ComplexType with the name: "+e.complexTypeName+" for the property: "+property.name);return e.dataType=r,e.defaultValue=null,!0}function s(e,t){var r=t._getEntityType(e.entityTypeName,!0);if(!r)return!1;e.entityType=r;var n=l(r.navigationProperties,function(t){return t.associationName===e.associationName&&(t.name!==e.name||t.entityTypeName!==e.entityTypeName)});return e.inverse=n,n||e.invForeignKeyNames.forEach(function(t){var n=r.getDataProperty(t),a=e.parentType;n.inverseNavigationProperty=l(a.navigationProperties,function(e){return e.invForeignKeyNames&&e.invForeignKeyNames.indexOf(n.name)>=0}),u(r.foreignKeyProperties,n)}),c(e),!0}function u(e,t){var r=e.indexOf(t);-1===r&&e.push(t)}function c(e){var t=e.foreignKeyNames;if(0!==t.length){var r=e.parentType,n=t.map(function(e){return r.getDataProperty(e)}),a=r.foreignKeyProperties;n.forEach(function(t){u(a,t),t.relatedNavigationProperty=e,e.relatedDataProperties?e.relatedDataProperties.push(t):e.relatedDataProperties=[t]})}}function f(e,t){var r=e.getPropertyNames(),n=Y.getDefaultInstance().getTrackablePropertyNames(t);n.forEach(function(t){if(-1===r.indexOf(t)){var n=new vt({name:t,dataType:yt.Undefined,isNullable:!0,isUnmapped:!0});e.subtypes?e.getSelfAndSubtypes().forEach(function(e){e.addProperty(new vt(n))}):e.addProperty(n)}})}var h=0,d=function(e){if(arguments.length>1)throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");"MetadataStore"===e._$typeName?(this.metadataStore=e,this.shortName="Anon_"+ ++h,this.namespace="",this.isAnonymous=!0):H(e).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(Et).isOptional().withDefault(Et.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().applyAll(this),this.name=K(this.shortName,this.namespace),this.dataProperties=[],this.navigationProperties=[],this.complexProperties=[],this.keyProperties=[],this.foreignKeyProperties=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.validators=[],this.warnings=[],this._mappedPropertiesCount=0,this.subtypes=[],R(this,e.dataProperties,vt),R(this,e.navigationProperties,gt)},m=d.prototype;return m._$typeName="EntityType",m.setProperties=function(e){H(e).whereParam("autoGeneratedKeyType").isEnumOf(Et).isOptional().whereParam("defaultResourceName").isString().isOptional().applyAll(this),e.defaultResourceName&&(this.defaultResourceName=e.defaultResourceName)},m.isSubtypeOf=function(e){Q(e,"entityType").isInstanceOf(dt).check();var t=this;do{if(t===e)return!0;t=t.baseEntityType}while(t);return!1},m.getSelfAndSubtypes=function(){var e=[this];return this.subtypes.forEach(function(t){var r=t.getSelfAndSubtypes();e.push.apply(e,r)}),e},m.addProperty=function(e){if(Q(e,"dataProperty").isInstanceOf(vt).or().isInstanceOf(gt).check(),this.metadataStore&&!e.isUnmapped)throw new Error("The '"+this.name+"' EntityType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(e.parentType){if(e.parentType!==this)throw new Error("This dataProperty has already been added to "+e.parentType.name);return this}return e.parentType=this,e.isDataProperty?this._addDataProperty(e):this._addNavigationProperty(e),this},m.createEntity=function(t){var r=this._createInstanceCore();return t&&e(t,function(e,t){r.setProperty(e,t)}),this._initializeInstance(r),r},m._createInstanceCore=function(){var e=this.getEntityCtor(),t=new e;return new it(t),t},m._initializeInstance=function(e){this.baseEntityType&&this.baseEntityType._initializeInstance(e);var t=this.initializationFn;t&&("string"==typeof t&&(t=e[t]),t(e)),e.entityAspect&&(e.entityAspect._initialized=!0)},m.getCtor=m.getEntityCtor=function(e){if(this._ctor&&!e)return this._ctor;var r=this.metadataStore._ctorRegistry,n=r[this.name]||r[this.shortName]||{},a=n.ctor||this._ctor;if(!a){var i=Y.getDefaultInstance().createCtor;a=i?i(this):t()}return this.initializationFn=n.initFn,a.prototype._$typeName=this.name,this._setCtor(a),a},m._setCtor=function(e,t){var r=e.prototype;if(extra=r._$extra||{},r._$extra=extra,!extra.initialized){var n=new e;f(this,n)}"EntityType"===this._$typeName?r.entityType=this:r.complexType=this,r._$interceptor=t||V,Y.getDefaultInstance().initializeEntityPrototype(r),extra.initialized=!0,this._ctor=e},m.addValidator=function(e,t){Q(e,"validator").isInstanceOf(tt).check(),Q(t,"property").isOptional().isString().or().isEntityProperty().check(),t?("string"==typeof t&&(t=this.getProperty(t,!0)),t.validators.push(e)):this.validators.push(e)},m.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},m.getPropertyNames=function(){return this.getProperties().map(a("name"))},m.getDataProperty=function(e,t){var r=t?"nameOnServer":"name";return l(this.dataProperties,n(r,e))},m.getNavigationProperty=function(e,t){var r=t?"nameOnServer":"name";return l(this.navigationProperties,n(r,e))},m.getProperty=function(e,t){t=t||!1;var r=Array.isArray(e)?e:e.trim().split("."),a=r[0],i=l(this.getProperties(),n("name",a));if(1===r.length){if(i)return i;if(t)throw new Error("unable to locate property: "+a+" on entityType: "+this.name);return null}if(i){r.shift();var o=i.isNavigationProperty?i.entityType:i.dataType;if(o)return o.getProperty(r,t);throw new Error("should not get here - unknown property type for: "+i.name)}if(t)throw new Error("unable to locate property: "+a+" on type: "+this.name);return null},m.toString=function(){return this.name},m.toJSON=function(){return p(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:r,navigationProperties:r,validators:null})},m._clientPropertyPathToServer=function(e){var t=this.metadataStore.namingConvention.clientPropertyNameToServer,r=this,n=e.split(".").map(function(e){var n=r.getProperty(e);return t(e,n)}).join("/");return n},m._updateNames=function(e){var t=this.metadataStore.namingConvention;i(t,e,"name"),e.isNavigationProperty&&(i(t,e,"foreignKeyNames"),i(t,e,"invForeignKeyNames"))},m._checkNavProperty=function(e){if(e.isNavigationProperty){if(e.parentType!==this)throw new Error(k("The navigationProperty '%1' is not a property of entity type '%2'",e.name,this.name));return e}if("string"==typeof e){var t=this.getProperty(e);if(t&&t.isNavigationProperty)return t}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty")},m._addDataProperty=function(e){this.dataProperties.push(e),e.isPartOfKey&&this.keyProperties.push(e),e.isComplexProperty&&this.complexProperties.push(e),e.concurrencyMode&&"None"!==e.concurrencyMode&&this.concurrencyProperties.push(e),e.isUnmapped&&this.unmappedProperties.push(e)},m._addNavigationProperty=function(e){this.navigationProperties.push(e),j(e.entityTypeName)||(e.entityTypeName=K(e.entityTypeName,this.namespace))},m._updateCps=function(){var e=this.metadataStore,t=e._incompleteComplexTypeMap;this.complexProperties.forEach(function(r){r.complexType||o(r,e)||v(t,r.complexTypeName).push(r)}),this.isComplexType&&((t[this.name]||[]).forEach(function(t){o(t,e)}),delete t[this.name])},m._updateNps=function(){var e=this.metadataStore,t=e._incompleteTypeMap;this.navigationProperties.forEach(function(r){r.entityType||s(r,e)||v(t,r.entityTypeName).push(r)}),(t[this.name]||[]).forEach(function(t){s(t,e)}),delete t[this.name]},d}(),mt=function(){var e=function(e){if(arguments.length>1)throw new Error("The ComplexType ctor has a single argument that is a configuration object.");H(e).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().applyAll(this),this.name=K(this.shortName,this.namespace),this.isComplexType=!0,this.dataProperties=[],this.complexProperties=[],this.validators=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.navigationProperties=[],this.keyProperties=[],R(this,e.dataProperties,vt)},t=e.prototype;return t._createInstanceCore=function(e,t){var r=this.getCtor(),n=new r;return new ot(n,e,t),n},t.addProperty=function(e){if(Q(e,"dataProperty").isInstanceOf(vt).check(),this.metadataStore&&!e.isUnmapped)throw new Error("The '"+this.name+"' ComplexType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(e.parentType){if(e.parentType!==this)throw new Error("This dataProperty has already been added to "+property.parentType.name);return this}return this._addDataProperty(e),this},t.getProperties=function(){return this.dataProperties},t.addValidator=dt.prototype.addValidator,t.getProperty=dt.prototype.getProperty,t.getPropertyNames=dt.prototype.getPropertyNames,t.createInstance=dt.prototype.createEntity,t._addDataProperty=dt.prototype._addDataProperty,t._updateNames=dt.prototype._updateNames,t._updateCps=dt.prototype._updateCps,t._initializeInstance=dt.prototype._initializeInstance,t.getCtor=dt.prototype.getEntityCtor,t._setCtor=dt.prototype._setCtor,t.toJSON=function(){return p(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null})},t._$typeName="ComplexType",e}(),vt=function(){var e=function(e){H(e).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(yt).isOptional().or().isString().or().isInstanceOf(mt).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("isScalar").isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(tt).isArray().isOptional().withDefault([]).whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().applyAll(this);var t=!(!this.name&&!this.nameOnServer);if(!t)throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if("string"==typeof this.dataType){var r=yt.fromName(this.dataType);if(!r)throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=r}else this.dataType||(this.dataType=yt.String);if(null==this.defaultValue)if(this.isNullable)this.defaultValue=null;else if(this.isComplexProperty);else if(this.dataType===yt.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,null==this.defaultValue)throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+this.name);this.isComplexProperty&&(this.isScalar=null==this.isScalar||this.isScalar===!0)},t=e.prototype;return t._$typeName="DataProperty",t.isDataProperty=!0,t.isNavigationProperty=!1,t.toJSON=function(){return p(this,{name:null,dataType:function(e){return e&&e.parentEnum?e.name:void 0},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,concurrencyMode:null,maxLength:null,validators:null,enumType:null,rawTypeName:null,isScalar:!0})},e.fromJSON=function(e){return e.dataType=yt.fromName(e.dataType),e.defaultValue&&e.dataType&&e.dataType.isDate&&(e.defaultValue=new Date(Date.parse(e.defaultValue))),e.validators&&(e.validators=e.validators.map(tt.fromJSON)),new vt(e)},e}(),gt=function(){var e=function(e){H(e).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(tt).isArray().isOptional().withDefault([]).applyAll(this);var t=!(!this.name&&!this.nameOnServer);if(!t)throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property")},t=e.prototype;return t._$typeName="NavigationProperty",t.isDataProperty=!1,t.isNavigationProperty=!0,t.toJSON=function(){return p(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,foreignKeyNames:null,invForeignKeyNames:null})},e.fromJSON=function(e){return e.validators&&(e.validators=e.validators.map(tt.fromJSON)),new gt(e)},e}(),Et=function(){var e=new Z("AutoGeneratedKeyType");return e.None=e.addSymbol(),e.Identity=e.addSymbol(),e.KeyGenerator=e.addSymbol(),e.seal(),e}();!function(){function e(e,t){return null==t?!1:void 0!==t.entityType}function t(e,t){return null==t?!1:t.isDataProperty||t.isNavigationProperty}var r=G.prototype;r.isEntity=function(){return this._addContext({fn:e,msg:" must be an entity"})},r.isEntityProperty=function(){return this._addContext({fn:t,msg:" must be either a DataProperty or a NavigationProperty"})}}(),L.MetadataStore=ft,L.EntityType=dt,L.ComplexType=mt,L.DataProperty=vt,L.NavigationProperty=gt,L.AutoGeneratedKeyType=Et,ft.normalizeTypeName=ht.normalizeTypeName;var wt=function(){function e(e,t,r){var n=t.name+".."+t.parentType.name,a=e._tempIdMap[n];return a||r&&(a={entityType:t.parentType,propertyName:t.name,keyMap:{}},e._tempIdMap[n]=a),a}var t=function(){this._tempIdMap={}},r=t.prototype;return r.generateTempKeyValue=function(t,r){var n=t.keyProperties;if(n.length>1)throw new Error("Ids can not be autogenerated for entities with multipart keys");var a,i=n[0],o=e(this,i,!0);if(null!=r&&(o.keyMap[r.toString()]||(a=r)),void 0===a){var s=i.dataType;if(!s.getNext)throw new Error("Cannot use a property with a dataType of: "+s.toString()+" for id generation");for(a=s.getNext(this);null!=o.keyMap[a.toString()];)a=s.getNext(this)}return o.keyMap[a.toString()]=!0,a},r.getTempKeys=function(){var e=[];for(var t in this._tempIdMap){var r=this._tempIdMap[t],n=r.entityType;for(var a in r.keyMap)e.push(new st(n,[a]))}return e},r.isTempKey=function(t){var r=t.entityType.keyProperties;if(r.length>1)return!1;var n=r[0],a=e(this,n);return a?void 0!==a.keyMap[t.values[0].toString()]:!1},W.registerType(t,"KeyGenerator"),t}();L.KeyGenerator=wt;var St=function(){var e=function(e){H(e||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this),this.name||(this.name=T()),W._storeObject(this,t._$typeName,this.name)},t=e.prototype;return t._$typeName="LocalQueryComparisonOptions",e.caseInsensitiveSQL=new e({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),e.defaultInstance=new e(e.caseInsensitiveSQL),t.setAsDefault=function(){return u(this,e)},e}();L.LocalQueryComparisonOptions=St;var _t=function(){var e=function(e){H(e||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this),this.name||(this.name=T()),W._storeObject(this,t._$typeName,this.name)},t=e.prototype;return t._$typeName="NamingConvention",e.none=new e({name:"noChange",serverPropertyNameToClient:function(e){return e},clientPropertyNameToServer:function(e){return e}}),e.camelCase=new e({name:"camelCase",serverPropertyNameToClient:function(e){return e.substr(0,1).toLowerCase()+e.substr(1)},clientPropertyNameToServer:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)}}),e.defaultInstance=new e(e.none),t.setAsDefault=function(){return u(this,e)},e}();L.NamingConvention=_t;var Tt=function(){function t(r,n,a,i){var o=a._$typeName||a.parentEnum&&a.parentEnum.name,s=o&&o.substr(0,1).toLowerCase()+o.substr(1);if(i&&s!=i)throw new Error("Invalid value for property: "+i);if(s){var u=n[s];if(void 0===u)throw new Error("Invalid config property: "+s);null===u?r[s]=a:u(r,a)}else e(a,function(e,a){t(r,n,a,e)})}function r(e){return Q(e,"propertyPaths").isOptional().isString().or().isArray().isString().check(),"string"==typeof e&&(e=e.split(",")),e=e.map(function(e){return e.trim()})}function n(e){var t=e.entityType,r=t.keyProperties.map(function(t){return Ct.create(t.name,Nt.Equals,e.getProperty(t.name))}),n=Ct.and(r);return n}function a(e,t,n){var a,i=e._clone();return null==t?(i.orderByClause=null,i):(t=r(t),a=Ft.create(t,n),i.orderByClause?i.orderByClause.addClause(a):i.orderByClause=a,i)}function i(e,t){var n=e._clone();return null==t?(n.selectClause=null,n):(t=r(t),n.selectClause=new kt(t),n)}function s(e,t){var n=e._clone();return null==t?(n.expandClause=null,n):(t=r(t),n.expandClause=new It(t),n)}function u(e,t){var r=e._clone();return r.parameters=t,r}function p(e){var t=e.entityType.keyProperties,r=d(t,e.values,function(e,t){return Ct.create(e.name,Nt.Equals,t)}),n=Ct.and(r);return n}function c(e,t){if(t.isScalar){if(0===t.foreignKeyNames.length)return null;var r=t.foreignKeyNames.map(function(t){return e.getProperty(t)}),n=new st(t.entityType,r);return p(n)}var a=t.inverse,i=a?a.foreignKeyNames:t.invForeignKeyNames;if(0===i.length)return null;var o=e.entityAspect.getKey().values,s=d(i,o,function(e,t){return Ct.create(e,Nt.Equals,t)});return Ct.and(s)}var y=function(e){Q(e,"resourceName").isOptional().isString().check(),this.resourceName=e,this.entityType=null,this.wherePredicate=null,this.orderByClause=null,this.selectClause=null,this.skipCount=null,this.takeCount=null,this.expandClause=null,this.parameters={},this.inlineCountEnabled=!1,this.entityManager=null},l=y.prototype;return l._$typeName="EntityQuery",l.from=function(e){Q(e,"resourceName").isString().check();var t=this.resourceName;if(t&&t!==e)throw new Error("This query already has an resourceName - the resourceName may only be set once per query");var r=this._clone();return r.resourceName=e,r},y.from=function(e){return Q(e,"resourceName").isString().check(),new Tt(e)},l.toType=function(e){Q(e,"entityType").isString().or().isInstanceOf(dt).check();var t=this._clone();return t.resultEntityType=e,t},l.where=function(e){var t=this._clone();if(null==e)return t.wherePredicate=null,t;var r;return r=Ct.isPredicate(e)?e:Ct.create(U(arguments)),t.entityType&&r.validate(t.entityType),t.wherePredicate=t.wherePredicate?new xt("and",[t.wherePredicate,r]):r,t},l.orderBy=function(e){return a(this,e)},l.orderByDesc=function(e){return a(this,e,!0)},l.select=function(e){return i(this,e)},l.skip=function(e){Q(e,"count").isOptional().isNumber().check();var t=this._clone();return t.skipCount=null==e?null:e,t},l.top=function(e){return this.take(e)},l.take=function(e){Q(e,"count").isOptional().isNumber().check();var t=this._clone();return t.takeCount=null==e?null:e,t},l.expand=function(e){return s(this,e)},l.withParameters=function(e){return Q(e,"parameters").isObject().check(),u(this,e)},l.inlineCount=function(e){void 0===e&&(e=!0);var t=this._clone();return t.inlineCountEnabled=e,t},l.using=function(e){if(!e)return this;var r=this._clone();return t(r,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(e,t){e.queryOptions=(e.queryOptions||new Kt).using(t)},mergeStrategy:function(e,t){e.queryOptions=(e.queryOptions||new Kt).using(t)},jsonResultsAdapter:function(e,t){e.dataService=(e.dataService||new pt).using({jsonResultsAdapter:t})}},e),r},l.execute=function(e,t){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,e,t)},l.executeLocally=function(){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},y.fromEntities=function(e){Q(e,"entities").isEntity().or().isNonEmptyArray().isEntity().check(),Array.isArray(e)||(e=U(arguments));var t=e[0],r=new Tt(t.entityType.defaultResourceName),a=e.map(function(e){return n(e)}),i=Ct.or(a);r=r.where(i);var o=t.entityAspect.entityManager;return o&&(r=r.using(o)),r},y.fromEntityKey=function(e){Q(e,"entityKey").isInstanceOf(st).check();var t=new Tt(e.entityType.defaultResourceName),r=p(e);return t=t.where(r)},y.fromEntityNavigation=function(e,t){Q(e,"entity").isEntity().check(),Q(t,"navigationProperty").isInstanceOf(gt).check();var r=e.entityType._checkNavProperty(t),n=new Tt(r.entityType.defaultResourceName),a=c(e,r);n=n.where(a);var i=e.entityAspect.entityManager;return i&&(n=n.using(i)),n},l._getFromEntityType=function(e,t){var r=this.entityType;if(r)return r;var n=this.resourceName;if(!n)throw new Error("There is no resourceName for this query");if(e.isEmpty()){if(t)throw new Error("There is no metadata available for this query");return null}var a=e.getEntityTypeNameForResourceName(n);if(r=a?e._getEntityType(a):this._getToEntityType(e,!0),!r){if(t)throw new Error(k("Cannot find an entityType for resourceName: '%1'.  Consider adding an 'EntityQuery.toType' call to your query or calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",n));return null}return this.entityType=r,r},l._getToEntityType=function(e,t){return this.resultEntityType instanceof dt?this.resultEntityType:this.resultEntityType?(this.resultEntityType=e._getEntityType(this.resultEntityType,!1),this.resultEntityType):t?null:!this.selectClause&&this._getFromEntityType(e,!1)},l._clone=function(){var e=new Tt;return e.resourceName=this.resourceName,e.entityType=this.entityType,e.wherePredicate=this.wherePredicate,e.orderByClause=this.orderByClause,e.selectClause=this.selectClause,e.skipCount=this.skipCount,e.takeCount=this.takeCount,e.expandClause=this.expandClause,e.inlineCountEnabled=this.inlineCountEnabled,e.parameters=o({},this.parameters),e.queryOptions=this.queryOptions,e.entityManager=this.entityManager,e.dataService=this.dataService,e.resultEntityType=this.resultEntityType,e},l._toUri=function(e){function t(){var e=c.wherePredicate;if(e)return c.entityType&&e.validate(c.entityType),e.toOdataFragment(p)}function r(){return c.inlineCountEnabled?c.inlineCountEnabled?"allpages":"none":void 0}function n(){var e=c.orderByClause;if(e)return c.entityType&&e.validate(c.entityType),e.toOdataFragment(p)}function a(){var e=c.selectClause;if(e)return c.entityType&&e.validate(c.entityType),e.toOdataFragment(p)}function i(){var e=c.expandClause;if(e)return e.toOdataFragment(p)}function o(){var e=c.skipCount;if(e)return e.toString()}function s(){var e=c.takeCount;if(null!=e)return e.toString()}function u(e){var t=[];for(var r in e){var n=e[r];void 0!==n&&(n instanceof Array?n.forEach(function(e){t.push(r+"="+encodeURIComponent(e))}):t.push(r+"="+encodeURIComponent(n)))}return t.length>0?"?"+t.join("&"):""}var p=this._getFromEntityType(e,!1);p||(p=new dt(e));var c=this,y={};y.$filter=t(),y.$orderby=n(),y.$skip=o(),y.$top=s(),y.$expand=i(),y.$select=a(),y.$inlinecount=r();var l=u(y);return this.resourceName+l},l._toFilterFunction=function(e){var t=this.wherePredicate;return t?(t.validate(e),t.toFunction(e)):null},l._toOrderByComparer=function(e){var t=this.orderByClause;return t?t.getComparer(e):null},y}(),Pt=function(){var e={toupper:{fn:function(e){return e.toUpperCase()},dataType:yt.String},tolower:{fn:function(e){return e.toLowerCase()},dataType:yt.String},substring:{fn:function(e,t,r){return e.substring(t,r)},dataType:yt.String},substringof:{fn:function(e,t){return t.indexOf(e)>=0},dataType:yt.Boolean},length:{fn:function(e){return e.length},dataType:yt.Int32},trim:{fn:function(e){return e.trim()},dataType:yt.String},concat:{fn:function(e,t){return e.concat(t)},dataType:yt.String},replace:{fn:function(e,t,r){return e.replace(t,r)},dataType:yt.String},startswith:{fn:function(e,t){return M(e,t)},dataType:yt.Boolean},endswith:{fn:function(e,t){return D(e,t)},dataType:yt.Boolean},indexof:{fn:function(e,t){return e.indexOf(t)},dataType:yt.Int32},round:{fn:function(e){return Math.round(e)},dataType:yt.Int32},ceiling:{fn:function(e){return Math.ceil(e)},dataType:yt.Int32},floor:{fn:function(e){return Math.floor(e)},dataType:yt.Int32},second:{fn:function(e){return e.second},dataType:yt.Int32},minute:{fn:function(e){return e.minute},dataType:yt.Int32},day:{fn:function(e){return e.day},dataType:yt.Int32},month:{fn:function(e){return e.month},dataType:yt.Int32},year:{fn:function(e){return e.year},dataType:yt.Int32}};return e}(),bt=function(){function e(e){var t=e.split(".");return 1===t.length?function(t){return t.getProperty(e)}:function(e){return q(e,t)}}var t=/^[a-z_][\w.$]*$/i,r=/('[^']*'|[^,]+)/g,n=/("[^"]*"|[^,]+)/g,a=function(a,i,o){var s=a.split(":");if(this.isRealNode=!0,1===s.length){var u=s[0].trim();this.value=u;var p=u.substr(0,1),c="'"===p||'"'===p;if(c){var y=u.substr(1,u.length-2);this.fn=function(){return y},this.dataType=yt.String}else{var l=t.test(u);if(l){if(o&&null==o.getProperty(u,!1))return this.isRealNode=!1,void 0;this.propertyPath=u,this.fn=e(u)}else{if(o)return this.isRealNode=!1,void 0;this.fn=function(){return u},this.dataType=yt.fromValue(u)}}}else try{this.fnName=s[0].trim().toLowerCase();var f=Pt[this.fnName];this.localFn=f.fn,this.dataType=f.dataType;var h=this;this.fn=function(e){var t=h.fnNodes.map(function(t){var r=t.fn(e);return r}),r=h.localFn.apply(null,t);return r};var d=i[s[1]].trim();"("===d.substr(0,1)&&(d=d.substr(1,d.length-2));var m=a.indexOf("'")>=0?r:n,v=d.match(m);this.fnNodes=v.map(function(e){return new bt(e,i)})}catch(g){this.isRealNode=!1}},i=a.prototype;return a.create=function(e,t,r){if("string"!=typeof e)return null;for(var n,a=/\([^()]*\)/,i=[],o=0;n=a.exec(e);){var s=n[0];i.push(s);var u=":"+o++;e=e.replace(s,u)}var p=new bt(e,i,r?null:t);return p.isRealNode?(!p.dataType&&r&&r.isStringFn&&(p.dataType=yt.String),p._validate(t),p):null},i.toString=function(){if(this.fnName){var e=this.fnNodes.map(function(e){return e.toString()}),t=this.fnName+"("+e.join(",")+")";return t}return this.value},i.toOdataFragment=function(e){if(this._validate(e),this.fnName){var t=this.fnNodes.map(function(t){return t.toOdataFragment(e)}),r=this.fnName+"("+t.join(",")+")";return r}var n=this.value.substr(0,1);return"'"===n||'"'===n?this.value:this.value==this.propertyPath?e._clientPropertyPathToServer(this.propertyPath):this.value},i._validate=function(e){if(!this.isValidated)if(this.isValidated=!0,this.propertyPath){if(e.isAnonymous)return;var t=e.getProperty(this.propertyPath,!0);if(!t){var r=k("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",e.name,this.propertyPath);throw new Error(r)}this.dataType=t.isDataProperty?t.dataType:t.entityType}else this.fnNodes&&this.fnNodes.forEach(function(t){t._validate(e)})},a}(),Nt=function(){var e=new Z("FilterQueryOp");return e.Equals=e.addSymbol({operator:"eq",aliases:["=="]}),e.NotEquals=e.addSymbol({operator:"ne",aliases:["!="]}),e.GreaterThan=e.addSymbol({operator:"gt",aliases:[">"]}),e.LessThan=e.addSymbol({operator:"lt",aliases:["<"]}),e.GreaterThanOrEqual=e.addSymbol({operator:"ge",aliases:[">="]}),e.LessThanOrEqual=e.addSymbol({operator:"le",aliases:["<="]}),e.Contains=e.addSymbol({operator:"substringof",isFunction:!0,isStringFn:!0}),e.StartsWith=e.addSymbol({operator:"startswith",isFunction:!0,isStringFn:!0}),e.EndsWith=e.addSymbol({operator:"endswith",isFunction:!0,isStringFn:!0}),e.IsTypeOf=e.addSymbol({operator:"isof",isFunction:!0,aliases:["isTypeOf"]}),e.seal(),e._map=function(){var t={};return e.getSymbols().forEach(function(e){t[e.name.toLowerCase()]=e,t[e.operator.toLowerCase()]=e,e.aliases&&e.aliases.forEach(function(r){t[r.toLowerCase()]=e})}),t}(),e.from=function(t){return e.contains(t)?t:e._map[t.toLowerCase()]},e}(),Ot=function(){var e=new Z("BooleanQueryOp");return e.And=e.addSymbol({operator:"and",aliases:["&&"]}),e.Or=e.addSymbol({operator:"or",aliases:["||"]}),e.Not=e.addSymbol({operator:"not",aliases:["~","!"]}),e.seal(),e._map=function(){var t={};return e.getSymbols().forEach(function(e){t[e.name.toLowerCase()]=e,t[e.operator.toLowerCase()]=e,e.aliases&&e.aliases.forEach(function(r){t[r.toLowerCase()]=e})}),t}(),e.from=function(t){return e.contains(t)?t:e._map[t.toLowerCase()]},e}(),Ct=function(){function e(e){var t;if(1===e.length&&Array.isArray(e[0]))t=e[0];else{var t=U(e);Ct.isPredicate(t[0])||(t=[Ct.create(t)])}return t.filter(function(e){return null!=e})}var t=function(e,t,r){return arguments[0].prototype===!0?this:new At(e,t,r)},r=t.prototype;return t.isPredicate=function(e){return e instanceof Ct},t.create=function(e,t,r){return Array.isArray(e)?new At(e[0],e[1],e[2]):new At(e,t,r)},t.and=function(t){return t=e(arguments),0===t.length?null:1===t.length?t[0]:new xt("and",t)},t.or=function(t){return t=e(arguments),0===t.length?null:1===t.length?t[0]:new xt("or",t)},t.not=function(e){return new xt("not",[e])},r.and=function(r){return r=e(arguments),r.unshift(this),t.and(r)},r.or=function(r){return r=e(arguments),r.unshift(this),t.or(r)},r.not=function(){return new xt("not",[this])},t}(),At=function(){function e(e,i,o){var s,u=e.metadataStore.localQueryComparisonOptions,p=z(o);switch(i){case Nt.Equals:s=function(e,r){return e&&"string"==typeof e?t(e,r,u):p(e)==p(r)};break;case Nt.NotEquals:s=function(e,r){return e&&"string"==typeof e?!t(e,r,u):p(e)!=p(r)};break;case Nt.GreaterThan:s=function(e,t){return p(e)>p(t)};break;case Nt.GreaterThanOrEqual:s=function(e,t){return p(e)>=p(t)};break;case Nt.LessThan:s=function(e,t){return p(e)<p(t)};break;case Nt.LessThanOrEqual:s=function(e,t){return p(e)<=p(t)};break;case Nt.StartsWith:s=function(e,t){return r(e,t,u)};break;case Nt.EndsWith:s=function(e,t){return n(e,t,u)};break;case Nt.Contains:s=function(e,t){return a(e,t,u)};break;default:throw new Error("Unknown FilterQueryOp: "+i)
}return s}function t(e,t,r){return null==t?!1:("string"!=typeof t&&(t=t.toString()),r.usesSql92CompliantStringComparison&&(e=(e||"").trim(),t=(t||"").trim()),r.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),e===t)}function r(e,t,r){return r.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),M(e,t)}function n(e,t,r){return r.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),D(e,t)}function a(e,t,r){return r.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),e.indexOf(t)>=0}var i=function(e,t,r){if(Q(e,"propertyOrExpr").isString().isOptional().check(),3!=arguments.length||null==t)return this._odataExpr=e,void 0;if(Q(t,"operator").isEnumOf(Nt).or().isString().check(),Q(r,"value").isRequired(!0).check(),this._filterQueryOp=Nt.from(t),!this._filterQueryOp)throw new Error("Unknown query operation: "+t);if(e)this._propertyOrExpr=e;else if(this._filterQueryOp!==Nt.IsTypeOf)throw new Error("propertyOrExpr cannot be null except when using the 'IsTypeOf' operator");null!=r&&"object"==typeof r&&void 0!==r.value?(this._dataType=r.dataType||yt.fromValue(r.value),this._value=r.value,this._isLiteral=r.isLiteral):(this._dataType=yt.fromValue(r),this._value=r,this._isLiteral=void 0)},o=new Ct({prototype:!0});return i.prototype=o,o.toOdataFragment=function(e){if(this._odataExpr)return this._odataExpr;if(this._filterQueryOp==Nt.IsTypeOf){var t=e.metadataStore.getEntityType(this._value),r=t.namespace+"."+t.shortName;return this._filterQueryOp.operator+"("+yt.String.fmtOData(r)+")"}this.validate(e);var n,a=this._fnNode1&&this._fnNode1.toOdataFragment(e);if(this._fnNode2)n=this._fnNode2.toOdataFragment(e);else{var i=this._fnNode1.dataType||this._dataType;n=i.fmtOData(this._value)}return this._filterQueryOp.isFunction?this._filterQueryOp==Nt.Contains?this._filterQueryOp.operator+"("+n+","+a+") eq true":this._filterQueryOp.operator+"("+a+","+n+") eq true":a+" "+this._filterQueryOp.operator+" "+n},o.toFunction=function(t){if(this._odataExpr)throw new Exception("OData predicateexpressions cannot be interpreted locally");this.validate(t);var r=this._fnNode1.dataType||this._dataType,n=e(t,this._filterQueryOp,r),a=this._fnNode1.fn;if(this._fnNode2){var i=this._fnNode2.fn;return function(e){return n(a(e),i(e))}}var o=this._value;return function(e){return n(a(e),o)}},o.toString=function(){return k("{%1} %2 {%3}",this._propertyOrExpr,this._filterQueryOp.operator,this._value)},o.validate=function(e){void 0===this._fnNode1&&this._propertyOrExpr&&(this._fnNode1=bt.create(this._propertyOrExpr,e,this._filterQueryOp),this.dataType=this._fnNode1.dataType),void 0!==this._fnNode2||this._isLiteral||(this._fnNode2=bt.create(this._value,e))},i}(),xt=function(){function e(e,t,r){var n,a;switch(t){case Ot.Not:return n=r[0].toFunction(e),function(e){return!n(e)};case Ot.And:return a=r.map(function(t){return t.toFunction(e)}),function(e){var t=a.reduce(function(t,r){return t&&r(e)},!0);return t};case Ot.Or:return a=r.map(function(t){return t.toFunction(e)}),function(e){var t=a.reduce(function(t,r){return t||r(e)},!1);return t};default:throw new Error("Invalid boolean operator:"+t)}}var t=function(e,t){if(!Array.isArray(t))throw new Error("predicates parameter must be an array");if(this._booleanQueryOp=Ot.from(e),!this._booleanQueryOp)throw new Error("Unknown query operation: "+e);if(this._booleanQueryOp===Ot.Not&&1!==t.length)throw new Error("Only a single predicate can be passed in with the 'Not' operator");this._predicates=t},r=new Ct({prototype:!0});return t.prototype=r,r.toOdataFragment=function(e){if(1==this._predicates.length)return this._booleanQueryOp.operator+" "+"("+this._predicates[0].toOdataFragment(e)+")";var t=this._predicates.map(function(t){return"("+t.toOdataFragment(e)+")"}).join(" "+this._booleanQueryOp.operator+" ");return t},r.toFunction=function(t){return e(t,this._booleanQueryOp,this._predicates)},r.toString=function(){if(1==this._predicates.length)return this._booleanQueryOp.operator+" "+"("+this._predicates[0]+")";var e=this._predicates.map(function(e){return"("+e.toString()+")"}).join(" "+this._booleanQueryOp.operator+" ");return e},r.validate=function(e){this._isValidated||(this._predicates.every(function(t){t.validate(e)}),this._isValidated=!0)},t}(),Ft=function(){var e=function(t,r){return t.prototype===!0?this:e.create(t,r)},t=e.prototype;return e.create=function(e,t){if(e.length>1){var r=e.map(function(e){return new Mt(e,t)});return new Dt(r)}return new Mt(e[0],t)},e.combine=function(e){return new Dt(e)},e.isOrderByClause=function(e){return e instanceof Ft},t.addClause=function(e){return new Dt([this,e])},e}(),Mt=function(){var e=function(e,t){if("string"!=typeof e)throw new Error("propertyPath is not a string");e=e.trim();var r=e.split(" ");if(r.length>1&&t!==!0&&t!==!1&&(t=M(r[1].toLowerCase(),"desc"),!t)){var n=M(r[1].toLowerCase(),"asc");if(!n)throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'")}this.propertyPath=r[0],this.isDesc=t},t=new Ft({prototype:!0});return e.prototype=t,t.validate=function(e){e&&(this.lastProperty=e.getProperty(this.propertyPath,!0))},t.toOdataFragment=function(e){return e._clientPropertyPathToServer(this.propertyPath)+(this.isDesc?" desc":"")},t.getComparer=function(e){if(this.lastProperty||this.validate(e),this.lastProperty)var t=this.lastProperty.dataType,r=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive;var n=this.propertyPath,a=this.isDesc;return function(e,i){var o=q(e,n),s=q(i,n),u=t||o&&yt.fromValue(o)||yt.fromValue(s);if(u===yt.String)r?(o=o||"",s=s||""):(o=(o||"").toLowerCase(),s=(s||"").toLowerCase());else{var p=z(u);o=p(o),s=p(s)}return o===s?0:o>s||void 0===s?a?-1:1:a?1:-1}},e}(),Dt=function(){var e=function(e){var t=[];e.forEach(function(e){if(e instanceof Dt)t=t.concat(e.orderByClauses);else{if(!(e instanceof Mt))throw new Error("Invalid argument to CompositeOrderByClause ctor.");t.push(e)}}),this._orderByClauses=t},t=new Ft({prototype:!0});return e.prototype=t,t.validate=function(e){this._orderByClauses.forEach(function(t){t.validate(e)})},t.toOdataFragment=function(e){var t=this._orderByClauses.map(function(t){return t.toOdataFragment(e)});return t.join(",")},t.getComparer=function(e){var t=this._orderByClauses.map(function(t){return t.getComparer(e)});return function(e,r){for(var n=0;n<t.length;n++){var a=t[n](e,r);if(0!==a)return a}return 0}},e}(),kt=function(){var e=function(e){this.propertyPaths=e,this._pathNames=e.map(function(e){return e.replace(".","_")})},t=e.prototype;return t.validate=function(e){e&&this.propertyPaths.forEach(function(t){e.getProperty(t,!0)})},t.toOdataFragment=function(e){var t=this.propertyPaths.map(function(t){return e._clientPropertyPathToServer(t)}).join(",");return t},t.toFunction=function(){var e=this;return function(t){var r={};return e.propertyPaths.forEach(function(n,a){r[e._pathNames[a]]=q(t,n)}),r}},e}(),It=function(){var e=function(e){this.propertyPaths=e},t=e.prototype;return t.toOdataFragment=function(e){var t=this.propertyPaths.map(function(t){return e._clientPropertyPathToServer(t)}).join(",");return t},e}();L.FilterQueryOp=Nt,L.Predicate=Ct,L.EntityQuery=Tt,L.FnNode=bt,L.OrderByClause=Ft;var Vt=function(){var e=new Z("MergeStrategy");return e.PreserveChanges=e.addSymbol(),e.OverwriteChanges=e.addSymbol(),e.seal(),e}(),jt=function(){var e=new Z("FetchStrategy");return e.FromServer=e.addSymbol(),e.FromLocalCache=e.addSymbol(),e.seal(),e}(),Kt=function(){function e(e,t){return t&&H(t).whereParam("fetchStrategy").isEnumOf(jt).isOptional().whereParam("mergeStrategy").isEnumOf(Vt).isOptional().applyAll(e),e}var t=function(t){e(this,t)},r=t.prototype;return r._$typeName="QueryOptions",t.resolve=function(e){return new Kt(c(e,["fetchStrategy","mergeStrategy"]))},t.defaultInstance=new t({fetchStrategy:jt.FromServer,mergeStrategy:Vt.PreserveChanges}),r.using=function(t){if(!t)return this;var r=new Kt(this);return Vt.contains(t)?t={mergeStrategy:t}:jt.contains(t)&&(t={fetchStrategy:t}),e(r,t)},r.setAsDefault=function(){return u(this,t)},r.toJSON=function(){return p(this,{fetchStrategy:null,mergeStrategy:null})},t.fromJSON=function(e){return new Kt({fetchStrategy:jt.fromName(e.fetchStrategy),mergeStrategy:Vt.fromName(e.mergeStrategy)})},t}();L.QueryOptions=Kt,L.FetchStrategy=jt,L.MergeStrategy=Vt;var Rt=function(){function e(e){if(e){if(1===e.length){var t=e[0];return function(e){return e?e.entityAspect.entityState===t:!1}}return function(t){return t?e.some(function(e){return t.entityAspect.entityState===e}):!1}}return function(e){return!!e}}var t=e([ut.Added,ut.Modified,ut.Deleted]),r=function(e,t){this.entityManager=e,this.entityType=t,this._indexMap={},this._entities=[],this._emptyIndexes=[]},n=r.prototype;return n.attachEntity=function(e,t){var r,n=e.entityAspect;n._initialized||this.entityType._initializeInstance(e),delete n._initialized;var a=n.getKey()._keyInGroup;if(r=this._indexMap[a],r>=0){if(this._entities[r]===e)return n.entityState=t,e;throw new Error("This key is already attached: "+n.getKey())}return 0===this._emptyIndexes.length?r=this._entities.push(e)-1:(r=this._emptyIndexes.pop(),this._entities[r]=e),this._indexMap[a]=r,n.entityState=t,n.entityGroup=this,n.entityManager=this.entityManager,e},n.detachEntity=function(e){var t=e.entityAspect,r=t.getKey()._keyInGroup,n=this._indexMap[r];if(void 0===n)throw new Error("internal error - entity cannot be found in group");return delete this._indexMap[r],this._emptyIndexes.push(n),this._entities[n]=null,e},n.findEntityByKey=function(e){var t;t=e instanceof st?e._keyInGroup:st.createKeyString(e);var r=this._indexMap[t];return void 0!==r?this._entities[r]:null},n.hasChanges=function(){return this._entities.some(t)},n.getEntities=function(t){var r=e(t);return this._entities.filter(r)},n._clear=function(){this._entities.forEach(function(e){null!=e&&e.entityAspect._detach()}),this._entities=null,this._indexMap=null,this._emptyIndexes=null},n._fixupKey=function(e,t){var r=this._indexMap[e];if(void 0===r)throw new Error("Internal Error in key fixup - unable to locate entity");var n=this._entities[r],a=n.entityType.keyProperties[0].name;n.setProperty(a,t),delete n.entityAspect.hasTempKey,delete this._indexMap[e],this._indexMap[t]=r},n._replaceKey=function(e,t){var r=this._indexMap[e._keyInGroup];delete this._indexMap[e._keyInGroup],this._indexMap[t._keyInGroup]=r},r}(),qt=function(){function t(e,t,r){var n=r?Kt.defaultInstance:e.queryOptions,a=r?zt.defaultInstance:e.saveOptions,i=r?nt.defaultInstance:e.validationOptions,o=H(t).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(pt).whereParam("queryOptions").isInstanceOf(Kt).isOptional().withDefault(n).whereParam("saveOptions").isInstanceOf(zt).isOptional().withDefault(a).whereParam("validationOptions").isInstanceOf(nt).isOptional().withDefault(i).whereParam("keyGeneratorCtor").isFunction().isOptional();r&&(o=o.whereParam("metadataStore").isInstanceOf(ft).isOptional().withDefault(new ft)),o.applyAll(e),s(e.queryOptions,n),s(e.saveOptions,a),s(e.validationOptions,i),t.serviceName&&(e.dataService=new pt({serviceName:e.serviceName})),e.serviceName=e.dataService&&e.dataService.serviceName,e.keyGeneratorCtor=e.keyGeneratorCtor||wt,(r||t.keyGeneratorCtor)&&(e.keyGenerator=new e.keyGeneratorCtor)}function r(t){t.forEach(function(t){var r=[],n=t.entityAspect._validationErrors;e(n,function(e,t){t.isServerError&&r.push(e)}),0!==r.length&&(r.forEach(function(e){delete n[e]}),t.hasValidationErrors=!x(n))})}function n(t){var r=[];return t.forEach(function(t){e(t.entityAspect._validationErrors,function(e,n){r.push({entity:t,errorName:n.validator.name,errorMessage:n.errorMessage,propertyName:n.propertyName,isServerError:n.isServerError})})}),r}function a(e,t){var r=t.entityErrors;if(r){var n=e.entityManager,a=n.metadataStore;t.entityErrors=r.map(function(e){var t=null;if(e.keyValues){var r=a._getEntityType(e.entityTypeName),i=new st(r,e.keyValues);t=n.findEntityByKey(i)}if(t){var o=e.propertyName?{propertyName:e.propertyName,property:r.getProperty(e.propertyName)}:{},s=rt.getKey(e.errorName||e.errorMessage,e.propertyName),u=new rt(null,o,e.errorMessage,s);u.isServerError=!0,t.entityAspect.addValidationError(u)}var p={entity:t,errorName:e.errorName,errorMessage:e.errorMessage,propertyName:e.propertyName,isServerError:!0};return p})}}function o(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;n>r;r++)if(e[r]!==t[r])return!1;return!0}function u(e,t){return Q(t,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(dt).or().isNonEmptyArray().isInstanceOf(dt).check(),"string"==typeof t?t=e.metadataStore._getEntityType(t,!1):Array.isArray(t)&&"string"==typeof t[0]&&(t=t.map(function(t){return e.metadataStore._getEntityType(t,!1)})),t}function p(e,t,r){var n,a=C(e,t);return a.forEach(function(e){if(e){var t=e.getEntities(r);n?n.push.apply(n,t):n=t}}),n||[]}function c(e,t){if(t[0]instanceof st)return{entityKey:t[0],remainingArgs:U(t,1)};if("string"==typeof t[0]&&t.length>=2){var r=e.metadataStore._getEntityType(t[0],!1);return{entityKey:new st(r,t[1]),remainingArgs:U(t,2)}}throw new Error("This method requires as its initial parameters either an EntityKey or an entityType name followed by a value or an array of values.")}function y(e,t){e.forEach(function(e){e.entityAspect.isBeingSaved=t})}function f(t,r){var n;r?(n={},r.forEach(function(e){var t=n[e.entityType.name];t||(t={},t.entityType=e.entityType,t._entities=[],n[e.entityType.name]=t),t._entities.push(e)})):n=t._entityGroupMap;var a=[],i={};return e(n,function(e,t){i[e]=m(t,a)}),{entityGroupMap:i,tempKeys:a}}function m(e,t){var r={},n=e.entityType,a=n.dataProperties,i=[];return e._entities.forEach(function(e){if(e){var r=g(e,a,t);i.push(r)}}),r.entities=i,r}function g(e,t,r){var n={};t.forEach(function(t){var r=t.name,a=e.getProperty(r);if(null!=a||null!=t.defaultValue)if(a&&a.complexType){var i=t.dataType.dataProperties;n[r]=Array.isArray(a)?0==a.length?[]:a.map(function(e){return g(e,i)}):g(a,i)}else n[r]=a});var a,i;if(e.entityAspect){a=e.entityAspect;var o=a.entityState;i={tempNavPropNames:E(a,r),entityState:o.name},(o.isModified()||o.isDeleted())&&(i.originalValuesMap=a.originalValues),n.entityAspect=i}else a=e.complexAspect,i={},a.originalValues&&!x(a.originalValues)&&(i.originalValuesMap=a.originalValues),n.complexAspect=i;return n}function E(e,t){var r=e.entity;e.hasTempKey&&t.push(e.getKey().toJSON());var n;return r.entityType.navigationProperties.forEach(function(e){if(e.relatedDataProperties){var t=r.getProperty(e.name);t&&t.entityAspect.hasTempKey&&(n=n||[],n.push(e.name))}}),n}function _(e,t,r){var n=r.tempKeyMap,a=e.entityType,i=r.mergeStrategy===Vt.OverwriteChanges,o=null,s=a.dataProperties;a.keyProperties;var u=e.entityManager,p=u.entityChanged,c=[];return t.entities.forEach(function(t){var r,y=t.entityAspect,l=B(t,a,!0),f=ut.fromName(y.entityState);if(f.isAdded()?(r=n[l.toString()],o=void 0===r?e.findEntityByKey(l):null):o=e.findEntityByKey(l),o){var h=o.entityAspect.entityState.isUnchanged();i||h?(z(o,t,s,!0),p.publish({entityAction:at.MergeOnImport,entity:o}),h?f.isUnchanged()||u._notifyStateChange(o,!0):f.isUnchanged()&&u._notifyStateChange(o,!1)):(c.push(o),o=null)}else o=a._createInstanceCore(),z(o,t,s,!0),void 0!==r&&(o.setProperty(a.keyProperties[0].name,r.values[0]),y.tempNavPropNames&&y.tempNavPropNames.forEach(function(e){var t=a.getNavigationProperty(e),r=t.relatedDataProperties[0].name,i=o.getProperty(r),s=new st(t.entityType,[i]),u=n[s.toString()];o.setProperty(r,u.values[0])})),o=e.attachEntity(o,f),p&&(p.publish({entityAction:at.AttachOnImport,entity:o}),f.isUnchanged()||u._notifyStateChange(o,!0));o&&(o.entityAspect.entityState=f,f.isModified()&&(o.entityAspect.originalValuesMap=y.originalValues),c.push(o))}),c}function P(e,t,r){return e=e.then(function(e){return t&&t(e),lt.resolve(e)}).fail(function(e){return r&&r(e),lt.reject(e)})}function b(e,t){var r;return r=t?t.filter(function(t){if(t.entityAspect.entityManager!==e)throw new Error("Only entities in this entityManager may be saved");return!t.entityAspect.entityState.isDetached()}):e.getChanges()}function O(e,t){e._inKeyFixup=!0,t.forEach(function(t){var r=e._entityGroupMap[t.entityTypeName];if(!r)throw new Error("Unable to locate the following fully qualified EntityType name: "+t.entityTypeName);r._fixupKey(t.tempValue,t.realValue)}),e._inKeyFixup=!1}function C(e,t){function r(){return new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null")}var n=e._entityGroupMap;if(t){if(t instanceof dt)return[n[t.name]];if(Array.isArray(t))return t.map(function(e){if(e instanceof dt)return n[e.name];throw r()});throw r()}return i(n)}function A(e,t){var r=t.entityAspect.getKey(),n=d(t.entityType.keyProperties,r.values,function(e,t){return e.defaultValue===t?e:null}).filter(function(e){return null!==e});if(n.length)if(t.entityType.autoGeneratedKeyType!==Et.None)e.generateTempKeyValue(t);else if(n.length===r.values.length)throw new Error("Cannot attach an object to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'")}function F(e,t){function r(){return new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates")}if(!t)return null;if(ut.contains(t))t=[t];else{if(!Array.isArray(t))throw r();t.forEach(function(e){if(!ut.contains(e))throw r()})}return t}function M(e,t,r){var n=gt(e,t.entityType);n.attachEntity(t,r),e._linkRelatedEntities(t)}function D(e,t,r){var n=t.entityType.navigationProperties;n.forEach(function(n){var a=t.getProperty(n.name);if(n.isScalar){if(!a)return;e.attachEntity(a,r)}else a.forEach(function(t){e.attachEntity(t,r)})})}function k(e,t,r,n){try{var a=e.metadataStore;if(a.isEmpty()&&n.hasServerMetadata)throw new Error("cannot execute _executeQueryCore until metadataStore is populated.");if(r.fetchStrategy===jt.FromLocalCache)return lt.fcall(function(){var r=e.executeQueryLocally(t);return{results:r,query:t}});var i=n.makeUrl(a.toQueryString(t)),o={url:i,query:t,entityManager:e,dataService:n,queryOptions:r,refMap:{},deferredFns:[]},s=e.validationOptions.validateOnQuery;return n.adapterInstance.executeQuery(o).then(function(r){var a=S(function(){var t={isLoading:e.isLoading};return e.isLoading=!0,e._pendingPubs=[],t},function(r){e.isLoading=r.isLoading,e._pendingPubs.forEach(function(e){e()}),e._pendingPubs=null,t=null,o=null,r.error&&lt.reject(r.error)},function(){var a=n.jsonResultsAdapter.extractResults(r);Array.isArray(a)||(a=null==a?[]:[a]);var i=a.map(function(e){var t=I(e,o,{nodeType:"root"});return s&&t.entityAspect&&t.entityAspect.validateEntity(),t});return o.deferredFns.length>0&&o.deferredFns.forEach(function(e){e()}),{results:i,query:t,entityManager:e,XHR:r.XHR,inlineCount:r.inlineCount}});return lt.resolve(a)}).fail(function(r){return r&&(r.query=t,r.entityManager=e),lt.reject(r)})}catch(u){return u&&(u.query=t),lt.reject(u)}}function I(e,t,r){if(null==t.query&&e.entityAspect)return e.entityAspect.entityState.isDeleted()?t.entityManager.detachEntity(e):e.entityAspect.acceptChanges(),e;r=r||{};var n=t.dataService.jsonResultsAdapter.visitNode(e,t,r)||{};return t.query&&"root"===r.nodeType&&!n.entityType&&(n.entityType=t.query._getToEntityType&&t.query._getToEntityType(t.entityManager.metadataStore)),V(e,t,n)}function V(e,t,r,n){if(r.ignore||null==e)return null;if(r.nodeRefId){var a=j(r.nodeRefId,t);return"function"==typeof a?(t.deferredFns.push(function(){n(a)}),void 0):a}return r.entityType?r.entityType.isComplexType?e:K(e,t,r):(r.nodeId&&(t.refMap[r.nodeId]=e),"object"!=typeof e||N(e)?e:R(e,t))}function j(e,t){var r=t.refMap[e];return void 0===r?function(){return t.refMap[e]}:r}function K(e,t,r){e._$meta=r;var n=t.entityManager,a=r.entityType;"string"==typeof a&&(a=n.metadataStore._getEntityType(a,!1)),e.entityType=a;var i=t.queryOptions.mergeStrategy,o=null==t.query,s=B(e,a,!1),u=n.findEntityByKey(s);if(u){if(o&&u.entityAspect.entityState.isDeleted())return n.detachEntity(u),u;var p=u.entityAspect.entityState;if(i===Vt.OverwriteChanges||p.isUnchanged()){q(u,e,t),u.entityAspect.wasLoaded=!0,r.extra&&(u.entityAspect.extraMetadata=r.extra),u.entityAspect.entityState=ut.Unchanged,u.entityAspect.originalValues={},u.entityAspect.propertyChanged.publish({entity:u,propertyName:null});var c=o?at.MergeOnSave:at.MergeOnQuery;n.entityChanged.publish({entityAction:c,entity:u}),p.isUnchanged||n._notifyStateChange(u,!1)}else Z(t,u,e),a.navigationProperties.forEach(function(r){r.isScalar?et(e,r,t):ct(e,r,t)})}else u=a._createInstanceCore(),u.initializeFrom&&u.initializeFrom(e),q(u,e,t),r.extra&&(u.entityAspect.extraMetadata=r.extra),M(n,u,ut.Unchanged),u.entityAspect.wasLoaded=!0,n.entityChanged.publish({entityAction:at.AttachOnQuery,entity:u});return u}function R(t,r){var n=r.entityManager,a=r.dataService.jsonResultsAdapter,i=n.metadataStore.namingConvention.serverPropertyNameToClient,o={};return e(t,function(e,t){var n=a.visitNode(t,r,{nodeType:"anonProp",propertyName:e})||{};if(!n.ignore){var s=i(e);o[s]=Array.isArray(t)?t.map(function(t,i){return n=a.visitNode(t,r,{nodeType:"anonPropItem",propertyName:e})||{},V(t,r,n,function(e){o[s][i]=e()})}):V(t,r,n,function(e){o[s]=e()})}}),o}function q(e,t,r){Z(r,e,t);var n=e.entityType;z(e,t,n.dataProperties,!1),n.navigationProperties.forEach(function(n){n.isScalar?Y(n,e,t,r):ot(n,e,t,r)})}function z(e,t,r,n){if(r.forEach(function(r){L(e,t,r,n)}),n){var a=e.entityAspect?"entityAspect":"complexAspect",i=t[a].originalValuesMap;i&&(e[a].originalValues=i)}}function L(e,t,r,n){var a=n?$:G,i=a(t,r);if(void 0!==i){var o;if(r.isComplexProperty){o=e.getProperty(r.name);var s=r.dataType,u=s.dataProperties;r.isScalar?z(o,i,u,n):(o.length=0,Array.isArray(i)&&i.forEach(function(t){var a=s._createInstanceCore(e,r);z(a,t,u,n),s._initializeInstance(a),o.push(a)}))}else{var p;r.isScalar?(p=J(r,i),e.setProperty(r.name,p)):(o=e.getProperty(r.name),o.length=0,Array.isArray(i)&&i.forEach(function(e){p=J(r,e),o.push(p)}))}}}function B(e,t,r){var n=r?$:G,a=t.keyProperties.map(function(t){return J(t,n(e,t))});return new st(t,a)}function $(e,t){var r=e[t.name];return void 0!==r?r:t.defaultValue}function G(e,t){if(t.isUnmapped)return e[t.nameOnServer||t.name];var r=e[t.nameOnServer];return void 0!==r?r:t.defaultValue}function J(e,t){return void 0===t?void 0:(e.dataType.isDate&&t?N(t)||(t=yt.parseDateFromServer(t)):e.dataType===yt.Binary&&t&&void 0!==t.$value&&(t=t.$value),t)}function Z(e,t,r){var n=r._$meta.nodeId;null!=n&&(e.refMap[n]=t)}function Y(e,t,r,n){var a=et(r,e,n);null!=a&&("function"==typeof a?n.deferredFns.push(function(){a=a(),tt(a,t,e)}):tt(a,t,e))}function et(e,t,r){var n=e[t.nameOnServer];if(!n)return null;var a=I(n,r,{nodeType:"navProp",navigationProperty:t});return a}function tt(e,t,r){if(e){var n=r.name,a=t.getProperty(n);if(a!==e){t.setProperty(n,e);var i=r.inverse;if(!i)return;if(i.isScalar)e.setProperty(i.name,t);else{var o=e.getProperty(i.name);o.push(t)}}}}function ot(e,t,r,n){var a=ct(r,e,n);if(null!=a){var i=e.inverse;if(i){var o=t.getProperty(e.name);o.wasLoaded=!0,a.forEach(function(e){"function"==typeof e?n.deferredFns.push(function(){e=e(),ht(e,o,t,i)}):ht(e,o,t,i)})}}}function ct(e,t,r){var n=e[t.nameOnServer];if(!n)return null;if(!Array.isArray(n))return null;var a=n.map(function(e){return I(e,r,{nodeType:"navPropItem",navigationProperty:t})});return a}function ht(e,t,r,n){if(e){var a=e.getProperty(n.name);a!==r&&(t.push(e),e.setProperty(n.name,r))}}function mt(e){var t=e.filter(function(e){return e.entityAspect.isBeingSaved=!0,e.entityAspect.entityState.isModified()&&e.entityType.concurrencyProperties.length>0});0!==t.length&&t.forEach(function(e){e.entityType.concurrencyProperties.forEach(function(t){vt(e,t)})})}function vt(e,t){if(!e.entityAspect.originalValues[t.name]){var r=e.getProperty(t.name);if(r||(r=t.dataType.defaultValue),t.dataType.isNumeric)e.setProperty(t.name,r+1);else if(t.dataType.isDate){for(var n=new Date,a=new Date;n.getTime()===a.getTime();)a=new Date;e.setProperty(t.name,a)}else{if(t.dataType!==yt.Guid){if(t.dataType===yt.Binary)return;throw new Error("Unable to update the value of concurrency property before saving: "+t.name)}e.setProperty(t.name,T())}}}function gt(e,t){var r=e._entityGroupMap[t.name];return r||(r=new Rt(e,t),e._entityGroupMap[t.name]=r),r}function St(e,t){var r=t.getSelfAndSubtypes();return r.map(function(t){return gt(e,t)})}function _t(e,t){var r={},n=e.entityType||e.complexType;return n.dataProperties.forEach(function(n){if(n.isUnmapped){if(t)return;var a=e.getProperty(n.name);a=Nt(a,n,!1),void 0!==a&&(r.__unmapped=r.__unmapped||{},r.__unmapped[n.name]=a)}else if(n.isComplexProperty)if(n.isScalar)r[n.nameOnServer]=_t(e.getProperty(n.name),t);else{var i=e.getProperty(n.name);r[n.nameOnServer]=i.map(function(e){return _t(e,t)})}else{var a=e.getProperty(n.name);a=Nt(a,n,t),void 0!==a&&(r[n.nameOnServer]=a)}}),r}function Pt(t,r,n){var a=t.entityType||t.complexType,i=t.entityAspect||t.complexAspect,o=r.namingConvention.clientPropertyNameToServer,s={};return e(i.originalValues,function(e,t){var r=a.getProperty(e);t=Nt(t,r,n),void 0!==t&&(s[o(e,r)]=t)}),a.complexProperties.forEach(function(e){var a=t.getProperty(e.name);if(e.isScalar){var i=Pt(a,r,n);x(i)||(s[o(e.name,e)]=i)}else{var u=a.map(function(e){return Pt(e,r,n)});s[o(e.name,e)]=u}}),s}function bt(t,r,n){var a=t.entityType||t.complexType,i=t.entityAspect||t.complexAspect,o=r.namingConvention.clientPropertyNameToServer,s={};return e(i.originalValues,function(e){var r=a.getProperty(e),i=t.getProperty(e);i=Nt(i,r,n),void 0!==i&&(s[o(e,r)]=i)}),a.complexProperties.forEach(function(e){var n=t.getProperty(e.name);if(e.isScalar){var a=bt(n,r);x(a)||(s[o(e.name,e)]=a)}else{var i=n.map(function(e){return bt(e,r)});s[o(e.name,e)]=i}}),s}function Nt(e,t,r){if(r){if(t.isUnmapped)return;t.dataType===yt.DateTimeOffset?e=e&&new Date(e.getTime()-6e4*e.getTimezoneOffset()):t.dataType.quoteJsonOData&&(e=null!=e?e.toString():e)}return e}function Ot(){this.map={}}var Ct=function(e){if(arguments.length>1)throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");0===arguments.length?e={serviceName:""}:"string"==typeof e&&(e={serviceName:e}),t(this,e,!0),this.entityChanged=new X("entityChanged",this),this.validationErrorsChanged=new X("validationErrorsChanged",this),this.hasChangesChanged=new X("hasChangesChanged",this),this.clear()},At=Ct.prototype;return At._$typeName="EntityManager",X.bubbleEvent(At,null),At.setProperties=function(e){t(this,e,!1)},At.createEntity=function(e,t,r){Q(e,"entityType").isString().or().isInstanceOf(dt).check(),"string"==typeof e&&(e=this.metadataStore._getEntityType(e)),r=r||ut.Added;var n;return w(this,"isLoading",!0,function(){n=e.createEntity(t)}),r!==ut.Detached&&this.attachEntity(n,r),n},Ct.importEntities=function(e,t){var r=new qt;return r.importEntities(e,t),r},At.exportEntities=function(e){var t=f(this,e),r={metadataStore:this.metadataStore.exportMetadata(),dataService:this.dataService,saveOptions:this.saveOptions,queryOptions:this.queryOptions,validationOptions:this.validationOptions,tempKeys:t.tempKeys,entityGroupMap:t.entityGroupMap},n=JSON.stringify(r,null,W.stringifyPad);return n},At.importEntities=function(t,r){r=r||{},H(r).whereParam("mergeStrategy").isEnumOf(Vt).isOptional().withDefault(this.queryOptions.mergeStrategy).applyAll(r);var n=this,a="string"==typeof t?JSON.parse(t):t;this.metadataStore.importMetadata(a.metadataStore),this.dataService=a.dataService&&pt.fromJSON(a.dataService)||new pt({serviceName:a.serviceName}),this.saveOptions=new zt(a.saveOptions),this.queryOptions=Kt.fromJSON(a.queryOptions),this.validationOptions=new nt(a.validationOptions);var i={};a.tempKeys.forEach(function(e){var t=st.fromJSON(e,n.metadataStore);i[t.toString()]=new st(t.entityType,n.keyGenerator.generateTempKeyValue(t.entityType,t.values[0]))});var o=[];return r.tempKeyMap=i,S(function(){n._pendingPubs=[]},function(){n._pendingPubs.forEach(function(e){e()}),n._pendingPubs=null},function(){e(a.entityGroupMap,function(e,t){var a=n.metadataStore._getEntityType(e,!0),i=gt(n,a),s=_(i,t,r);Array.prototype.push.apply(o,s)}),o.forEach(function(e){n._linkRelatedEntities(e)})}),{entities:o,tempKeyMapping:i}},At.clear=function(){e(this._entityGroupMap,function(e,t){t._clear()}),this._entityGroupMap={},this._unattachedChildrenMap=new Ot,this.keyGenerator=new this.keyGeneratorCtor,this.entityChanged.publish({entityAction:at.Clear}),this._hasChanges&&(this._hasChanges=!1,this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},At.createEmptyCopy=function(){var e=new Ct({dataService:this.dataService,metadataStore:this.metadataStore,queryOptions:this.queryOptions,saveOptions:this.saveOptions,validationOptions:this.validationOptions,keyGeneratorCtor:this.keyGeneratorCtor});return e},At.addEntity=function(e){return this.attachEntity(e,ut.Added)},At.attachEntity=function(e,t){if(Q(e,"entity").isRequired().check(),this.metadataStore._checkEntityType(e),t=Q(t,"entityState").isEnumOf(ut).isOptional().check(ut.Unchanged),e.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot attach this entity because the EntityType and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");var r=e.entityAspect;r||(r=new it(e));var n=r.entityManager;if(n){if(n===this)return e;throw new Error("This entity already belongs to another EntityManager")}var a=this;return w(this,"isLoading",!0,function(){t.isAdded()&&A(a,e),M(a,e,t),D(a,e,t)}),this.validationOptions.validateOnAttach&&e.entityAspect.validateEntity(),t.isUnchanged()||this._notifyStateChange(e,!0),this.entityChanged.publish({entityAction:at.Attach,entity:e}),e},At.detachEntity=function(e){Q(e,"entity").isEntity().check();var t=e.entityAspect;if(!t)return!1;if(t.entityManager!==this)throw new Error("This entity does not belong to this EntityManager.");return t.setDetached()},At.fetchMetadata=function(e,t,r){"function"==typeof e?(r=t,t=e,e=null):(Q(e,"dataService").isInstanceOf(pt).isOptional().check(),Q(t,"callback").isFunction().isOptional().check(),Q(r,"errorCallback").isFunction().isOptional().check());var n=this.metadataStore.fetchMetadata(e||this.dataService);return P(n,t,r)},At.executeQuery=function(e,t,r){Q(e,"query").isInstanceOf(Tt).or().isString().check(),Q(t,"callback").isFunction().isOptional().check(),Q(r,"errorCallback").isFunction().isOptional().check();var n,a=Kt.resolve([e.queryOptions,this.queryOptions,Kt.defaultInstance]),i=pt.resolve([e.dataService,this.dataService]);if(!i.hasServerMetadata||this.metadataStore.hasMetadataFor(i.serviceName))n=k(this,e,a,i);else{var o=this;n=this.fetchMetadata(i).then(function(){return k(o,e,a,i)})}return P(n,t,r)},At.executeQueryLocally=function(e){Q(e,"query").isInstanceOf(Tt).check();var t=this.metadataStore,r=e._getFromEntityType(t,!0),n=St(this,r),a=e._toFilterFunction(r);if(a)var i=function(e){return e&&!e.entityAspect.entityState.isDeleted()&&a(e)};else var i=function(e){return e&&!e.entityAspect.entityState.isDeleted()};var o=[];n.forEach(function(e){o.push.apply(o,e._entities.filter(i))});var s=e._toOrderByComparer(r);s&&o.sort(s);var u=e.skipCount;u&&(o=o.slice(u));var p=e.takeCount;p&&(o=o.slice(0,p));var c=e.selectClause;if(c){var y=c.toFunction();o=o.map(function(e){return y(e)})}return o},At.saveChanges=function(e,t,i,s){Q(e,"entities").isOptional().isArray().isEntity().check(),Q(t,"saveOptions").isInstanceOf(zt).isOptional().check(),Q(i,"callback").isFunction().isOptional().check(),Q(s,"errorCallback").isFunction().isOptional().check(),t=t||this.saveOptions||zt.defaultInstance;var u=null==e,p=b(this,e);if(0===p.length){var c={entities:[],keyMappings:[]};return i&&i(c),lt.resolve(c)
}if(!t.allowConcurrentSaves){var l=p.some(function(e){return e.entityAspect.isBeingSaved});if(l){var f=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false");return s&&s(f),lt.reject(f)}}if(r(p),this.validationOptions.validateOnSave){var h=p.filter(function(e){var t=e.entityAspect,r=t.entityState.isDeleted()||t.validateEntity();return!r});if(h.length>0){var d=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail");return d.entityErrors=n(h),s&&s(d),lt.reject(d)}}mt(p);var m=pt.resolve([t.dataService,this.dataService]),v={entityManager:this,dataService:m,resourceName:t.resourceName||this.saveOptions.resourceName||"SaveChanges"},g={mergeStrategy:Vt.OverwriteChanges},E={entities:p,saveOptions:t},w=this;return m.adapterInstance.saveChanges(v,E).then(function(e){O(w,e.keyMappings);var t={query:null,entityManager:w,queryOptions:g,dataService:m,refMap:{},deferredFns:[]},r=e.entities.map(function(e){return I(e,t,{nodeType:"root"})});return y(p,!1),w._hasChanges=u&&o(p,r)?!1:w._hasChangesCore(),w._hasChanges||w.hasChangesChanged.publish({entityManager:w,hasChanges:!1}),e.entities=r,i&&i(e),lt.resolve(e)},function(e){return a(v,e),y(p,!1),s&&s(e),lt.reject(e)})},At._findEntityGroup=function(e){return this._entityGroupMap[e.name]},At.getEntityByKey=function(){var e,t=c(this,arguments).entityKey,r=t._subtypes;if(!r)return e=this._findEntityGroup(t.entityType),e&&e.findEntityByKey(t);for(var n=0,a=r.length;a>n;n++){e=this._findEntityGroup(r[n]);var i=e&&e.findEntityByKey(t);if(i)return i}},At.fetchEntityByKey=function(){var e,t=c(this,arguments),r=t.entityKey,n=0===t.remainingArgs.length?!1:!!t.remainingArgs[0],a=!1;return n&&(e=this.getEntityByKey(r),a=e&&e.entityAspect.entityState.isDeleted(),a&&(e=null,this.queryOptions.mergeStrategy===Vt.OverwriteChanges&&(a=!1))),e||a?lt.resolve({entity:e,entityKey:r,fromCache:!0}):Tt.fromEntityKey(r).using(this).execute().then(function(t){return e=0===t.results.length?null:t.results[0],lt.resolve({entity:e,entityKey:r,fromCache:!1})})},At.findEntityByKey=function(e){return this.getEntityByKey(e)},At.generateTempKeyValue=function(e){Q(e,"entity").isEntity().check();var t=e.entityType,r=this.keyGenerator.generateTempKeyValue(t),n=t.keyProperties[0];return e.setProperty(n.name,r),e.entityAspect.hasTempKey=!0,r},At.hasChanges=function(e){return this._hasChanges?void 0===e?this._hasChanges:this._hasChangesCore(e):!1},At._hasChangesCore=function(e){e=u(this,e);var t=C(this,e);return t.some(function(e){return e.hasChanges()})},At.getChanges=function(e){e=u(this,e);var t=[ut.Added,ut.Modified,ut.Deleted];return p(this,e,t)},At.rejectChanges=function(){if(!this._hasChanges)return[];var e=[ut.Added,ut.Modified,ut.Deleted],t=p(this,null,e);return this._hasChanges=!1,t.forEach(function(e){e.entityAspect.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),t},At.getEntities=function(e,t){return e=u(this,e),Q(t,"entityStates").isOptional().isEnumOf(ut).or().isNonEmptyArray().isEnumOf(ut).check(),t&&(t=F(this,t)),p(this,e,t)},At._notifyStateChange=function(e,t){this.entityChanged.publish({entityAction:at.EntityStateChange,entity:e}),t?this._hasChanges||(this._hasChanges=!0,this.hasChangesChanged.publish({entityManager:this,hasChanges:!0})):this._hasChanges&&(this._hasChanges=this._hasChangesCore(),this._hasChanges||this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},At._linkRelatedEntities=function(e){var t=this,r=e.entityAspect;w(t,"isLoading",!0,function(){var n=t._unattachedChildrenMap,a=r.getKey(),i=n.getTuples(a);i&&i.forEach(function(t){var r,i,o=t.children.filter(function(e){return e.entityAspect.entityState!==ut.Detached}),s=t.navigationProperty;if(s.inverse)if(r=s,i=s.inverse,i.isScalar){var u=o[0];e.setProperty(i.name,u),u.setProperty(r.name,e)}else{var p=e.getProperty(i.name);o.forEach(function(t){p.push(t),t.setProperty(r.name,e)})}else if(s.parentType===e.entityType)if(i=s,i.isScalar)e.setProperty(i.name,o[0]);else{var p=e.getProperty(i.name);o.forEach(function(e){p._push(e)})}else r=s,o.forEach(function(t){t.setProperty(r.name,e)});n.removeChildren(a,r)}),e.entityType.navigationProperties.forEach(function(a){if(a.isScalar){var i=e.getProperty(a.name);if(i)return}var o=r.getParentKey(a);if(o){if(o._isEmpty())return;var s=t.findEntityByKey(o);s?e.setProperty(a.name,s):n.addChild(o,a,e)}}),e.entityType.foreignKeyProperties.forEach(function(r){var a=r.inverseNavigationProperty;if(a){var i=e.getProperty(r.name),o=new st(a.parentType,[i]),s=t.findEntityByKey(o);s?a.isScalar?s.setProperty(a.name,e):t.isLoading?s.getProperty(a.name)._push(e):s.getProperty(a.name).push(e):n.addChild(o,a,e)}})})},At.helper={unwrapInstance:_t,unwrapOriginalValues:Pt,unwrapChangedValues:bt,getEntityKeyFromRawEntity:B},Ot.prototype.addChild=function(e,t,r){var n=this.getTuple(e,t);n||(n={navigationProperty:t,children:[]},v(this.map,e.toString()).push(n)),n.children.push(r)},Ot.prototype.removeChildren=function(e,t){var r=this.map[e.toString()];r&&(h(r,function(e){return e.navigationProperty===t}),r.length||delete this.map[e.toString()])},Ot.prototype.getChildren=function(e,t){var r=this.getTuple(e,t);return r?r.children.filter(function(e){return!e.entityAspect.entityState.isDetached()}):null},Ot.prototype.getTuple=function(e,t){var r=this.map[e.toString()];if(!r)return null;var n=l(r,function(e){return e.navigationProperty===t});return n},Ot.prototype.getTuples=function(e){return this.map[e.toString()]},Ct}();L.EntityManager=qt;var zt=function(){function e(e,t){return t&&H(t).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(pt).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(e),e}var t=function(t){e(this,t)},r=t.prototype;return r._$typeName="SaveOptions",r.setAsDefault=function(){return u(this,t)},r.using=function(t){return e(this,t)},t.defaultInstance=new t({allowConcurrentSaves:!1}),t}();L.SaveOptions=zt,L.AbstractDataServiceAdapter=function(){function e(e){if(!e.responseText)return null;var t=JSON.parse(e.responseText);return t&&t.EntityErrors}function t(e,t){var r=new Error;r.message="Server side errors encountered - see the entityErrors collection on this object for more detail";var n=e.entityManager.metadataStore.namingConvention.serverPropertyNameToClient;return r.entityErrors=t.map(function(e){return{errorName:e.ErrorName,entityTypeName:ft.normalizeTypeName(e.EntityTypeName),keyValues:e.KeyValues,propertyName:e.PropertyName&&n(e.PropertyName),errorMessage:e.ErrorMessage}}),r}var r,n=function(){};return n.prototype.checkForRecomposition=function(e){"ajax"===e.interfaceName&&e.isDefault&&this.initialize()},n.prototype.initialize=function(){if(r=L.config.getAdapterInstance("ajax"),!r)throw new Error("Unable to initialize ajax for WebApi.");var e=r.ajax;if(!e)throw new Error("Breeze was unable to find an 'ajax' adapter")},n.prototype.fetchMetadata=function(e,t){var n=t.serviceName,a=t.makeUrl("Metadata"),i=lt.defer(),o=this;return r.ajax({url:a,dataType:"json",success:function(r,o,s){var u;if(e.hasMetadataFor(n))return i.resolve("already fetched");var p="string"==typeof r?JSON.parse(r):r;if(p)try{e.importMetadata(p)}catch(c){u=new Error("Metadata import failed for "+a+"; Unable to process returned metadata:"+c.message)}else u=new Error("Metadata query failed for: "+a);return u?i.reject(u):(e.hasMetadataFor(n)||e.addDataService(t),s.onreadystatechange=null,s.abort=null,i.resolve(p),void 0)},error:function(e){o._handleXHRError(i,e,"Metadata query failed for: "+a)}}),i.promise},n.prototype.executeQuery=function(e){var t=lt.defer(),n=this,a={url:e.url,data:e.query.parameters,dataType:"json",success:function(e,r,a){try{var i;i=e&&e.Results?{results:e.Results,inlineCount:e.InlineCount,XHR:a}:{results:e,XHR:a},t.resolve(i),a.onreadystatechange=null,a.abort=null}catch(o){var s=o instanceof Error?o:n._createError(a);t.reject(s),a.onreadystatechange=null,a.abort=null}},error:function(e){n._handleXHRError(t,e)}};return e.dataService.useJsonp&&(a.dataType="jsonp",a.crossDomain=!0),r.ajax(a),t.promise},n.prototype.saveChanges=function(n,a){var i=lt.defer();a=this._prepareSaveBundle(a,n);var o=JSON.stringify(a),s=n.dataService.makeUrl(n.resourceName),u=this;return r.ajax({url:s,type:"POST",dataType:"json",contentType:"application/json",data:o,success:function(e){var r=e.Errors||e.errors;if(r){var a=t(n,r);i.reject(a)}else{var o=u._prepareSaveResult(n,e);i.resolve(o)}},error:function(r){var a=e(r);if(a){var o=t(n,a);i.reject(o)}else u._handleXHRError(i,r)}}),i.promise},n.prototype._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle")},n.prototype._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult")},n.prototype.jsonResultsAdapter=new ct({name:"noop",visitNode:function(){return{}}}),n.prototype._handleXHRError=function(e,t,r){var n=this._createError(t);r&&(n.message=r+"; "+n.message),e.reject(n),t.onreadystatechange=null,t.abort=null},n.prototype._createError=function(e){var t=new Error;if(t.XHR=e,t.responseText=e.responseText,t.status=e.status,t.statusText=e.statusText,t.message=e.statusText,t.responseText)try{var r=JSON.parse(e.responseText);t.detail=r;var n=r.InnerException||r;t.message=n.ExceptionMessage||n.Message||e.responseText}catch(a){t.message=t.message+": "+t.responseText}return t},n}(),function(e){L?e(L):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],e)}(function(e){var t,r=e.core,n=function(){this.name="jQuery",this.defaultSettings={}};n.prototype.initialize=function(){t=r.requireLib("jQuery")},n.prototype.ajax=function(e){if(!t)throw new Error("Unable to locate jQuery");if(r.isEmpty(this.defaultSettings))t.ajax(e);else{var n=r.extend({},this.defaultSettings);r.extend(n,e),t.ajax(n)}},e.config.registerAdapter("ajax",n)}),function(e){L?e(L):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!L&&define(["breeze"],e)}(function(e){function t(e,t){var n=[],a=[],i=[],o=e.dataService.serviceName,s=e.entityManager,u=s.helper,p=0;return t.entities.forEach(function(e){var t=e.entityAspect;p+=1;var c={headers:{"Content-ID":p,DataServiceVersion:"2.0"}};if(i[p]=e,t.entityState.isAdded())c.requestUri=e.entityType.defaultResourceName,c.method="POST",c.data=u.unwrapInstance(e,!0),a[p]=t.getKey();else if(t.entityState.isModified())r(c,t,o),c.method="MERGE",c.data=u.unwrapChangedValues(e,s.metadataStore,!0);else{if(!t.entityState.isDeleted())return;r(c,t,o),c.method="DELETE"}n.push(c)}),e.contentKeys=i,e.tempKeys=a,{__batchRequests:[{__changeRequests:n}]}}function r(e,t,r){var n=t.extraMetadata,a=n.uri;M(a,r)&&(a=a.substring(r.length)),e.requestUri=a,n.etag&&(e.headers["If-Match"]=n.etag)}function n(e,t){var r=new Error,n=e.response;if(r.message=n.statusText,r.statusText=n.statusText,r.status=n.statusCode,t&&(r.url=t),r.body=n.body,n.body){var i;try{var o=JSON.parse(n.body);r.body=o;var s="";do i=o.error||o.innererror,i||(s+=a(o)),i=i||o.internalexception,o=i||o;while(i);s.length>0&&(r.message=s)}catch(u){}}return r}function a(e){var t=e.message;return null==t?"":("string"==typeof t?t:t.value)+"; "}var i,o=e.core,s=e.MetadataStore,u=e.JsonResultsAdapter,p=function(){this.name="OData"};p.prototype.initialize=function(){i=o.requireLib("OData","Needed to support remote OData services"),i.jsonHandler.recognizeDates=!0},p.prototype.executeQuery=function(e){var t=lt.defer();return i.read(e.url,function(e){return t.resolve({results:e.results,inlineCount:e.__count})},function(r){return t.reject(n(r,e.url))}),t.promise},p.prototype.fetchMetadata=function(e,t){var r=lt.defer(),a=t.serviceName,o=t.makeUrl("$metadata");return i.read(o,function(n){if(!n||!n.dataServices){var i=new Error("Metadata query failed for: "+o);return r.reject(i)}var s=n.dataServices;if(!e.hasMetadataFor(a)){try{e.importMetadata(s)}catch(u){return r.reject(new Error("Metadata query failed for "+o+"; Unable to process returned metadata: "+u.message))}e.addDataService(t)}return r.resolve(s)},function(e){var t=n(e,o);return t.message="Metadata query failed for: "+o+"; "+(t.message||""),r.reject(t)},i.metadataHandler),r.promise},p.prototype.saveChanges=function(e,r){var a=lt.defer(),o=e.entityManager.helper,s=e.dataService.makeUrl("$batch"),u=t(e,r),p=e.tempKeys,c=e.contentKeys;return i.request({headers:{DataServiceVersion:"2.0"},requestUri:s,method:"POST",data:u},function(e){var t=[],r=[],i={entities:t,keyMappings:r};return e.__batchResponses.forEach(function(e){e.__changeResponses.forEach(function(e){var i=e.response||e,u=i.statusCode;if(!u||u>=400)return a.reject(n(e,s));var y=e.headers["Content-ID"],l=e.data;if(l){var f=p[y];if(f){var h=f.entityType;if(h.autoGeneratedKeyType!==Et.None){var d=f.values[0],m=o.getEntityKeyFromRawEntity(l,h,!1),v={entityTypeName:h.name,tempValue:d,realValue:m.values[0]};r.push(v)}}t.push(l)}else{var g=c[y];t.push(g)}})}),a.resolve(i)},function(e){return a.reject(n(e,s))},i.batchHandler),a.promise},p.prototype.jsonResultsAdapter=new u({name:"OData_default",visitNode:function(e,t,r){var n={};if(null==e)return n;if(null!=e.__metadata){var a=s.normalizeTypeName(e.__metadata.type),i=a&&t.entityManager.metadataStore.getEntityType(a,!0);i&&i._mappedPropertiesCount<=Object.keys(e).length-1&&(n.entityType=i,n.extra=e.__metadata)}var u=r.propertyName;return n.ignore=null!=e.__deferred||"__metadata"===u||"EntityKey"===u&&e.$type&&o.stringStartsWith(e.$type,"System.Data"),n}}),e.config.registerAdapter("dataService",p)}),function(e){L?e(L):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!L&&define(["breeze"],e)}(function(e){e.core;var t=e.MetadataStore,r=e.JsonResultsAdapter,n=e.AbstractDataServiceAdapter,a=function(){this.name="webApi"};a.prototype=new n,a.prototype._prepareSaveBundle=function(e,t){var r=t.entityManager,n=r.metadataStore,a=r.helper;return e.entities=e.entities.map(function(e){var t=a.unwrapInstance(e),r=null;e.entityType.autoGeneratedKeyType!==Et.None&&(r={propertyName:e.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:e.entityType.autoGeneratedKeyType.name});var i=a.unwrapOriginalValues(e,n);return t.entityAspect={entityTypeName:e.entityType.name,defaultResourceName:e.entityType.defaultResourceName,entityState:e.entityAspect.entityState.name,originalValuesMap:i,autoGeneratedKey:r},t}),e.saveOptions={tag:e.saveOptions.tag},e},a.prototype._prepareSaveResult=function(e,r){var n=r.KeyMappings.map(function(e){var r=t.normalizeTypeName(e.EntityTypeName);return{entityTypeName:r,tempValue:e.TempValue,realValue:e.RealValue}});return{entities:r.Entities,keyMappings:n,XHR:r.XHR}},a.prototype.jsonResultsAdapter=new r({name:"webApi_default",visitNode:function(e,r,n){if(null==e)return{};var a=t.normalizeTypeName(e.$type),i=a&&r.entityManager.metadataStore._getEntityType(a,!0),o=n.propertyName,s=o&&"$"===o.substr(0,1);return{entityType:i,nodeId:e.$id,nodeRefId:e.$ref,ignore:s}}}),e.config.registerAdapter("dataService",a)}),function(e){L?e(L):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!L&&define(["breeze"],e)}(function(e){var t=e.core;e.ComplexAspect;var r,n,a,i,o=Object.prototype.hasOwnProperty,s=function(){this.name="backbone"};s.prototype.initialize=function(){r=t.requireLib("Backbone"),n=t.requireLib("_;underscore"),a=r.Model.prototype.set,i=r.Model.prototype.get},s.prototype.createCtor=function(t){var n={};t.dataProperties.forEach(function(e){n[e.name]=e.defaultValue});var a=r.Model.extend({defaults:n,initialize:function(){if(t.navigationProperties){var n=this;t.navigationProperties.forEach(function(t){if(!t.isScalar){var a=e.makeRelationArray([],n,t);r.Model.prototype.set.call(n,t.name,a)}})}}});return a},s.prototype.getTrackablePropertyNames=function(e){var t=[];for(var r in e.attributes)t.push(r);return t},s.prototype.initializeEntityPrototype=function(e){e.getProperty=function(e){return this.get(e)},e.setProperty=function(e,t){return this.set(e,t),this},e.set=function(e,t,r){var s=this.entityAspect||this.complexAspect;if(!s)return a.call(this,e,t,r);var u,p,c,y=this,l=this.entityType||this.complexType;if(n.isObject(e)||null==e){if(u=e,r=t,!this._validate(u,r))return!1;for(c in u)if(o.call(u,c)){if(p=l.getProperty(c),null==p)throw new Error("Unknown property: "+e);var f=function(e){return function(t){return 0===arguments.length?i.call(y,e):a.call(y,e,t,r)}}(c);this._$interceptor(p,u[c],f)}}else{if(u={},u[e]=t,r||(r={}),!this._validate(u,r))return!1;if(p=l.getProperty(e),null==p)throw new Error("Unknown property: "+e);c=e,this._$interceptor(p,t,function(e){return 0===arguments.length?i.call(y,c):a.call(y,c,e,r)})}return this}},s.prototype.startTracking=function(n){if(!(n instanceof r.Model))throw new Error("This entity is not an Backbone.Model instance");var o=n.entityType||n.complexType,s=n.attributes;o.dataProperties.forEach(function(t){var r=t.name,i=s[r];t.isComplexProperty?i=t.isScalar?t.dataType._createInstanceCore(n,t):e.makeComplexArray([],n,t):t.isScalar?void 0===i&&(i=t.defaultValue):i=e.makePrimitiveArray([],n,t),a.call(n,r,i)}),o.navigationProperties&&o.navigationProperties.forEach(function(r){var o;if(r.name in s){var u=i.call(n,r.name);if(r.isScalar){if(u&&!u.entityType)throw o=t.formatString("The value of the '%1' property for entityType: '%2' must be either null or another entity",r.name,n.entityType.name),new Error(o)}else if(u){if(!u.parentEntity)throw o=t.formatString("The value of the '%1' property for entityType: '%2' must be either null or a Breeze relation array",r.name,n.entityType.name),new Error(o)}else u=e.makeRelationArray([],n,r),a.call(n,r.name,u)}else r.isScalar?a.call(n,r.name,null):(u=e.makeRelationArray([],n,r),a.call(n,r.name,u))})},e.config.registerAdapter("modelLibrary",s)}),function(e){L?e(L):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!L&&define(["breeze"],e)}(function(e){function t(e){var t=e._$extra,r=t.alreadyWrappedProps||{},i=e.entityType||e.complexType;i.getProperties().forEach(function(t){var i=t.name;r[i]||(i in e?a(e,t):n(e,t),r[i]=!0)}),t.alreadyWrappedProps=r}function r(e){var t=Object.getPrototypeOf(e);e._backingStore||(e._backingStore={});var r=t.entityType||t.complexType;return r.getProperties().forEach(function(t){var r=t.name;if(e.hasOwnProperty(r)){var n=e[r];delete e[r],e[r]=n}}),e._backingStore}function n(e,t){var r=t.name,n=function(e){return function(){return 0==arguments.length?e[r]:(e[r]=arguments[0],void 0)}},a={get:function(){var e=this._backingStore;if(e||(this._pendingSets.process(),e=this._backingStore))return e[r]},set:function(e){var a=this._backingStore;if(!a)return this._pendingSets.schedule(this,r,e),void 0;var i=n(a);this._$interceptor(t,e,i)},enumerable:!0,configurable:!0};Object.defineProperty(e,r,a)}function a(e,t){if(!e.hasOwnProperty(t.name)){var r=Object.getPrototypeOf(e);return a(r,t),void 0}var n=Object.getOwnPropertyDescriptor(e,t.name);if(n.configurable&&!n.value&&n.set){var i=function(e){return function(){return 0==arguments.length?n.get.bind(e)():(n.set.bind(e)(arguments[0]),void 0)}},o={get:function(){return n.get.bind(this)()},set:function(e){this._$interceptor(t,e,i(this))},enumerable:n.enumerable,configurable:!0};Object.defineProperty(e,t.name,o)}}var i=e.core,o=function(){this.name="backingStore"};o.prototype.initialize=function(){},o.prototype.getTrackablePropertyNames=function(e){var t=[];for(var r in e)if("entityType"!==r&&"_$typeName"!==r&&"_pendingSets"!==r&&"_backingStore"!==r&&"_$extra"!==r){var n=e[r];i.isFunction(n)||t.push(r)}return t},o.prototype.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]},e.setProperty=function(e,t){if(!this._backingStore.hasOwnProperty(e))throw new Error("Unknown property name:"+e);return this[e]=t,this},e.initializeFrom=function(e){var t=this;this.entityType.unmappedProperties.forEach(function(r){var n=r.name;e[n]=t[n]}),this._backingStore||(this._backingStore={})},e._pendingSets=[],e._pendingSets.schedule=function(e,t,r){if(this.push({entity:e,propName:t,value:r}),!this.isPending){this.isPending=!0;var n=this;setTimeout(function(){n.process()})}},e._pendingSets.process=function(){0!==this.length&&(this.forEach(function(e){e.entity._backingStore||(e.entity._backingStore={}),e.entity._backingStore[e.propName]=e.value}),this.length=0,this.isPending=!1)},t(e)},o.prototype.startTracking=function(t,n){n._pendingSets.process();var a=r(t),i=t.entityType||t.complexType;i.getProperties().forEach(function(r){var n=r.name,i=t[n];if(r.isDataProperty)r.isComplexProperty?i=r.isScalar?r.dataType._createInstanceCore(t,r):e.makeComplexArray([],t,r):r.isScalar?void 0===i&&(i=r.defaultValue):i=e.makePrimitiveArray([],t,r);else{if(!r.isNavigationProperty)throw new Error("unknown property: "+n);if(void 0!==i)throw new Error("Cannot assign a navigation property in an entity ctor.: "+r.Name);i=r.isScalar?null:e.makeRelationArray([],t,r)}a[n]=i})},e.config.registerAdapter("modelLibrary",o)}),function(e){L?e(L):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!L&&define(["breeze"],e)}(function(e){function t(e){var t=e.entityType||e.complexType;if(es5Descriptors={},t.getProperties().forEach(function(t){propDescr=r(e,t),propDescr&&(es5Descriptors[t.name]=propDescr)}),!x(es5Descriptors)){var n=e._$extra;n.es5Descriptors=es5Descriptors,n.koDummy=o.observable(null)}}function r(e,t){var n=t.name;if(e.hasOwnProperty(n))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(e,n);var a=Object.getPrototypeOf(e);return a?r(a,t):null}function n(t,r,n){if(r.isDataProperty)r.isComplexProperty?n=r.isScalar?r.dataType._createInstanceCore(t,r):e.makeComplexArray([],t,r):r.isScalar?void 0===n&&(n=r.defaultValue):n=e.makePrimitiveArray([],t,r);else{if(!r.isNavigationProperty)throw new Error("unknown property: "+r.name);if(void 0!==n)throw new Error("Cannot assign a navigation property in an entity ctor.: "+r.name);n=r.isScalar?null:e.makeRelationArray([],t,r)}return n}function a(e){e._koObj._suppressBreeze=!0}function i(e){var t=e.array._koObj;t._suppressBreeze?t._suppressBreeze=!1:t.valueHasMutated()}var o,s=e.core,u=function(){this.name="ko"};u.prototype.initialize=function(){o=s.requireLib("ko","The Knockout library"),o.extenders.intercept=function(e,t){var r,n=t.instance,a=t.property;return r=e.splice?o.computed({read:e}):o.computed({read:e,write:function(t){return n._$interceptor(a,t,e),n}})}},u.prototype.getTrackablePropertyNames=function(e){var t=[];for(var r in e)if("entityType"!==r&&"_$typeName"!==r&&"_$extra"!==r){var n=e[r];o.isObservable(n)?t.push(r):s.isFunction(n)||t.push(r)}return t},u.prototype.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]()},e.setProperty=function(e,t){return this[e](t),this},e.getPrototypeOf&&t(e)},u.prototype.startTracking=function(e,t){var r=e.entityType||e.complexType,s=t._$extra.es5Descriptors||{};r.getProperties().sort(function(e,t){var r=e.isUnmapped?1:0,n=t.isUnmapped?1:0;return r-n}).forEach(function(t){var r,u=t.name,p=e[u],c=s[u];if(c){var y=c.get.bind(e);if(c.set){var l=c.set.bind(e),f=function(e){return 0===arguments.length?y():(l(e),void 0)};r=o.computed({read:function(){return e._$extra.koDummy(),y()},write:function(r){return e._$interceptor(t,r,f),e._$extra.koDummy.valueHasMutated(),e}})}else r=o.computed({read:y,write:function(){}})}else if(o.isObservable(p)){if(t.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+u);r=p}else{var p=n(e,t,p);r=t.isScalar?o.observable(p):o.observableArray(p)}if(t.isScalar)if(c)Object.defineProperty(e,u,{enumerable:!0,configurable:!0,writable:!0,value:r});else{var h=r.extend({intercept:{instance:e,property:t}});e[u]=h}else p._koObj=r,r.subscribe(a,null,"beforeChange"),p.arrayChanged.subscribe(i),r.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.")},e[u]=r})},e.config.registerAdapter("modelLibrary",u)}),L.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery"});var Lt=E("ko");return Lt?L.config.initializeAdapterInstance("modelLibrary","ko"):L.config.initializeAdapterInstance("modelLibrary","backingStore"),this.window&&(this.window.breeze=L),L});
=======
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define?define(a):breeze=a()}(function(){function a(a,b){for(var c in a)T(a,c)&&b(c,a[c])}function b(a,b){for(var c in a)if(T(a,c)){var d=a[c];if(b(c,d))return{key:c,value:d}}return null}function c(a,b){var c=[];for(var d in a)if(T(a,d)){var e=b?b(d,a[d]):a[d];void 0!==e&&c.push(e)}return c}function d(a,b){return function(c){return c[a]===b}}function e(a){return function(b){return b[a]}}function f(a){var b=[];for(var c in a)T(a,c)&&b.push(a[c]);return b}function g(a,b,c){if(!b)return a;if(c)c.forEach(function(c){a[c]=b[c]});else for(var d in b)T(b,d)&&(a[d]=b[d]);return a}function h(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c]);return a}function i(a,b){return b.defaultInstance=h(new b(a),b.defaultInstance),a}function j(a,b){var c={};for(var d in b)if(d in a){var e=a[d],f=b[d];e!=f&&(Array.isArray(e)&&0===e.length||("function"==typeof f?e=f(e):"object"==typeof e&&e&&e.parentEnum&&(e=e.name),void 0!==e&&(c[d]=e)))}return c}function k(a,b){if(a!==Object(a))return a;if(a._$visited)return void 0;if(a.toJSON){var c=a.toJSON();if(c!==Object(c))return c;if(c!==a)return k(c);a=c}a._$visited=!0;var d;if(a instanceof Array)d=a.map(function(a){return k(a,b)});else if("function"==typeof a)d=void 0;else{var d={};for(var e in a)if("_$visited"!==e){var f=a[e];if(!b||(f=b(e,f),void 0!==f)){var f=k(f);void 0!==f&&(d[e]=f)}}}return delete a._$visited,d}function l(a,b){var c={},d=a.length;return b.forEach(function(b){for(var e=0;d>e;e++){var f=a[e];if(f){var g=f[b];if(void 0!==g){c[b]=g;break}}}}),c}function m(a){return null==a?[]:Array.isArray(a)?a:[a]}function n(a,b){if(null==a)return a;var c;return Array.isArray(a)?(c=[],a.map(function(a,d){c[d]=b(a,d)})):c=b(a),c}function o(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return a[c];return null}function p(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return c;return-1}function q(a,b,c){for(var d=D(b)?b:void 0,e=a.length-1,f=!1,g=e;g>=0;g--)if((d?d(a[g]):a[g]===b)&&(a.splice(g,1),f=!0,!c))return f;return f}function r(a,b,c){for(var d=[],e=Math.min(a.length,b.length),f=0;e>f;++f)d.push(c(a[f],b[f]));return d}function s(a,b,c){if(!a||!b)return!1;if(a.length!==b.length)return!1;for(var d=0;d<a.length;d++)if(Array.isArray(a[d])){if(!s(a[d],b[d]))return!1}else if(c){if(!c(a[d],b[d]))return!1}else if(a[d]!==b[d])return!1;return!0}function t(a,b){var c=a[b];return c||(c=[],a[b]=c),c}function u(a,b){for(var c=a.split(";"),d=0,e=c.length;e>d;d++){var f=v(c[d]);if(f)return f}if(b)throw new Error("Unable to initialize "+a+".  "+b||"")}function v(a){var b=this.window;if(b){var c=b[a];if(c)return c;var d=b.require;if(d){if(d.defined)return d.defined(a)?d(a):void 0;try{return d(a)}catch(e){return}}}}function w(a,b,c,d){var e=a[b];if(c===e)return d();a[b]=c;try{return d()}finally{void 0===e?delete a[b]:a[b]=e}}function x(a,b,c){var d;try{return d=a(),c()}catch(e){throw"object"==typeof d&&(d.error=e),e}finally{b(d)}}function y(a){return function(){for(var b=U(arguments),c="",d=b.length,e=null;d--;)e=b[d],c+=e===Object(e)?JSON.stringify(e):e,a.memoize||(a.memoize={});return c in a.memoize?a.memoize[c]:a.memoize[c]=a.apply(this,b)}}function z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function A(a){if("string"!=typeof a)throw new Error("Invalid ISO8601 duration '"+a+"'");var b=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(a);if(!b)throw new Error("Invalid ISO8601 duration '"+a+"'");for(var c=[2,3,4,6,7,8],d=[31104e3,2592e3,86400,3600,60,1],e=0,f=0;6>f;f++){var g=b[c[f]];g=g?+g.replace(/[A-Za-z]+/g,""):0,e+=g*d[f]}return e}function B(a){return null===a?"null":void 0===a?"undefined":Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function C(a){return"date"===B(a)&&!isNaN(a.getTime())}function D(a){return"function"===B(a)}function E(a){return"string"==typeof a&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(a)}function F(a){return"string"==typeof a&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(a)}function G(a){if(null===a||void 0===a)return!0;for(var b in a)if(T(a,b))return!1;return!0}function H(a){return!isNaN(parseFloat(a))&&isFinite(a)}function I(a,b){return a&&b?0===a.indexOf(b,0):!1}function J(a,b){return a&&b?-1!==a.indexOf(b,a.length-b.length):!1}function K(a){var b=arguments,c=RegExp("%([1-"+(arguments.length-1)+"])","g");return a.replace(c,function(a,c){return b[c]})}function L(a){var b=Function.call;return function(){return b.apply(a,arguments)}}function M(a,b,c){void 0===b&&(b=null);var d=c(),e=a.dataType;if(e&&e.parse&&(b=Array.isArray(b)&&!a.isScalar?b.map(function(a){return e.parse(a,typeof a)}):e.parse(b,typeof b)),!(b===d||e&&e.isDate&&b&&d&&b.valueOf()===d.valueOf())){var f,g,h,i=this,j=a.name,k=this.entityAspect;if(k)f=k;else{if(f=this.complexAspect,!f)return c(b),void 0;k=f.getEntityAspect()}var l=f.getPropertyPath(j),m=k._inProcess;if(m){if(m.indexOf(a)>=0)return;m.push(a)}else m=[a],k._inProcess=m;var n=k.entity;try{var o=k.entityManager;if(k.entityState.isUnchangedOrModified()&&void 0===f.originalValues[j]&&a.isDataProperty&&!a.isComplexProperty&&(f.originalValues[j]=void 0!==d?d:a.defaultValue),a.isComplexProperty){if(!a.isScalar)throw new Error(K("You cannot set the non-scalar complex property: '%1' on the type: '%2'.Instead get the property and use array functions like 'push' or 'splice' to change its contents.",a.name,a.parentType.name));if(!b)throw new Error(K("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",a.name,a.dataType.name));if(!d){var p=e.getCtor();d=new p,c(d)}e.dataProperties.forEach(function(a){var c=a.name,e=b.getProperty(c);d.setProperty(c,e)})}else if(a.isDataProperty){if(!a.isScalar)throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.");if(a.isPartOfKey&&!this.complexAspect&&o&&!o.isLoading){var q=this.entityType.keyProperties,r=q.map(function(c){return c===a?b:this.getProperty(c.name)},this),s=new jb(this.entityType,r);if(o.findEntityByKey(s))throw new Error("An entity with this key is already in the cache: "+s.toString());var t=this.entityAspect.getKey(),u=o._findEntityGroup(this.entityType);u._replaceKey(t,s)}var v=a.relatedNavigationProperty;if(v&&o)null!=b?(g=new jb(v.entityType,[b]),h=o.findEntityByKey(g),h?this.setProperty(v.name,h):o._unattachedChildrenMap.addChild(g,v,this)):this.setProperty(v.name,null);else if(a.inverseNavigationProperty&&o&&!o._inKeyFixup){var w=a.inverseNavigationProperty;if(null!=d&&(g=new jb(w.parentType,[d]),h=o.findEntityByKey(g)))if(w.isScalar)h.setProperty(w.name,null);else{var x=h.getProperty(w.name);x.splice(x.indexOf(this),1)}null!=b&&(g=new jb(w.parentType,[b]),h=o.findEntityByKey(g),h?w.isScalar?h.setProperty(w.name,this):h.getProperty(w.name).push(this):o._unattachedChildrenMap.addChild(g,w,this))}if(c(b),o&&!o.isLoading&&(k.entityState.isUnchanged()&&!a.isUnmapped&&k.setModified(),o.validationOptions.validateOnPropertyChange&&k._validateProperty(b,{entity:n,property:a,propertyName:l,oldValue:d})),a.isPartOfKey&&!this.complexAspect){var y=this.entityType.keyProperties.indexOf(a);this.entityType.navigationProperties.forEach(function(a){var c=a.inverse,d=c?c.foreignKeyNames:a.invForeignKeyNames;if(0!==d.length){var e=i.getProperty(a.name),f=d[y];if(a.isScalar){if(!e)return;e.setProperty(f,b)}else e.forEach(function(a){a.setProperty(f,b)})}}),k.getKey(!0)}}else{if(!a.isScalar)throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");var z=a.inverse;if(null!=b){var A=b.entityAspect;if(o){if(A.entityState.isDetached())o.isLoading||o.attachEntity(b,kb.Added);else if(A.entityManager!==o)throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.")}else A&&A.entityManager&&(o=A.entityManager,o.isLoading||o.attachEntity(k.entity,kb.Added))}if(z)if(z.isScalar)null!=d&&d.setProperty(z.name,null),null!=b&&b.setProperty(z.name,this);else{if(null!=d){var B=d.getProperty(z.name),C=B.indexOf(this);-1!==C&&B.splice(C,1)}if(null!=b){var D=b.getProperty(z.name);D.push(this)}}else if(a.invForeignKeyNames&&o&&!o._inKeyFixup){var E=a.invForeignKeyNames;if(null!=b){var F=this.entityAspect.getKey().values;E.forEach(function(a,c){b.setProperty(a,F[c])})}else null!=d&&E.forEach(function(a){var b=d.entityType.getProperty(a);b.isPartOfKey||d.setProperty(a,null)})}if(c(b),o&&!o.isLoading&&(k.entityState.isUnchanged()&&!a.isUnmapped&&k.setModified(),o.validationOptions.validateOnPropertyChange&&k._validateProperty(b,{entity:this,property:a,propertyName:l,oldValue:d})),a.relatedDataProperties&&!k.entityState.isDeleted()){var G=a.entityType.keyProperties;G.forEach(function(c,d){var e=a.relatedDataProperties[d];if(b||!e.isPartOfKey){var f=b?b.getProperty(c.name):e.defaultValue;i.setProperty(e.name,f)}})}}var H={entity:n,parent:this,property:a,propertyName:l,oldValue:d,newValue:b};o?o.isLoading||o.isRejectingChanges||(k.propertyChanged.publish(H),o.entityChanged.publish({entityAction:gb.PropertyChange,entity:n,args:H})):k.propertyChanged.publish(H)}finally{m.pop()}}}function N(a){return a.indexOf(":#")>=0}function O(a,b){return a+":#"+b}function P(a,b,c){if(b)if(Array.isArray(b))b.forEach(a.addProperty.bind(a));else{if("object"!=typeof b)throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");for(var d in b)if(T(b,d)){var e=b[d];e.name=d;var f=new c(e);a.addProperty(f)}}}function Q(a,b){var c;if(c=Array.isArray(b)?b:b.split("."),1===c.length)return a.getProperty(b);for(var d=a,e=0;e<c.length&&(d=d.getProperty(c[e]),null!=d);e++);return d}function R(a){return a&&a.isDate?function(a){return a&&a.getTime()}:a===lb.Time?function(a){return a&&A(a)}:function(a){return a}}var S={version:"1.4.8",metadataVersion:"1.0.5"},T=L(Object.prototype.hasOwnProperty),U=L(Array.prototype.slice);Object.create||(Object.create=function(a){var b=function(){};return b.prototype=a,new b});var V={};V.objectForEach=a,V.extend=g,V.propEq=d,V.pluck=e,V.arrayEquals=s,V.arrayFirst=o,V.arrayIndexOf=p,V.arrayRemoveItem=q,V.arrayZip=r,V.requireLib=u,V.using=w,V.memoize=y,V.getUuid=z,V.durationToSeconds=A,V.isDate=C,V.isGuid=E,V.isDuration=F,V.isFunction=D,V.isEmpty=G,V.isNumeric=H,V.stringStartsWith=I,V.stringEndsWith=J,V.formatString=K,V.toJSONSafe=k,V.parent=S,S.core=V;var W=function(){function a(a,b){return null==b?!1:"string"==typeof b&&b.length>0}function b(a,b){return null==b?!1:typeof b===a.typeName?!0:!1}function c(a,b){return null==b?!1:b instanceof a.type}function d(a,b){return null==b?!1:void 0!==b[a.propertyName]}function e(a,b){return null==b?!1:a.enumType.contains(b)}function f(a,b){return a.allowNull?void 0!==b:null!=b}function h(a,b){if(null==b)return!0;var c=a.prevContext;return c?c.fn(c,b):!0}function i(a,b){var c=a.prevContext,d=c?" or it "+l(c,b):"";return"is optional"+d}function j(a,b){if(!Array.isArray(b))return!1;if(a.mustNotBeEmpty&&0===b.length)return!1;var c=a.prevContext;return c?b.every(function(a){return c.fn(c,a)}):!0}function k(a,b){var c=a.mustNotBeEmpty?"a nonEmpty array":"an array",d=a.prevContext,e=d?" where each element "+l(d,b):"";return" must be "+c+e}function l(a,b){var c=a.msg;return"function"==typeof c&&(c=c(a,b)),c}function m(a,b){if(a._context){for(var c=a._context;null!=c.prevContext;)c=c.prevContext;if(null===c.prevContext)return c.prevContext=b,a;if(null!==b.prevContext)throw new Error("Illegal construction - use 'or' to combine checks");b.prevContext=a._context}return n(a,b)}function n(a,b){return a._contexts[a._contexts.length-1]=b,a._context=b,a}function o(a){var b=a._contexts;return null==b[b.length-1]&&b.pop(),0===b.length?void 0:b.some(function(b){return b.fn(b,a.v)})}function p(a,b){throw new Error(K("Error configuring an instance of '%1'. %2",a&&a._$typeName||"object",b))}var q=function(a,b){this.v=a,this.name=b,this._contexts=[null]},r=q.prototype;return r.isObject=function(){return this.isTypeOf("object")},r.isBoolean=function(){return this.isTypeOf("boolean")},r.isString=function(){return this.isTypeOf("string")},r.isNonEmptyString=function(){return m(this,{fn:a,msg:"must be a nonEmpty string"})},r.isNumber=function(){return this.isTypeOf("number")},r.isFunction=function(){return this.isTypeOf("function")},r.isTypeOf=function(a){return m(this,{fn:b,typeName:a,msg:K("must be a '%1'",a)})},r.isInstanceOf=function(a,b){return b=b||a.prototype._$typeName,m(this,{fn:c,type:a,typeName:b,msg:K("must be an instance of '%1'",b)})},r.hasProperty=function(a){return m(this,{fn:d,propertyName:a,msg:K("must have a '%1' property ",a)})},r.isEnumOf=function(a){return m(this,{fn:e,enumType:a,msg:K("must be an instance of the '%1' enumeration",a.name)})},r.isRequired=function(a){return m(this,{fn:f,allowNull:a,msg:"is required"})},r.isOptional=function(){var a={fn:h,prevContext:null,msg:i};return m(this,a)},r.isNonEmptyArray=function(){return this.isArray(!0)},r.isArray=function(a){var b={fn:j,mustNotBeEmpty:a,prevContext:null,msg:k};return m(this,b)},r.or=function(){return this._contexts.push(null),this._context=null,this},r.check=function(a){var b=o(this);if(void 0!==b){if(!b)throw new Error(this.getMessage());return void 0!==this.v?this.v:a}},r._addContext=function(a){return m(this,a)},r.getMessage=function(){var a=this,b=this._contexts.map(function(b){return l(b,a.v)}).join(", or it ");return K(this.MESSAGE_PREFIX,this.name)+" "+b},r.withDefault=function(a){return this.defaultValue=a,this},r.whereParam=function(a){return this.parent.whereParam(a)},r.applyAll=function(a,b,c){var d=a._$typeName;c=c||d&&this.parent.config._$typeName===d;var e=g({},this.parent.config);if(this.parent.params.forEach(function(d){c||delete e[d.name];try{d.check()}catch(f){p(a,f.message)}!b&&d._applyOne(a)}),!c)for(var f in e)void 0!==e[f]&&p(a,K("Unknown property: '%1'.",f))},r._applyOne=function(a){void 0!==this.v?a[this.name]=this.v:void 0!==this.defaultValue&&(a[this.name]=this.defaultValue)},r.MESSAGE_PREFIX="The '%1' parameter ",q}(),X=function(a,b){return new W(a,b)},Y=function(){var a=function(a){if("object"!=typeof a)throw new Error("Configuration parameter should be an object, instead it is a: "+typeof a);this.config=a,this.params=[]},b=a.prototype;return b.whereParam=function(a){var b=new W(this.config[a],a);return b.parent=this,this.params.push(b),b},a}(),Z=function(a){return new Y(a)};V.Param=W,V.assertParam=X,V.assertConfig=Z;var $=function(){function a(){}var b=function(b,c){this.name=b;var d=new a(c);d.parentEnum=this,this._symbolPrototype=d,c&&Object.keys(c).forEach(function(a){d[a]=c[a]})},c=b.prototype;return b.isSymbol=function(b){return b instanceof a},c.fromName=function(a){return this[a]},c.addSymbol=function(a){var b=Object.create(this._symbolPrototype);return a&&Object.keys(a).forEach(function(c){b[c]=a[c]}),setTimeout(function(){b.getName()},0),b},c.seal=function(){this.getSymbols().forEach(function(a){return a.getName()})},c.getSymbols=function(){return this.getNames().map(function(a){return this[a]},this)},c.getNames=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&("name"===b||"_"===b.substr(0,1)||D(this[b])||a.push(b));return a},c.contains=function(b){return b instanceof a?this[b.getName()]===b:!1},a.prototype.getName=function(){if(!this.name){var a=this;this.name=o(this.parentEnum.getNames(),function(b){return a.parentEnum[b]===a})}return this.name},a.prototype.toString=function(){return this.getName()},a.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},b}();V.Enum=$;var _=function(){function a(a,c,d){var e=a._subscribers;return e?(e.forEach(function(e){try{e.callback(c)}catch(f){f.context="unable to publish on topic: "+a.name,d?d(f):a._defaultErrorCallback?a._defaultErrorCallback(f):b(f)}}),void 0):!0}function b(){}var c={},d=1,e=function(a,b,d){X(a,"eventName").isNonEmptyString().check(),X(b,"publisher").isObject().check(),this.name=a,c[a]=!0,this.publisher=b,d&&(this._defaultErrorCallback=d)},f=e.prototype;return f.publish=function(b,c,d){return e._isEnabled(this.name,this.publisher)?(c===!0?setTimeout(a,0,this,b,d):a(this,b,d),!0):!1},f.publishAsync=function(a,b){this.publish(a,!0,b)},f.subscribe=function(a){this._subscribers||(this._subscribers=[]);var b=d;return this._subscribers.push({unsubKey:b,callback:a}),++d,b},f.unsubscribe=function(a){if(!this._subscribers)return!1;var b=this._subscribers,c=p(b,function(b){return b.unsubKey===a});return-1!==c?(b.splice(c,1),0===b.length&&(this._subscribers=null),!0):!1},f.clear=function(){this._subscribers=null},e.bubbleEvent=function(a,b){a._getEventParent=b},e.enable=function(a,b,c){X(a,"eventName").isNonEmptyString().check(),X(b,"obj").isObject().check(),X(c,"isEnabled").isBoolean().isOptional().or().isFunction().check(),b._$eventMap||(b._$eventMap={}),b._$eventMap[a]=c},e.isEnabled=function(a,b){if(X(a,"eventName").isNonEmptyString().check(),X(b,"obj").isObject().check(),!b._getEventParent)throw new Error("This object does not support event enabling/disabling");return e._isEnabled(b,a)},e._isEnabled=function(a,b){var c=null,d=b._$eventMap;if(d&&(c=d[a]),null!=c)return"function"==typeof c?c(b):!!c;var f=b._getEventParent&&b._getEventParent();return f?e._isEnabled(a,f):!0},e}();V.Event=_;var ab=function(){function a(a,b,c){var d=b.defaultInstance;return d||(d=new b.ctor,b.defaultInstance=d,d._$impl=b),d.initialize(),c&&(a.defaultInstance=d),e.interfaceInitialized.publish({interfaceName:a.name,instance:d,isDefault:!0}),d.checkForRecomposition&&e.interfaceInitialized.subscribe(function(a){d.checkForRecomposition(a)}),d}function d(a){var c=a.toLowerCase(),d=b(e.interfaceRegistry||{},function(a){return a.toLowerCase()===c});if(!d)throw new Error("Unknown interface name: "+a);return d.value}var e={};e.functionRegistry={},e.typeRegistry={},e.objectRegistry={},e.interfaceInitialized=new _("interfaceInitialized",e);var f=function(a){this.name=a,this.defaultInstance=null,this._implMap={}};return f.prototype.registerCtor=function(a,b){this._implMap[a.toLowerCase()]={ctor:b,defaultInstance:null}},f.prototype.getImpl=function(a){return this._implMap[a.toLowerCase()]},f.prototype.getFirstImpl=function(){var a=b(this._implMap,function(){return!0});return a?a.value:null},e.interfaceRegistry={ajax:new f("ajax"),modelLibrary:new f("modelLibrary"),dataService:new f("dataService")},e.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},e.setProperties=function(a){Z(a).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(a),a.remoteAccessImplementation&&e.initializeAdapterInstance("dataService",a.remoteAccessImplementation),a.trackingImplementation&&e.initializeAdapterInstance("modelLibrary",a.trackingImplementation),a.ajaxImplementation&&e.initializeAdapterInstance("ajax",a.ajaxImplementation)},e.registerAdapter=function(a,b){X(a,"interfaceName").isNonEmptyString().check(),X(b,"adapterCtor").isFunction().check();var c=new b,e=c.name;if(!e)throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");var f=d(a);f.registerCtor(e,b)},e.getAdapter=function(a,b){var c=d(a);if(b){var e=c.getImpl(b);return e?e.ctor:null}return c.defaultInstance?c.defaultInstance._$impl.ctor:null},e.initializeAdapterInstances=function(a){return Z(a).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().applyAll(this,!1),c(a,e.initializeAdapterInstance)},e.initializeAdapterInstance=function(b,c,e){e=void 0===e?!0:e,X(b,"interfaceName").isNonEmptyString().check(),X(c,"adapterName").isNonEmptyString().check(),X(e,"isDefault").isBoolean().check();var f=d(b),g=f.getImpl(c);if(!g)throw new Error("Unregistered adapter.  Interface: "+b+" AdapterName: "+c);return a(f,g,e)},e.getAdapterInstance=function(b,c){var e,f=d(b);return c&&""!==c?(e=f.getImpl(c),e?e.defaultInstance:null):f.defaultInstance?f.defaultInstance:(e=f.getFirstImpl(),e.defaultInstance?e.defaultInstance:a(f,e,!0))},e.registerFunction=function(a,b){X(a,"fn").isFunction().check(),X(b,"fnName").isString().check(),a.prototype._$fnName=b,e.functionRegistry[b]=a},e._storeObject=function(a,b,c){var d=("string"==typeof b?b:b.prototype._$typeName)+"."+c;e.objectRegistry[d]=a},e._fetchObject=function(a,b){if(!b)return void 0;var c=("string"==typeof a?a:a.prototype._$typeName)+"."+b,d=e.objectRegistry[c];if(!d)throw new Error("Unable to locate a registered object by the name: "+c);return d},e.registerType=function(a,b){X(a,"ctor").isFunction().check(),X(b,"typeName").isString().check(),a.prototype._$typeName=b,e.typeRegistry[b]=a},e.stringifyPad="",e}(),bb=ab.interfaceRegistry.modelLibrary;V.config=ab,S.config=ab;var cb=function(){function a(a){var b=a.getEntityAspect();b.entityState.isUnchanged()&&b.setModified(),b.entityState.isModified()&&!a._origValues&&(a._origValues=a.slice(0))}function b(a,b){a._processAdds(b),d(a,"arrayChanged",{array:a,added:b})}function c(a,b){a._processRemoves(b),d(a,"arrayChanged",{array:a,removed:b})}function d(a,b,c){var d=a._getPendingPubs();d?a._pendingArgs?e(a._pendingArgs,c):(a._pendingArgs=c,d.push(function(){a[b].publish(a._pendingArgs),a._pendingArgs=null})):a[b].publish(c)}function e(a,b){for(var c in b)if("array"!==c&&a.hasOwnProperty(c)){var d=b[c],e=a[c];if(e){if(!Array.isArray(e))throw new Error("Cannot combine non array args");Array.prototype.push.apply(e,d)}else a[c]=d}}function f(a,b,c){a.parent=b,a.parentProperty=c}var g={};return g.push=function(){if(this._inProgress)return-1;var a=this._getGoodAdds(U(arguments));if(!a.length)return this.length;this._beforeChange();var c=Array.prototype.push.apply(this,a);return b(this,a),c},g._push=function(){if(this._inProgress)return-1;var a=U(arguments);this._beforeChange();var c=Array.prototype.push.apply(this,a);return b(this,a),c},g.unshift=function(){var a=this._getGoodAdds(U(arguments));if(!a.length)return this.length;this._beforeChange();var c=Array.prototype.unshift.apply(this,a);return b(this,U(a)),c},g.pop=function(){this._beforeChange();var a=Array.prototype.pop.apply(this);return c(this,[a]),a},g.shift=function(){this._beforeChange();var a=Array.prototype.shift.apply(this);return c(this,[a]),a},g.splice=function(){var a=this._getGoodAdds(U(arguments,2)),d=U(arguments,0,2).concat(a);this._beforeChange();var e=Array.prototype.splice.apply(this,d);return c(this,e),a.length&&b(this,a),e},g.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()},g._getEventParent=function(){return this.getEntityAspect()},g._getPendingPubs=function(){var a=this.getEntityAspect().entityManager;return a&&a._pendingPubs},g._beforeChange=function(){},{mixin:g,publish:d,updateEntityState:a,initializeParent:f}}(),db=function(){function b(a,b,c,d,e){for(d=+a[b=a.length-1],e=0;b--;)c=+a[b],d+=++e%2?2*c%10+(c>4):c;return!(d%10)}function c(a,b,c,d){c&&(n.messageTemplates[a]=c);var e="string"==typeof b?new RegExp(b):b,f=function(a){return null==a||""===a?!0:"string"!=typeof a?!1:e.test(a)};return new n(a,f,d)}function d(a,b,c){return b?a.replace(/%([^%]+)%/g,function(a,d){var e;return e=c?b.hasOwnProperty(d)?b[d]:"":b[d],e?D(e)?e(b):e:""}):a}function e(a,b,c,d){return n.messageTemplates[a]=K("'%displayName%' must be an integer between the values of %1 and %2",b,c),function(){var e=function(a,d){return null==a?!0:("string"==typeof a&&d&&d.allowString&&(a=parseInt(a,0)),"number"!=typeof a||isNaN(a)||Math.floor(a)!==a?!1:null!=b&&b>a?!1:null!=c&&a>c?!1:!0)};return new n(a,e,d)}}var f=-32768,h=32767,i=-2147483648,j=2147483647,k=0,l=255,m={displayName:function(a){return a.property?a.property.displayName||a.propertyName||a.property.name:"Value"}},n=function(a,b,c){this._baseContext=c||{},this._baseContext.name=a,c=g(Object.create(m),this._baseContext),c.messageTemplate=c.messageTemplate||n.messageTemplates[a],this.name=a,this.valFn=b,this.context=c},o=n.prototype;return o._$typeName="Validator",o.validate=function(a,b){var c;c=b?g(Object.create(this.context),b):this.context,this.currentContext=c;try{return this.valFn(a,c)?null:(c.value=a,new eb(this,c,this.getMessage()))}catch(d){return new eb(this,c,"Exception occured while executing this validator: "+this.name)}},o.getMessage=function(){try{var a=this.currentContext,b=a.message;return b?"function"==typeof b?b(a):b:a.messageTemplate?d(a.messageTemplate,a):"invalid value: "+this.name||"{unnamed validator}"}catch(c){return"Unable to format error message"+c.toString()}},o.toJSON=function(){return this._baseContext},n.fromJSON=function(a){var b="Validator."+a.name,c=ab.functionRegistry[b];if(!c)throw new Error("Unable to locate a validator named:"+a.name);return c(a)},n.register=function(a){ab.registerFunction(function(){return a},"Validator."+a.name)},n.registerFactory=function(a,b){ab.registerFunction(a,"Validator."+b)},n.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"},n.required=function(a){var b=function(a,b){return"string"==typeof a?b&&b.allowEmptyStrings?!0:a.length>0:null!=a};return new n("required",b,a)},n.maxLength=function(a){var b=function(a,b){return null==a?!0:"string"!=typeof a?!1:a.length<=b.maxLength};return new n("maxLength",b,a)},n.stringLength=function(a){var b=function(a,b){return null==a?!0:"string"!=typeof a?!1:null!=b.minLength&&a.length<b.minLength?!1:null!=b.maxLength&&a.length>b.maxLength?!1:!0};return new n("stringLength",b,a)},n.string=function(){var a=function(a){return null==a?!0:"string"==typeof a};return new n("string",a)},n.guid=function(){var a=function(a){return null==a?!0:E(a)};return new n("guid",a)},n.duration=function(){var a=function(a){return null==a?!0:F(a)};return new n("duration",a)},n.number=n.double=n.single=function(a){var b=function(a,b){return null==a?!0:("string"==typeof a&&b&&b.allowString&&(a=parseInt(a,10)),"number"==typeof a&&!isNaN(a))};return new n("number",b,a)},n.integer=n.int64=function(a){var b=function(a,b){return null==a?!0:("string"==typeof a&&b&&b.allowString&&(a=parseInt(a,10)),"number"==typeof a&&!isNaN(a)&&Math.floor(a)===a)};return new n("integer",b,a)},n.int32=function(a){return e("int32",i,j,a)()},n.int16=function(a){return e("int16",f,h,a)()},n.byte=function(a){return e("byte",k,l,a)()},n.bool=function(){var a=function(a){return null==a?!0:a===!0||a===!1};return new n("bool",a)},n.none=function(){var a=function(){return!0};return new n("none",a)},n.date=function(){var a=function(a){if(null==a)return!0;if("string"!=typeof a)return C(a);try{return!isNaN(Date.parse(a))}catch(b){return!1}};return new n("date",a)},n.creditCard=function(a){function c(a){return null==a||""===a?!0:"string"!=typeof a?!1:(a=a.replace(/(\-|\s)/g,""),!a||/\D/.test(a)?!1:b(a))}return new n("creditCard",c,a)},n.regularExpression=function(a){function b(a,b){if(null==a||""===a)return!0;if("string"!=typeof a)return!1;try{var c=new RegExp(b.expression)}catch(d){throw new Error("Missing or invalid expression parameter to regExp validator")}return c.test(a)}return new n("regularExpression",b,a)},n.emailAddress=function(a){var b=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/;return c("emailAddress",b,null,a)},n.phone=function(a){var b=/^((\+|(0(\d+)?[-/.\s]?))[1-9]\d{0,2}[-/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-/.\s]?)?(\d+[-/.\s]?)+\d+$/;return c("phone",b,null,a)},n.url=function(a){var b=/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;return c("url",b,null,a)},n.makeRegExpValidator=c,a(n,function(a,b){"function"==typeof b&&"fromJSON"!==a&&"register"!==a&&"registerFactory"!==a&&"makeRegExpValidator"!==a&&ab.registerFunction(b,"Validator."+a)}),n}(),eb=function(){var a=function(a,b,c,d){X(a,"validator").isOptional().isInstanceOf(db).check(),X(c,"errorMessage").isNonEmptyString().check(),X(d,"key").isOptional().isNonEmptyString().check(),this.validator=a;var b=b||{};this.context=b,this.errorMessage=c,this.property=b.property,this.propertyName=b.propertyName||b.property&&b.property.name,this.key=d?d:eb.getKey(a||c,this.propertyName),this.isServerError=!1};return a.getKey=function(a,b){return(a.name||a)+(b?":"+b:"")},a}();S.Validator=db,S.ValidationError=eb;var fb=function(){function a(a,b){return b&&Z(b).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(a),a}var b=function(b){a(this,b)},c=b.prototype;
return c._$typeName="ValidationOptions",c.using=function(b){if(!b)return this;var c=new fb(this);return a(c,b),c},c.setAsDefault=function(){return i(this,b)},b.defaultInstance=new b({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),b}();S.ValidationOptions=fb,S.makeComplexArray=function(){function a(a,b){return b.filter(function(b){return b.parent!==a.parent})}function b(a,b){b.forEach(function(b){if(null!=b.parent)throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner");e(b,a)})}function c(a,b){b.forEach(function(b){d(b,a)})}function d(a,b){var c=a.complexAspect;return c.parent!==b.parent?null:(c.parent=null,c.parentProperty=null,c)}function e(a,b){var c=a.complexAspect;return c.parent===b.parent?null:(c.parent=b.parent,c.parentProperty=b.parentProperty,c)}function f(a,b,c){return cb.initializeParent(a,b,c),a.arrayChanged=new _("arrayChanged",a),g(a,cb.mixin),g(a,h)}var h={};return h._getGoodAdds=function(b){return a(this,b)},h._beforeChange=function(){cb.updateEntityState(this)},h._processAdds=function(a){b(this,a)},h._processRemoves=function(a){c(this,a)},h._rejectChanges=function(){if(this._origValues){var a=this;this.forEach(function(b){d(b,a)}),this.length=0,this._origValues.forEach(function(b){a.push(b)}),Array.prototype.push.apply(this,this._origValues)}},h._acceptChanges=function(){this._origValues=null},f}();var gb=function(){var a={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},b=new $("EntityAction",a);return b.Attach=b.addSymbol({isAttach:!0}),b.AttachOnQuery=b.addSymbol({isAttach:!0}),b.AttachOnImport=b.addSymbol({isAttach:!0}),b.Detach=b.addSymbol({isDetach:!0}),b.MergeOnQuery=b.addSymbol({isModification:!0}),b.MergeOnImport=b.addSymbol({isModification:!0}),b.MergeOnSave=b.addSymbol({isModification:!0}),b.PropertyChange=b.addSymbol({isModification:!0}),b.EntityStateChange=b.addSymbol(),b.AcceptChanges=b.addSymbol(),b.RejectChanges=b.addSymbol({isModification:!0}),b.Clear=b.addSymbol({isDetach:!0}),b.seal(),b}();S.EntityAction=gb;var hb=function(){function b(a){var c=a.entityAspect||a.complexAspect,d=a.entityType||a.complexType,e=c.originalValues;for(var f in e)a.setProperty(f,e[f]);d.complexProperties.forEach(function(c){var d=a.getProperty(c.name);c.isScalar?b(d):(d._rejectChanges(),d.forEach(function(a){b(a)}))})}function c(a){var b=a.entityAspect||a.complexAspect;b.originalValues={};var d=a.entityType||a.complexType;d.complexProperties.forEach(function(b){var d=a.getProperty(b.name);b.isScalar?c(d):(d._acceptChanges(),d.forEach(function(a){c(a)}))})}function d(a){var b=!0,c=a.entityType||a.complexType,e=a.entityAspect||a.complexAspect,f=a.entityAspect||a.complexAspect.getEntityAspect();return c.getProperties().forEach(function(c){var g=a.getProperty(c.name),h=e.getPropertyPath(c.name);if(c.validators.length>0){var i={entity:f.entity,property:c,propertyName:h};b=f._validateProperty(g,i)&&b}c.isComplexProperty&&c.isScalar&&(b=d(g)&&b)}),c.validators.forEach(function(a){b=i(f,a,e.entity)&&b}),b}function e(a,b){var c=b.isDeleted();c?g(a,!0):w(a.entityAspect.entityManager,"isLoading",!0,function(){g(a,!1)})}function g(a,b){a.entityType.navigationProperties.forEach(function(c){var d=c.inverse,e=a.getProperty(c.name);if(c.isScalar){if(e){if(d)if(d.isScalar)h(e,d,b);else{var f=e.getProperty(d.name);f.length&&q(f,a)}a.setProperty(c.name,null)}}else d&&e.slice(0).forEach(function(a){d.isScalar&&h(a,d,b)}),e.length=0})}function h(a,b,c){if(c)a.setProperty(b.name,null);else{var d=(a.entityAspect.entityManager,b.foreignKeyNames);if(d)var e=d.map(function(b){return a.getProperty(b)});a.setProperty(b.name,null),d&&d.forEach(function(b,c){a.setProperty(b,e[c])})}}function i(a,b,c,d){var e=b.validate(c,d);if(e)return a._addValidationError(e),!1;var f=eb.getKey(b,d?d.propertyName:null);return a._removeValidationError(f),!0}var j=function(a){if(null===a){var b=hb._nullInstance;if(b)return b;hb._nullInstance=this}else{if(void 0===a)throw new Error("The EntityAspect ctor requires an entity as its only argument.");if(a.entityAspect)return a.entityAspect}if(!(this instanceof hb))return new hb(a);if(this.entity=a,this.entityGroup=null,this.entityManager=null,this.entityState=kb.Detached,this.isBeingSaved=!1,this.originalValues={},this.hasValidationErrors=!1,this._validationErrors={},this.validationErrorsChanged=new _("validationErrorsChanged",this),this.propertyChanged=new _("propertyChanged",this),null!=a){a.entityAspect=this;var c=a.entityType||a._$entityType;if(!c){var d=a.prototype._$typeName;throw d?new Error("Metadata for this entityType has not yet been resolved: "+d):new Error("This entity is not registered as a valid EntityType")}var e=c.getEntityCtor();bb.getDefaultInstance().startTracking(a,e.prototype)}},k=j.prototype;return _.bubbleEvent(k,function(){return this.entityManager}),k.getKey=function(a){if(a=X(a,"forceRefresh").isBoolean().isOptional().check(!1),a||!this._entityKey){var b=this.entity.entityType,c=b.keyProperties,d=c.map(function(a){return this.entity.getProperty(a.name)},this);this._entityKey=new jb(b,d)}return this._entityKey},k.acceptChanges=function(){var a=this.entityManager;this.entityState.isDeleted()?a.detachEntity(this.entity):this.setUnchanged(),a.entityChanged.publish({entityAction:gb.AcceptChanges,entity:this.entity})},k.rejectChanges=function(){var a=this.entity,c=this.entityManager;w(c,"isRejectingChanges",!0,function(){b(a)}),this.entityState.isAdded()?(c.detachEntity(a),c._notifyStateChange(a,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(a),this.setUnchanged(),this.propertyChanged.publish({entity:a,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:gb.RejectChanges,entity:a}))},k.getPropertyPath=function(a){return a},k.setUnchanged=function(){c(this.entity),delete this.hasTempKey,this.entityState=kb.Unchanged,this.entityManager._notifyStateChange(this.entity,!1)},k.setModified=function(){this.entityState=kb.Modified,this.entityManager._notifyStateChange(this.entity,!0)},k.setDeleted=function(){var a=this.entityManager,b=this.entity;this.entityState.isAdded()?(a.detachEntity(b),a._notifyStateChange(b,!1)):(this.entityState=kb.Deleted,e(b,kb.Deleted),a._notifyStateChange(b,!0))},k.setDetached=function(){var a=this.entityGroup;if(!a)return!1;var b=this.entity;return a.detachEntity(b),e(b,kb.Detached),this.entityManager.entityChanged.publish({entityAction:gb.Detach,entity:b}),this._detach(),!0},k.loadNavigationProperty=function(a,b,c){var d=this.entity,e=d.entityType._checkNavProperty(a),f=zb.fromEntityNavigation(d,e);return d.entityAspect.entityManager.executeQuery(f,b,c)},k.validateEntity=function(){var a=!0;return this._processValidationOpAndPublish(function(b){a=d(b.entity)}),a},k.validateProperty=function(a,b){var c=this.getPropertyValue(a);return c&&c.complexAspect?d(c):(b=b||{},b.entity=this.entity,"string"==typeof a?(b.property=this.entity.entityType.getProperty(a,!0),b.propertyName=a):(b.property=a,b.propertyName=a.name),this._validateProperty(c,b))},k.getValidationErrors=function(a){X(a,"property").isOptional().isEntityProperty().or().isString().check();var b=f(this._validationErrors);if(a){var c="string"==typeof a?a:a.name;b=b.filter(function(a){return a.property&&a.property.name===c})}return b},k.addValidationError=function(a){X(a,"validationError").isInstanceOf(eb).check(),this._processValidationOpAndPublish(function(b){b._addValidationError(a)})},k.removeValidationError=function(a){X(a,"validationErrorOrKey").isString().or().isInstanceOf(eb).or().isInstanceOf(db).check();var b="string"==typeof a?a:a.key;this._processValidationOpAndPublish(function(a){a._removeValidationError(b)})},k.clearValidationErrors=function(){this._processValidationOpAndPublish(function(b){a(b._validationErrors,function(a,c){c&&(delete b._validationErrors[a],b._pendingValidationResult.removed.push(c))}),b.hasValidationErrors=!G(this._validationErrors)})},k.getParentKey=function(a){var b=a.foreignKeyNames;if(0===b.length)return null;var c=this,d=b.map(function(a){return c.entity.getProperty(a)});return new jb(a.entityType,d)},k.getPropertyValue=function(a){X(a,"property").isString().or().isEntityProperty().check();var b;if("string"==typeof a){var c=a.trim().split("."),d=c.shift();for(b=this.entity,b=b.getProperty(d);c.length>0;)d=c.shift(),b=b.getProperty(d)}else{if(!(a.parentType instanceof rb))throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' parameter instead ");b=this.entity.getProperty(a.name)}return b},k._detach=function(){this.entityGroup=null,this.entityManager=null,this.entityState=kb.Detached,this.originalValues={},this._validationErrors={},this.hasValidationErrors=!1,this.validationErrorsChanged.clear(),this.propertyChanged.clear()},k._validateProperty=function(a,b){var c=!0;return this._processValidationOpAndPublish(function(d){b.property.validators.forEach(function(e){c=i(d,e,a,b)&&c})}),c},k._processValidationOpAndPublish=function(a){if(this._pendingValidationResult)a(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]},a(this),(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&(this.validationErrorsChanged.publish(this._pendingValidationResult),this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult))}finally{this._pendingValidationResult=void 0}},k._addValidationError=function(a){this._validationErrors[a.key]=a,this.hasValidationErrors=!0,this._pendingValidationResult.added.push(a)},k._removeValidationError=function(a){var b=this._validationErrors[a];b&&(delete this._validationErrors[a],this.hasValidationErrors=!G(this._validationErrors),this._pendingValidationResult.removed.push(b))},j}(),ib=function(){var a=function(a,b,c){if(!a)throw new Error("The  ComplexAspect ctor requires an entity as its only argument.");if(a.complexAspect)return a.complexAspect;if(!(this instanceof ib))return new ib(a,b,c);this.complexObject=a,a.complexAspect=this,this.originalValues={},null!=b&&(this.parent=b,this.parentProperty=c);var d=a.complexType;if(!d){var e=a.prototype._$typeName;throw e?new Error("Metadata for this complexType has not yet been resolved: "+e):new Error("This entity is not registered as a valid ComplexType")}var f=d.getCtor();bb.getDefaultInstance().startTracking(a,f.prototype)},b=a.prototype;return b.getEntityAspect=function(){var a=this.parent;if(!a)return new hb(null);for(var b=a.entityAspect;a&&!b;)a=a.complexAspect&&a.complexAspect.parent,b=a&&a.entityAspect;return b||new hb(null)},b.getPropertyPath=function(a){var b=this.parent;if(!b)return null;var c=b.complexAspect||b.entityAspect;return c.getPropertyPath(this.parentProperty.name+"."+a)},a}();S.EntityAspect=hb,S.ComplexAspect=ib;var jb=function(){function a(a){return a.join(b)}var b=":::",c=function(b,c){X(b,"entityType").isInstanceOf(rb).check();var d=b.getSelfAndSubtypes();d.length>1&&(this._subtypes=d.filter(function(a){return a.isAbstract===!1})),Array.isArray(c)||(c=U(arguments,1)),this.entityType=b,b.keyProperties.forEach(function(a,b){a.dataType===lb.Guid&&(c[b]=c[b]&&c[b].toLowerCase())}),this.values=c,this._keyInGroup=a(c)};c._$typeName="EntityKey";var d=c.prototype;return d.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},c.fromJSON=function(a,b){var c=b._getEntityType(a.entityType,!0);return new jb(c,a.values)},d.equals=function(a){return a instanceof jb?this.entityType===a.entityType&&s(this.values,a.values):!1},d.toString=function(){return this.entityType.name+"-"+this._keyInGroup},c.equals=function(a,b){return a instanceof jb?a.equals(b):!1},d._isEmpty=function(){return 0===this.values.join("").length},c.createKeyString=a,c}();S.EntityKey=jb;var kb=function(){var a={isUnchanged:function(){return this===b.Unchanged},isAdded:function(){return this===b.Added},isModified:function(){return this===b.Modified},isDeleted:function(){return this===b.Deleted},isDetached:function(){return this===b.Detached},isUnchangedOrModified:function(){return this===b.Unchanged||this===b.Modified},isAddedModifiedOrDeleted:function(){return this===b.Added||this===b.Modified||this===b.Deleted}},b=new $("EntityState",a);return b.Unchanged=b.addSymbol(),b.Added=b.addSymbol(),b.Modified=b.addSymbol(),b.Deleted=b.addSymbol(),b.Detached=b.addSymbol(),b.seal(),b}();S.EntityState=kb,S.makePrimitiveArray=function(){function a(a,c,d){return cb.initializeParent(a,c,d),a.arrayChanged=new _("arrayChanged",a),g(a,cb.mixin),g(a,b)}var b={};return b._getGoodAdds=function(a){return a},b._beforeChange=function(){var a=this.getEntityAspect();a.entityState.isUnchanged()&&a.setModified(),a.entityState.isModified()&&!this._origValues&&(this._origValues=this.slice(0))},b._processAdds=function(){},b._processRemoves=function(){},b._rejectChanges=function(){this._origValues&&(this.length=0,Array.prototype.push.apply(this,this._origValues))},b._acceptChanges=function(){this._origValues=null},a}(),S.makeRelationArray=function(){function a(a,b){var c=d(a,b);if(!c.length)return c;var e=a.parentEntity,f=e.entityAspect.entityManager;return f&&!f.isLoading&&c.forEach(function(b){if(b.entityAspect.entityState.isDetached()){a._inProgress=!0;try{f.attachEntity(b,kb.Added)}finally{a._inProgress=!1}}}),c}function b(a,b){var c=a.parentEntity,d=a.navigationProperty,e=a._addsInProcess,f=d.inverse,g=e.length;try{b.forEach(function(a){if(e.push(a),f)a.setProperty(f.name,c);else{var b=c.entityType.keyProperties;d.invForeignKeyNames.forEach(function(d,e){a.setProperty(d,c.getProperty(b[e].name))})}})}finally{e.splice(g,b.length)}}function c(a,b){var c=a.navigationProperty.inverse;c&&b.forEach(function(a){a.setProperty(c.name,null)})}function d(a,b){var c,d=a.parentEntity,e=a.navigationProperty,f=e.inverse;if(f)c=b.filter(function(b){if(a._addsInProcess.indexOf(b)>=0)return!1;var c=b.getProperty(f.name);return c!==d});else{var g=e.invForeignKeyNames,h=d.entityType.keyProperties;c=b.filter(function(b){return a._addsInProcess.indexOf(b)>=0?!1:g.some(function(a,c){var e=h[c].name,f=d.getProperty(e),g=b.getProperty(a);return f!==g})})}return c}function e(a,b,c){return a.parentEntity=b,a.navigationProperty=c,a.arrayChanged=new _("arrayChanged",a),a._addsInProcess=[],g(a,cb.mixin),g(a,f)}var f={};return f.load=function(a,b){var c=this.parentEntity,d=zb.fromEntityNavigation(this.parentEntity,this.navigationProperty),e=c.entityAspect.entityManager;return e.executeQuery(d,a,b)},f._getEventParent=function(){return this.parentEntity.entityAspect},f._getPendingPubs=function(){var a=this.parentEntity.entityAspect.entityManager;return a&&a._pendingPubs},f._getGoodAdds=function(b){return a(this,b)},f._processAdds=function(a){b(this,a)},f._processRemoves=function(a){c(this,a)},e}();var lb=function(){function a(a,b){throw a=K(a,b),new Error(a)}function b(a){switch(a){case x.String:return db.string;case x.Int64:return db.int64;case x.Int32:return db.int32;case x.Int16:return db.int16;case x.Decimal:return db.number;case x.Double:return db.number;case x.Single:return db.number;case x.DateTime:return db.date;case x.DateTimeOffset:return db.date;case x.Boolean:return db.bool;case x.Guid:return db.guid;case x.Byte:return db.byte;case x.Binary:return db.none;case x.Time:return db.duration;case x.Undefined:return db.none}}var c={},d={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1},e=function(){return d.stringPrefix+f().toString()},f=function(){var a=d.nextNumber;return d.nextNumber+=d.nextNumberIncrement,a},g=function(){return z()},h=function(){return new Date},i=function(a){return null==a?a:a.toString()},j=function(a,b){if("string"===b){var c=a.trim();if(""===c)return null;var d=parseInt(c,10);return isNaN(d)?a:d}return"number"===b?Math.round(a):a},k=function(a,b){if("string"===b){var c=a.trim();if(""===c)return null;var d=parseFloat(c);return isNaN(d)?a:d}return a},l=function(a,b){var c;if("string"===b){var d=a.trim();return""===d?null:(c=new Date(Date.parse(d)),C(c)?c:a)}return"number"===b?(c=new Date(a),C(c)?c:a):a},m=function(a,b){if("string"===b){var c=a.trim().toLowerCase();return"false"===c||""===c?!1:"true"===c?!0:a}return a},n=function(a){return null==a?null:"'"+a.replace(/'/g,"''")+"'"},o=function(a){return null==a?null:"string"==typeof a?parseInt(a,10):a},p=function(a){return function(b){return null==b?null:("string"==typeof b&&(b=parseFloat(b)),b+a)}},q=function(b){if(null==b)return null;try{return"datetime'"+b.toISOString()+"'"}catch(c){a("'%1' is not a valid dateTime",b)}},r=function(b){if(null==b)return null;try{return"datetimeoffset'"+b.toISOString()+"'"}catch(c){a("'%1' is not a valid dateTime",b)}},s=function(b){return null==b?null:(F(b)||a("'%1' is not a valid ISO 8601 duration",b),"time'"+b+"'")},t=function(b){return null==b?null:(E(b)||a("'%1' is not a valid guid",b),"guid'"+b+"'")},u=function(a){return null==a?null:"string"==typeof a?"true"===a.trim().toLowerCase():!!a},v=function(a){return null==a?a:"binary'"+a+"'"},w=function(a){return a},x=new $("DataType",c);x.String=x.addSymbol({defaultValue:"",parse:i,fmtOData:n,getNext:e}),x.Int64=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:j,fmtOData:p("L"),getNext:f}),x.Int32=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:j,fmtOData:o,getNext:f}),x.Int16=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:j,fmtOData:o,getNext:f}),x.Byte=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:j,fmtOData:o}),x.Decimal=x.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,parse:k,fmtOData:p("m"),getNext:f}),x.Double=x.addSymbol({defaultValue:0,isNumeric:!0,parse:k,fmtOData:p("d"),getNext:f}),x.Single=x.addSymbol({defaultValue:0,isNumeric:!0,parse:k,fmtOData:p("f"),getNext:f}),x.DateTime=x.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:l,fmtOData:q,getNext:h}),x.DateTimeOffset=x.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:l,fmtOData:r,getNext:h}),x.Time=x.addSymbol({defaultValue:"PT0S",fmtOData:s}),x.Boolean=x.addSymbol({defaultValue:!1,parse:m,fmtOData:u}),x.Guid=x.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",fmtOData:t,getNext:g}),x.Binary=x.addSymbol({defaultValue:null,fmtOData:v}),x.Undefined=x.addSymbol({defaultValue:void 0,fmtOData:w}),x.seal(),x.fromEdmDataType=function(a){var b=null,c=a.split(".");if(c.length>1){var d=c[1];b="image"===d?x.Byte:2===c.length?x.fromName(d)||x.Undefined:x.String}return b},x.fromValue=function(a){if(C(a))return x.DateTime;switch(typeof a){case"string":return E(a)?x.Guid:F(a)&&a.length>3?x.Time:x.String;case"boolean":return x.Boolean;case"number":return x.Int32}return x.Undefined};var y=/.\d{3}$/;return x.parseTimeFromServer=function(a){if("string"==typeof a)return a;if(a&&"Edm.Time"===a.__edmType){var b=Math.floor(a.ms/1e3);return"PT"+b+"S"}return a},x.parseDateAsUTC=function(a){if("string"==typeof a){var b=y.test(a);a=b?a+"Z":a}return a=new Date(Date.parse(a))},x.parseDateFromServer=x.parseDateAsUTC,x.parseRawValue=function(a,b){return void 0===a?void 0:(b.isDate&&a?C(a)||(a=x.parseDateFromServer(a)):b===x.Binary?a&&void 0!==a.$value&&(a=a.$value):b===x.Time&&(a=x.parseTimeFromServer(a)),a)},x.constants=d,x.getSymbols().forEach(function(a){a.validatorCtor=b(a)}),x}();S.DataType=lb;var mb=function(){function a(a,b){return b&&(Z(b).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(nb).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(a),a.serviceName=a.serviceName&&mb._normalizeServiceName(a.serviceName),a.adapterInstance=a.adapterName&&ab.getAdapterInstance("dataService",a.adapterName)),a}var b=function(b){a(this,b)},c=b.prototype;return c._$typeName="DataService",c.using=function(b){if(!b)return this;var c=new mb(this);return a(c,b)},b.resolve=function(a){a.push({hasServerMetadata:!0,useJsonp:!1});var b=new mb(l(a,["serviceName","adapterName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!b.serviceName)throw new Error("Unable to resolve a 'serviceName' for this dataService");return b.adapterInstance=b.adapterInstance||ab.getAdapterInstance("dataService",b.adapterName),b.jsonResultsAdapter=b.jsonResultsAdapter||b.adapterInstance.jsonResultsAdapter,b},b._normalizeServiceName=function(a){return a=a.trim(),"/"!==a.substr(-1)?a+"/":a},c.toJSON=function(){return j(this,{serviceName:null,adapterName:null,hasServerMetadata:null,jsonResultsAdapter:function(a){return a&&a.name},useJsonp:null})},b.fromJSON=function(a){return a.jsonResultsAdapter=ab._fetchObject(nb,a.jsonResultsAdapter),new mb(a)},c.makeUrl=function(a){var b=this.serviceName;return V.stringEndsWith(b,"/")&&(b=b.substr(0,b.length-1)),a="/"+a,V.stringEndsWith(b,a)||(b+=a),b},b}(),nb=function(){function a(a){return a.results}var b=function(b){if(1!==arguments.length)throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");Z(b).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(a).whereParam("visitNode").isFunction().applyAll(this),ab._storeObject(this,c._$typeName,this.name)},c=b.prototype;return c._$typeName="JsonResultsAdapter",b}();S.DataService=mb,S.JsonResultsAdapter=nb;var ob=v("Q");ob||(ob=function(){var a="Q is undefined. Are you missing Q.js? See https://github.com/kriskowal/q";throw new Error(a)},ob.defer=ob.resolve=ob.reject=ob),S.config.setQ=function(a){ob=a};var pb=function(){function a(a){var b=[];for(var c in a){var d=a[c];c===d.name&&b.push(a[c])}return b}function b(a,b,c){var e=O(b.shortName,b.namespace),g=a._getEntityType(e,!0);if(g)return c?d(g,b):g;var h={shortName:b.shortName,namespace:b.namespace,isAbstract:b.isAbstract,autoGeneratedKeyType:vb.fromName(b.autoGeneratedKeyType),defaultResourceName:b.defaultResourceName,custom:b.custom};if(g=b.isComplexType?new sb(h):new rb(h),b.baseTypeName){g.baseTypeName=b.baseTypeName;var i=a._getEntityType(b.baseTypeName,!0);i?f(a,b,g,i):t(a._deferredTypes,b.baseTypeName).push({json:b,stype:g})}else f(a,b,g,null);return g}function d(a,b){return b.custom&&(a.custom=b.custom),e(a,b.dataProperties),e(a,b.navigationProperties),a}function e(a,b){b&&b.forEach(function(b){var c=b.name;if(!c){if(!b.nameOnServer)throw new Error("Unable to complete 'importMetadata' - cannot locate a 'name' or 'nameOnServer' for one of the imported property nodes");c=a.metadataStore.namingConvention.serverPropertyNameToClient(b.nameOnServer,{})}if(b.custom){var d=a.getProperty(c,!0);d.custom=b.custom}})}function f(a,b,c,d){b.validators&&(c.validators=b.validators.map(db.fromJSON)),d&&(c.baseEntityType=d,d.dataProperties.forEach(function(a){var b=new tb(a);b.isInherited=!0,c.addProperty(b)}),d.navigationProperties.forEach(function(a){var b=new ub(a);b.isInherited=!0,c.addProperty(b)})),b.dataProperties.forEach(function(a){c.addProperty(tb.fromJSON(a))});var e=!b.isComplexType;e&&b.navigationProperties&&b.navigationProperties.forEach(function(a){c.addProperty(ub.fromJSON(a))}),a.addEntityType(c);var g=a._deferredTypes,h=g[c.name];h&&(h.forEach(function(b){f(a,b.json,b.stype,c)}),delete g[c.name])}function h(a,b,c){if(N(b))return b;var d=a._shortNameMap[b];if(!d&&c)throw new Error("Unable to locate 'entityTypeName' of: "+b);return d}var i=0,j=function(a){a=a||{},Z(a).whereParam("namingConvention").isOptional().isInstanceOf(yb).withDefault(yb.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(xb).withDefault(xb.defaultInstance).whereParam("serializerFn").isOptional().isFunction().applyAll(this),this.dataServices=[],this._resourceEntityTypeMap={},this._structuralTypeMap={},this._shortNameMap={},this._ctorRegistry={},this._incompleteTypeMap={},this._incompleteComplexTypeMap={},this._id=i++},k=j.prototype;return k._$typeName="MetadataStore",j.ANONTYPE_PREFIX="_IB_",k.setProperties=function(a){Z(a).whereParam("name").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().applyAll(this)},k.addDataService=function(a,b){X(a,"dataService").isInstanceOf(mb).check(),X(b,"shouldOverwrite").isBoolean().isOptional().check();var c=this._getDataServiceIndex(a.serviceName);if(c>=0){if(!b)throw new Error("A dataService with this name '"+a.serviceName+"' already exists in this MetadataStore");this.dataServices[c]=a}else this.dataServices.push(a)},k._getDataServiceIndex=function(a){return p(this.dataServices,function(b){return b.serviceName===a})},k.addEntityType=function(a){if(a instanceof rb||a instanceof sb||(a=a.isComplexType?new sb(a):new rb(a)),!a.isComplexType&&0===a.keyProperties.length&&!a.isAbstract)throw new Error("Unable to add "+a.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.");if(a.metadataStore=this,!a.isAnonymous){if(this._structuralTypeMap[a.name])throw new Error("Type "+a.name+" already exists in this MetadataStore.");this._structuralTypeMap[a.name]=a,this._shortNameMap[a.shortName]=a.name}if(a.getProperties().forEach(function(b){a._updateNames(b),b.isUnmapped||a._mappedPropertiesCount++}),a._updateCps(),!a.isComplexType){a._updateNps();var b=a.defaultResourceName||a.baseEntityType&&a.baseEntityType.defaultResourceName;b&&!this.getEntityTypeNameForResourceName(b)&&this.setEntityTypeForResourceName(b,a.name),a.defaultResourceName=b,a.getEntityCtor()}a.baseEntityType&&a.baseEntityType.subtypes.push(a)},k.exportMetadata=function(){var a=JSON.stringify({metadataVersion:S.metadataVersion,name:this.name,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:c(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,ab.stringifyPad);return a},k.importMetadata=function(a,c){X(c,"allowMerge").isOptional().isBoolean().check(),this._deferredTypes={};var d="string"==typeof a?JSON.parse(a):a;if(d.schema)return qb.parse(this,d.schema,d.altMetadata);if(d.metadataVersion&&d.metadataVersion!==S.metadataVersion){var e=K("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",d.metadataVersion,S.metadataVersion);throw new Error(e)}var f=d.namingConvention,h=d.localQueryComparisonOptions;if(this.isEmpty())this.namingConvention=ab._fetchObject(yb,f)||this.namingConvention,this.localQueryComparisonOptions=ab._fetchObject(xb,h)||this.localQueryComparisonOptions;else{if(f&&this.namingConvention.name!==f)throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(h&&this.localQueryComparisonOptions.name!==h)throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore")}var i=this;d.dataServices&&d.dataServices.forEach(function(a){a=mb.fromJSON(a),i.addDataService(a,!0)});this._structuralTypeMap;return d.structuralTypes&&d.structuralTypes.forEach(function(a){b(i,a,c)}),g(this._resourceEntityTypeMap,d.resourceEntityTypeMap),g(this._incompleteTypeMap,d.incompleteTypeMap),this},j.importMetadata=function(a){var b=new pb;return b.importMetadata(a),b},k.hasMetadataFor=function(a){return!!this.getDataService(a)},k.getDataService=function(a){return X(a,"serviceName").isString().check(),a=mb._normalizeServiceName(a),o(this.dataServices,function(b){return b.serviceName===a})},k.fetchMetadata=function(a,b,c){if(X(a,"dataService").isString().or().isInstanceOf(mb).check(),X(b,"callback").isFunction().isOptional().check(),X(c,"errorCallback").isFunction().isOptional().check(),"string"==typeof a&&(a=this.getDataService(a)||new mb({serviceName:a})),a=mb.resolve([a]),this.hasMetadataFor(a.serviceName))throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+a.serviceName);return a.adapterInstance.fetchMetadata(this,a).then(function(a){return b&&b(a),ob.resolve(a)},function(a){return c&&c(a),ob.reject(a)})},k.trackUnmappedType=function(a,b){X(a,"entityCtor").isFunction().check(),X(b,"interceptor").isFunction().isOptional().check();var c=new rb(this);c._setCtor(a,b)},k.registerEntityTypeCtor=function(a,b,c,d){X(a,"structuralTypeName").isString().check(),X(b,"aCtor").isFunction().isOptional().check(),X(c,"initFn").isOptional().isFunction().or().isString().check(),X(d,"noTrackingFn").isOptional().isFunction().check();var e=h(this,a,!1),f=e||a;if(this._ctorRegistry[f]={ctor:b,initFn:c,noTrackingFn:d},e){var g=this._structuralTypeMap[e];g&&g.getCtor(!0)}},k.toQueryString=function(a){if(!a)throw new Error("query cannot be empty");if("string"==typeof a)return a;if(a instanceof zb)return a._toUri(this);throw new Error("unable to recognize query parameter as either a string or an EntityQuery")},k.isEmpty=function(){return G(this._structuralTypeMap)},k.getEntityType=function(a,b){return X(a,"structuralTypeName").isString().check(),X(b,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(a,b)},k._getEntityType=function(a,b){var c=h(this,a,!1),d=this._structuralTypeMap[c];if(!d){if(b)return null;var e=K("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",a);throw new Error(e)}if(d.length){var f=d.join(",");throw new Error("There are multiple types with this 'shortName': "+f)}return d},k.getEntityTypes=function(){return a(this._structuralTypeMap)},k.getIncompleteNavigationProperties=function(){return c(this._incompleteTypeMap,function(a,b){return b})},k.getEntityTypeNameForResourceName=function(a){return X(a,"resourceName").isString().check(),this._resourceEntityTypeMap[a]},k.setEntityTypeForResourceName=function(a,b){X(a,"resourceName").isString().check(),X(b,"entityTypeOrName").isInstanceOf(rb).or().isString().check();var c;c=b instanceof rb?b.name:h(this,b,!0),this._resourceEntityTypeMap[a]=c;var d=this._getEntityType(c,!0);d&&!d.defaultResourceName&&(d.defaultResourceName=a)},k._checkEntityType=function(a){if(!a.entityType){var b=a.prototype._$typeName;if(!b)throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");var c=this._getEntityType(b);c&&(a.entityType=c)}},j}(),qb=function(){function a(a,c,e){a._entityTypeResourceMap={},m(c).forEach(function(c){if(c.cSpaceOSpaceMapping){var e=JSON.parse(c.cSpaceOSpaceMapping),f={};e.forEach(function(a){f[a[0]]=a[1]}),c.cSpaceOSpaceMapping=f}c.entityContainer&&m(c.entityContainer).forEach(function(b){m(b.entitySet).forEach(function(b){var d=p(b.entityType,c).typeName;a.setEntityTypeForResourceName(b.name,d),a._entityTypeResourceMap[d]=b.name})}),c.complexType&&m(c.complexType).forEach(function(b){d(b,c,a)}),c.entityType&&m(c.entityType).forEach(function(d){b(d,c,a)})});var f=a.getIncompleteNavigationProperties();if(f.length>0)throw new Error("Bad nav properties");return e&&a.importMetadata(e,!0),a}function b(a,b,d){var e=a.name,f=q(e,b),g=new rb({shortName:e,namespace:f,isAbstract:a.abstract&&"true"===a.abstract});if(a.baseType){var h=p(a.baseType,b).typeName;g.baseTypeName=h;var i=d._getEntityType(h,!0);if(i)c(g,a,b,d,i);else{var j=d._deferredTypes[h];j||(j=[],d._deferredTypes[h]=j),j.push({entityType:g,csdlEntityType:a})}}else c(g,a,b,d,null);return g}function c(a,b,d,g,h){var j=[];h&&(a.baseEntityType=h,a.autoGeneratedKeyType=h.autoGeneratedKeyType,j=h.keyProperties.map(e("name")),h.dataProperties.forEach(function(b){var c=new tb(b);c.isInherited=!0,a.addProperty(c)}),h.navigationProperties.forEach(function(b){var c=new ub(b);c.isInherited=!0,a.addProperty(c)}));var k=b.key?m(b.key.propertyRef).map(e("name")):[];k=j.concat(k),m(b.property).forEach(function(b){f(a,b,d,k)}),m(b.navigationProperty).forEach(function(b){i(a,b,d)
}),g.addEntityType(a),a.defaultResourceName=g._entityTypeResourceMap[a.name];var l=g._deferredTypes,n=l[a.name];n&&(n.forEach(function(b){c(b.entityType,b.csdlEntityType,d,g,a)}),delete l[a.name])}function d(a,b,c){var d=a.name,e=q(d,b),g=new sb({shortName:d,namespace:e});return m(a.property).forEach(function(a){f(g,a,b)}),c.addEntityType(g),g}function f(a,b,c,d){var e,f=b.type.split(".");return 2===f.length?e=g(a,b,d):j(b,c)?(e=g(a,b,d),e&&(e.enumType=b.type)):e=h(a,b,c),e&&(a.addProperty(e),k(e)),e}function g(a,b,c){var d=lb.fromEdmDataType(b.type);if(null==d)return a.warnings.push("Unable to recognize DataType for property: "+b.name+" DateType: "+b.type),null;var e="true"===b.nullable||null==b.nullable,f=null!=c&&c.indexOf(b.name)>=0;f&&a.autoGeneratedKeyType===vb.None&&l(b)&&(a.autoGeneratedKeyType=vb.Identity);var g=b.maxLength;g=null==g||"Max"===g?null:parseInt(g,10);var h=new tb({nameOnServer:b.name,dataType:d,isNullable:e,isPartOfKey:f,maxLength:g,defaultValue:b.defaultValue,concurrencyMode:b.concurrencyMode});return d===lb.Undefined&&(h.rawTypeName=b.type),h}function h(a,b,c){var d=p(b.type,c).typeName,e=new tb({nameOnServer:b.name,complexTypeName:d,isNullable:!1});return e}function i(a,b,c){var d=n(b,c),f=o(d.end,function(a){return a.role===b.toRole}),g="*"!==f.multiplicity,h=p(f.type,c).typeName,i=d.referentialConstraint;if(i){var j={nameOnServer:b.name,entityTypeName:h,isScalar:g,associationName:d.name},k=i.principal,l=i.dependent,q=m(l.propertyRef),r=q.map(e("name"));b.fromRole===k.role?j.invForeignKeyNamesOnServer=r:j.foreignKeyNamesOnServer=r;var s=new ub(j);return a.addProperty(s),s}}function j(a,b){if(!b.enumType)return!1;var c=m(b.enumType),d=a.type.split("."),e=d[d.length-1];return c.some(function(a){return a.name===e})}function k(a){var b;if(a.isNullable||a.validators.push(db.required()),!a.isComplexProperty){if(a.dataType===lb.String)if(a.maxLength){var c={maxLength:a.maxLength};b=db.maxLength(c)}else b=db.string();else b=a.dataType.validatorCtor();a.validators.push(b)}}function l(a){var b=o(Object.keys(a),function(a){return a.indexOf("StoreGeneratedPattern")>=0});if(b)return"Identity"===a[b];var c=a.extensions;if(!c)return!1;var d=o(c,function(a){return"StoreGeneratedPattern"===a.name&&"Identity"===a.value});return!!d}function n(a,b){var c=p(a.relationship,b).shortTypeName,d=b.association;if(!d)return null;Array.isArray(d)||(d=[d]);var e=o(d,function(a){return a.name===c});return e}function p(a,b){if(!a)return null;if(I(a,pb.ANONTYPE_PREFIX))return{shortTypeName:a,namespace:"",typeName:a,isAnonymous:!0};var c=a.split(",")[0],d=c.split(".");if(d.length>1){var e,f=d[d.length-1];if(b)e=q(f,b);else{var g=d.slice(0,d.length-1);e=g.join(".")}return{shortTypeName:f,namespace:e,typeName:O(f,e)}}return{shortTypeName:a,namespace:"",typeName:a}}function q(a,b){var c,d=b.cSpaceOSpaceMapping;if(d){var e=d[b.namespace+"."+a];c=e&&e.substr(0,e.length-(a.length+1))}return c||b.namespace}var r=y(function(a){return a&&p(a).typeName});return{parse:a,normalizeTypeName:r}}(),rb=function(){function a(a,b){return a.entityAspect||a.complexAspect?a.getProperty(b.name):a[b.name]}function b(){return function(){}}function c(a){return a.filter(function(a){return!a.isInherited})}function f(a,b,c){var d=c+"OnServer",e=b[c];if(e&&e.length){if(b.isUnmapped)return;var f=m(e).map(function(c){var d=a.clientPropertyNameToServer(c,b),e=a.serverPropertyNameToClient(d,b);if(c!==e)throw new Error("NamingConvention for this client property name does not roundtrip properly:"+c+"-->"+e);return d});b[d]=Array.isArray(e)?f:f[0]}else{var g=b[d];if(!g||0===g.length)return;var h=m(g).map(function(c){var d=a.serverPropertyNameToClient(c,b),e=a.clientPropertyNameToServer(d,b);if(c!==e)throw new Error("NamingConvention for this server property name does not roundtrip properly:"+c+"-->"+e);return d});b[c]=Array.isArray(g)?h:h[0]}}function g(a,b){var c=b._getEntityType(a.complexTypeName,!0);if(!c)return!1;if(!(c instanceof sb))throw new Error("Unable to resolve ComplexType with the name: "+a.complexTypeName+" for the property: "+property.name);return a.dataType=c,a.defaultValue=null,!0}function h(a,b){var c=b._getEntityType(a.entityTypeName,!0);if(!c)return!1;a.entityType=c;var d=o(c.navigationProperties,function(b){return b.associationName===a.associationName&&(b.name!==a.name||b.entityTypeName!==a.entityTypeName)});return a.inverse=d,d||a.invForeignKeyNames.forEach(function(b){var d=c.getDataProperty(b),e=a.parentType;d.inverseNavigationProperty=o(e.navigationProperties,function(a){return a.invForeignKeyNames&&a.invForeignKeyNames.indexOf(d.name)>=0&&a.entityType===d.parentType}),i(c.foreignKeyProperties,d)}),k(a),!0}function i(a,b){var c=a.indexOf(b);-1===c&&a.push(b)}function k(a){var b=a.foreignKeyNames;if(0!==b.length){var c=a.parentType,d=b.map(function(a){return c.getDataProperty(a)}),e=c.foreignKeyProperties;d.forEach(function(b){i(e,b),b.relatedNavigationProperty=a,a.relatedDataProperties?a.relatedDataProperties.push(b):a.relatedDataProperties=[b]})}}function l(a,b){var c=a.getPropertyNames(),d=bb.getDefaultInstance().getTrackablePropertyNames(b);d.forEach(function(b){if(-1===c.indexOf(b)){var d=new tb({name:b,dataType:lb.Undefined,isNullable:!0,isUnmapped:!0});a.subtypes?a.getSelfAndSubtypes().forEach(function(a){a.addProperty(new tb(d))}):a.addProperty(d)}})}var n=0,p=function(a){if(arguments.length>1)throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");"MetadataStore"===a._$typeName?(this.metadataStore=a,this.shortName="Anon_"+ ++n,this.namespace="",this.isAnonymous=!0):Z(a).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(vb).isOptional().withDefault(vb.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().whereParam("serializerFn").isOptional().isFunction().whereParam("custom").isOptional().applyAll(this),this.name=O(this.shortName,this.namespace),this.dataProperties=[],this.navigationProperties=[],this.complexProperties=[],this.keyProperties=[],this.foreignKeyProperties=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.validators=[],this.warnings=[],this._mappedPropertiesCount=0,this.subtypes=[],P(this,a.dataProperties,tb),P(this,a.navigationProperties,ub)},q=p.prototype,r=lb.parseRawValue;return q._$typeName="EntityType",q.setProperties=function(a){Z(a).whereParam("autoGeneratedKeyType").isEnumOf(vb).isOptional().whereParam("defaultResourceName").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().whereParam("custom").isOptional().applyAll(this),a.defaultResourceName&&(this.defaultResourceName=a.defaultResourceName)},q.isSubtypeOf=function(a){X(a,"entityType").isInstanceOf(rb).check();var b=this;do{if(b===a)return!0;b=b.baseEntityType}while(b);return!1},q.getSelfAndSubtypes=function(){var a=[this];return this.subtypes.forEach(function(b){var c=b.getSelfAndSubtypes();a.push.apply(a,c)}),a},q.addProperty=function(a){if(X(a,"dataProperty").isInstanceOf(tb).or().isInstanceOf(ub).check(),this.metadataStore&&!a.isUnmapped)throw new Error("The '"+this.name+"' EntityType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(a.parentType){if(a.parentType!==this)throw new Error("This dataProperty has already been added to "+a.parentType.name);return this}return a.parentType=this,a.isDataProperty?this._addDataProperty(a):this._addNavigationProperty(a),this},q.createEntity=function(b){if(b&&b._$eref&&!b._$eref.entityAspect.entityManager)return b._$eref;var c=this._createInstanceCore();return b&&(this.keyProperties.every(function(a){return null!=b[a.name]})&&(b._$eref=c),this._updateTargetFromRaw(c,b,a),this.navigationProperties.forEach(function(a){var d,e=b[a.name];if(void 0!=e){var f=a.entityType;if(a.isScalar)d=e.entityAspect?e:f.createEntity(e),c.setProperty(a.name,d);else{var g=c.getProperty(a.name);e.forEach(function(a){d=a.entityAspect?a:f.createEntity(a),g.push(d)})}}})),this._initializeInstance(c),c},q._createInstanceCore=function(){var a=this.getEntityCtor(),b=new a;return new hb(b),b},q._initializeInstance=function(a){this.baseEntityType&&this.baseEntityType._initializeInstance(a);var b=this.initFn;b&&("string"==typeof b&&(b=a[b]),b(a)),this.complexProperties&&this.complexProperties.forEach(function(b){var c=a.getProperty(b.name);Array.isArray(c)?c.forEach(function(a){b.dataType._initializeInstance(a)}):b.dataType._initializeInstance(c)}),a.entityAspect&&(a.entityAspect._initialized=!0)},q.getCtor=q.getEntityCtor=function(a){if(this._ctor&&!a)return this._ctor;var c=this.metadataStore._ctorRegistry,d=c[this.name]||c[this.shortName]||{},e=d.ctor||this._ctor;if(e&&e.prototype.entityType&&e.prototype.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot register the same constructor for "+this.name+" in different metadata stores.  Please define a separate constructor for each metadata store.");if(d.ctor&&a&&(this._extra=void 0),!e){var f=bb.getDefaultInstance().createCtor;e=f?f(this):b()}return this.initFn=d.initFn,this.noTrackingFn=d.noTrackingFn,e.prototype._$typeName=this.name,this._setCtor(e),e},q._setCtor=function(a,b){var c=a.prototype;this._extra=this._extra||{};var d=new a;l(this,d),"EntityType"===this._$typeName?c.entityType=this:c.complexType=this,c._$interceptor=b||M,bb.getDefaultInstance().initializeEntityPrototype(c),this._ctor=a},q.addValidator=function(a,b){X(a,"validator").isInstanceOf(db).check(),X(b,"property").isOptional().isString().or().isEntityProperty().check(),b?("string"==typeof b&&(b=this.getProperty(b,!0)),b.validators.push(a)):this.validators.push(a)},q.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},q.getPropertyNames=function(){return this.getProperties().map(e("name"))},q.getDataProperty=function(a,b){var c=b?"nameOnServer":"name";return o(this.dataProperties,d(c,a))},q.getNavigationProperty=function(a,b){var c=b?"nameOnServer":"name";return o(this.navigationProperties,d(c,a))},q.getProperty=function(a,b){b=b||!1;var c=Array.isArray(a)?a:a.trim().split("."),e=c[0],f=o(this.getProperties(),d("name",e));if(1===c.length){if(f)return f;if(b)throw new Error("unable to locate property: "+e+" on entityType: "+this.name);return null}if(f){c.shift();var g=f.isNavigationProperty?f.entityType:f.dataType;if(g)return g.getProperty(c,b);throw new Error("should not get here - unknown property type for: "+f.name)}if(b)throw new Error("unable to locate property: "+e+" on type: "+this.name);return null},q.getEntityKeyFromRawEntity=function(a,b){var c=this.keyProperties.map(function(c){var d=b(a,c);return r(d,c.dataType)});return new jb(this,c)},q._updateTargetFromRaw=function(a,b,c){this.dataProperties.forEach(function(d){var e=c(b,d);if(void 0!==e){var f,g=d.dataType;if(d.isComplexProperty){if(null===e)return;f=a.getProperty(d.name),d.isScalar?g._updateTargetFromRaw(f,e,c):(f.length=0,Array.isArray(e)&&e.forEach(function(b){var e=g._createInstanceCore(a,d);g._updateTargetFromRaw(e,b,c),g._initializeInstance(e),f.push(e)}))}else{var h;d.isScalar?(h=r(e,g),a.setProperty(d.name,h)):(f=a.getProperty(d.name),f.length=0,Array.isArray(e)&&e.forEach(function(a){h=r(a,g),f.push(h)}))}}});var d=b.entityAspect||b.complexAspect;d&&d.originalValuesMap&&(targetAspect=a.entityAspect||a.complexAspect,targetAspect.originalValues=d.originalValuesMap)},q.toString=function(){return this.name},q.toJSON=function(){return j(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:c,navigationProperties:c,validators:null,custom:null})},q._clientPropertyPathToServer=function(a){var b=this.metadataStore.namingConvention.clientPropertyNameToServer,c=this,d=a.split(".").map(function(a){var d=c.getProperty(a);return b(a,d)}).join("/");return d},q._updateNames=function(a){var b=this.metadataStore.namingConvention;f(b,a,"name"),a.isNavigationProperty&&(f(b,a,"foreignKeyNames"),f(b,a,"invForeignKeyNames"))},q._checkNavProperty=function(a){if(a.isNavigationProperty){if(a.parentType!==this)throw new Error(K("The navigationProperty '%1' is not a property of entity type '%2'",a.name,this.name));return a}if("string"==typeof a){var b=this.getProperty(a);if(b&&b.isNavigationProperty)return b}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty")},q._addDataProperty=function(a){this.dataProperties.push(a),a.isPartOfKey&&this.keyProperties.push(a),a.isComplexProperty&&this.complexProperties.push(a),a.concurrencyMode&&"None"!==a.concurrencyMode&&this.concurrencyProperties.push(a),a.isUnmapped&&this.unmappedProperties.push(a)},q._addNavigationProperty=function(a){this.navigationProperties.push(a),N(a.entityTypeName)||(a.entityTypeName=O(a.entityTypeName,this.namespace))},q._updateCps=function(){var a=this.metadataStore,b=a._incompleteComplexTypeMap;this.complexProperties.forEach(function(c){c.complexType||g(c,a)||t(b,c.complexTypeName).push(c)}),this.isComplexType&&((b[this.name]||[]).forEach(function(b){g(b,a)}),delete b[this.name])},q._updateNps=function(){var a=this.metadataStore,b=a._incompleteTypeMap;this.navigationProperties.forEach(function(c){c.entityType||h(c,a)||t(b,c.entityTypeName).push(c)}),(b[this.name]||[]).forEach(function(b){h(b,a)}),delete b[this.name]},p}(),sb=function(){var a=function(a){if(arguments.length>1)throw new Error("The ComplexType ctor has a single argument that is a configuration object.");Z(a).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().whereParam("custom").isOptional().isBoolean().applyAll(this),this.name=O(this.shortName,this.namespace),this.isComplexType=!0,this.dataProperties=[],this.complexProperties=[],this.validators=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.navigationProperties=[],this.keyProperties=[],P(this,a.dataProperties,tb)},b=a.prototype;return b.setProperties=function(a){Z(a).whereParam("custom").isOptional().applyAll(this)},b._createInstanceCore=function(a,b){var c=this.getCtor(),d=new c;return new ib(d,a,b),d},b.addProperty=function(a){if(X(a,"dataProperty").isInstanceOf(tb).check(),this.metadataStore&&!a.isUnmapped)throw new Error("The '"+this.name+"' ComplexType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(a.parentType){if(a.parentType!==this)throw new Error("This dataProperty has already been added to "+property.parentType.name);return this}return this._addDataProperty(a),this},b.getProperties=function(){return this.dataProperties},b=g(b,rb.prototype,["addValidator","getProperty","getPropertyNames","_addDataProperty","_updateNames","_updateCps","_initializeInstance","_updateTargetFromRaw","_clientPropertyPathToServer","_setCtor"]),b.createInstance=rb.prototype.createEntity,b.getCtor=rb.prototype.getEntityCtor,b.toJSON=function(){return j(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null,custom:null})},b._$typeName="ComplexType",a}(),tb=function(){var a=function(a){Z(a).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(lb).isOptional().or().isString().or().isInstanceOf(sb).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("isScalar").isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(db).isArray().isOptional().withDefault([]).whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("custom").isOptional().applyAll(this);var b=!(!this.name&&!this.nameOnServer);if(!b)throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if("string"==typeof this.dataType){var c=lb.fromName(this.dataType);if(!c)throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=c}else this.dataType||(this.dataType=lb.String);if(null==this.defaultValue)if(this.isNullable)this.defaultValue=null;else if(this.isComplexProperty);else if(this.dataType===lb.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,null==this.defaultValue)throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+this.name);this.isComplexProperty&&(this.isScalar=null==this.isScalar||this.isScalar===!0)},b=a.prototype;return b._$typeName="DataProperty",a.getRawValueFromServer=function(a,b){if(b.isUnmapped)return a[b.nameOnServer||b.name];var c=a[b.nameOnServer];return void 0!==c?c:b.defaultValue},a.getRawValueFromClient=function(a,b){var c=a[b.name];return void 0!==c?c:b.defaultValue},b.isDataProperty=!0,b.isNavigationProperty=!1,b.setProperties=function(a){Z(a).whereParam("custom").isOptional().applyAll(this)},b.toJSON=function(){return j(this,{name:null,dataType:function(a){return a&&a.parentEnum?a.name:void 0},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,concurrencyMode:null,maxLength:null,validators:null,enumType:null,rawTypeName:null,isScalar:!0,custom:null})},a.fromJSON=function(a){return a.dataType=lb.fromName(a.dataType),a.defaultValue&&a.dataType&&a.dataType.isDate&&(a.defaultValue=new Date(Date.parse(a.defaultValue))),a.validators&&(a.validators=a.validators.map(db.fromJSON)),new tb(a)},a}(),ub=function(){var a=function(a){Z(a).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().isOptional().withDefault(!0).whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(db).isArray().isOptional().withDefault([]).whereParam("custom").isOptional().applyAll(this);var b=!(!this.name&&!this.nameOnServer);if(!b)throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property")},b=a.prototype;return b._$typeName="NavigationProperty",b.isDataProperty=!1,b.isNavigationProperty=!0,b.setProperties=function(a){Z(a).whereParam("custom").isOptional().applyAll(this)},b.toJSON=function(){return j(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,foreignKeyNames:null,invForeignKeyNames:null,custom:null})},a.fromJSON=function(a){return a.validators&&(a.validators=a.validators.map(db.fromJSON)),new ub(a)},a}(),vb=function(){var a=new $("AutoGeneratedKeyType");return a.None=a.addSymbol(),a.Identity=a.addSymbol(),a.KeyGenerator=a.addSymbol(),a.seal(),a}();!function(){function a(a,b){return null==b?!1:void 0!==b.entityType}function b(a,b){return null==b?!1:b.isDataProperty||b.isNavigationProperty}var c=W.prototype;c.isEntity=function(){return this._addContext({fn:a,msg:" must be an entity"})},c.isEntityProperty=function(){return this._addContext({fn:b,msg:" must be either a DataProperty or a NavigationProperty"})}}(),S.MetadataStore=pb,S.EntityType=rb,S.ComplexType=sb,S.DataProperty=tb,S.NavigationProperty=ub,S.AutoGeneratedKeyType=vb,pb.normalizeTypeName=qb.normalizeTypeName;var wb=function(){function a(a,b,c){var d=b.name+".."+b.parentType.name,e=a._tempIdMap[d];return e||c&&(e={entityType:b.parentType,propertyName:b.name,keyMap:{}},a._tempIdMap[d]=e),e}var b=function(){this._tempIdMap={}},c=b.prototype;return c.generateTempKeyValue=function(b,c){var d=b.keyProperties;if(d.length>1)throw new Error("Ids can not be autogenerated for entities with multipart keys");var e,f=d[0],g=a(this,f,!0);if(null!=c&&(g.keyMap[c.toString()]||(e=c)),void 0===e){var h=f.dataType;if(!h.getNext)throw new Error("Cannot use a property with a dataType of: "+h.toString()+" for id generation");for(e=h.getNext(this);null!=g.keyMap[e.toString()];)e=h.getNext(this)}return g.keyMap[e.toString()]=!0,e},c.getTempKeys=function(){var a=[];for(var b in this._tempIdMap){var c=this._tempIdMap[b],d=c.entityType;for(var e in c.keyMap)a.push(new jb(d,[e]))}return a},c.isTempKey=function(b){var c=b.entityType.keyProperties;if(c.length>1)return!1;var d=c[0],e=a(this,d);return e?void 0!==e.keyMap[b.values[0].toString()]:!1},ab.registerType(b,"KeyGenerator"),b}();S.KeyGenerator=wb;var xb=function(){var a=function(a){Z(a||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this),this.name||(this.name=z()),ab._storeObject(this,b._$typeName,this.name)},b=a.prototype;return b._$typeName="LocalQueryComparisonOptions",a.caseInsensitiveSQL=new a({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),a.defaultInstance=new a(a.caseInsensitiveSQL),b.setAsDefault=function(){return i(this,a)},a}();S.LocalQueryComparisonOptions=xb;var yb=function(){var a=function(a){Z(a||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this),this.name||(this.name=z()),ab._storeObject(this,b._$typeName,this.name)},b=a.prototype;return b._$typeName="NamingConvention",a.none=new a({name:"noChange",serverPropertyNameToClient:function(a){return a},clientPropertyNameToServer:function(a){return a}}),a.camelCase=new a({name:"camelCase",serverPropertyNameToClient:function(a){return a.substr(0,1).toLowerCase()+a.substr(1)},clientPropertyNameToServer:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)}}),a.defaultInstance=new a(a.none),b.setAsDefault=function(){return i(this,a)},a}();S.NamingConvention=yb;var zb=function(){function b(c,d,e,f){var g=e._$typeName||e.parentEnum&&e.parentEnum.name,h=g&&g.substr(0,1).toLowerCase()+g.substr(1);if(f&&h!=f)throw new Error("Invalid value for property: "+f);if(h){var i=d[h];if(void 0===i)throw new Error("Invalid config property: "+h);null===i?c[h]=e:i(c,e)}else a(e,function(a,e){b(c,d,e,a)})}function c(a,b,c){return b&&a[b]===c?a:(copy=g(new zb,a,["resourceName","entityType","wherePredicate","orderByClause","selectClause","skipCount","takeCount","expandClause","inlineCountEnabled","noTrackingEnabled","queryOptions","entityManager","dataService","resultEntityType"]),copy.parameters=g({},a.parameters),b&&(copy[b]=c),copy)}function d(a){return X(a,"propertyPaths").isOptional().isString().or().isArray().isString().check(),"string"==typeof a&&(a=a.split(",")),a=a.map(function(a){return a.trim()})}function e(a){var b=a.entityType,c=b.keyProperties.map(function(b){return Eb.create(b.name,Cb.Equals,a.getProperty(b.name))}),d=Eb.and(c);return d}function f(a,b,e){var f;return null==b?f=null:(b=d(b),f=Hb.create(b,e),a.orderByClause&&(f=a.orderByClause.addClause(f))),c(a,"orderByClause",f)}function h(a){var b=a.entityType.keyProperties,c=r(b,a.values,function(a,b){return Eb.create(a.name,Cb.Equals,b)}),d=Eb.and(c);return d}function i(a,b){if(b.isScalar){if(0===b.foreignKeyNames.length)return null;var c=b.foreignKeyNames.map(function(b){return a.getProperty(b)}),d=new jb(b.entityType,c);return h(d)}var e=b.inverse,f=e?e.foreignKeyNames:b.invForeignKeyNames;if(0===f.length)return null;var g=a.entityAspect.getKey().values,i=r(f,g,function(a,b){return Eb.create(a,Cb.Equals,b)});return Eb.and(i)}var j=function(a){X(a,"resourceName").isOptional().isString().check(),this.resourceName=a,this.entityType=null,this.wherePredicate=null,this.orderByClause=null,this.selectClause=null,this.skipCount=null,this.takeCount=null,this.expandClause=null,this.parameters={},this.inlineCountEnabled=!1,this.noTrackingEnabled=!1,this.entityManager=null},k=j.prototype;return k._$typeName="EntityQuery",k.from=function(a){return X(a,"resourceName").isString().check(),c(this,"resourceName",a)},j.from=function(a){return X(a,"resourceName").isString().check(),new zb(a)},k.toType=function(a){return X(a,"entityType").isString().or().isInstanceOf(rb).check(),c(this,"resultEntityType",a)},k.where=function(a){var b;if(null==a)b=null;else{b=a instanceof Eb?a:Eb.create(U(arguments)),this.entityType&&b.validate(this.entityType),this.wherePredicate&&(b=new Gb("and",[this.wherePredicate,b]))}return c(this,"wherePredicate",b)},k.orderBy=function(a){return f(this,a)},k.orderByDesc=function(a){return f(this,a,!0)},k.select=function(a){var b=null==a?null:new Kb(d(a));return c(this,"selectClause",b)},k.skip=function(a){return X(a,"count").isOptional().isNumber().check(),c(this,"skipCount",null==a?null:a)},k.top=function(a){return this.take(a)},k.take=function(a){return X(a,"count").isOptional().isNumber().check(),c(this,"takeCount",null==a?null:a)},k.expand=function(a){var b=null==a?null:new Lb(d(a));return c(this,"expandClause",b)},k.withParameters=function(a){return X(a,"parameters").isObject().check(),c(this,"parameters",a)},k.inlineCount=function(a){return X(a,"enabled").isBoolean().isOptional().check(),a=void 0===a?!0:!!a,c(this,"inlineCountEnabled",a)},k.noTracking=function(a){return X(a,"enabled").isBoolean().isOptional().check(),a=void 0===a?!0:!!a,c(this,"noTrackingEnabled",a)},k.using=function(a){if(!a)return this;var d=c(this);return b(d,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(a,b){a.queryOptions=(a.queryOptions||new Ob).using(b)},mergeStrategy:function(a,b){a.queryOptions=(a.queryOptions||new Ob).using(b)},jsonResultsAdapter:function(a,b){a.dataService=(a.dataService||new mb).using({jsonResultsAdapter:b})}},a),d},k.execute=function(a,b){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,a,b)},k.executeLocally=function(){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},j.fromEntities=function(a){X(a,"entities").isEntity().or().isNonEmptyArray().isEntity().check(),Array.isArray(a)||(a=U(arguments));var b=a[0],c=new zb(b.entityType.defaultResourceName),d=a.map(function(a){return e(a)}),f=Eb.or(d);c=c.where(f);var g=b.entityAspect.entityManager;return g&&(c=c.using(g)),c},j.fromEntityKey=function(a){X(a,"entityKey").isInstanceOf(jb).check();var b=new zb(a.entityType.defaultResourceName),c=h(a);return b=b.where(c)},j.fromEntityNavigation=function(a,b){X(a,"entity").isEntity().check();var c=a.entityType._checkNavProperty(b),d=new zb(c.entityType.defaultResourceName),e=i(a,c);d=d.where(e);var f=a.entityAspect.entityManager;return f&&(d=d.using(f)),d},k._getFromEntityType=function(a,b){var c=this.entityType;if(c)return c;var d=this.resourceName;if(!d)throw new Error("There is no resourceName for this query");if(a.isEmpty()){if(b)throw new Error("There is no metadata available for this query. Are you querying the local cache before you've fetched metadata?");return null}var e=a.getEntityTypeNameForResourceName(d);if(c=e?a._getEntityType(e):this._getToEntityType(a,!0),!c){if(b)throw new Error(K("Cannot find an entityType for resourceName: '%1'.  Consider adding an 'EntityQuery.toType' call to your query or calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",d));return null}return this.entityType=c,c},k._getToEntityType=function(a,b){return this.resultEntityType instanceof rb?this.resultEntityType:this.resultEntityType?(this.resultEntityType=a._getEntityType(this.resultEntityType,!1),this.resultEntityType):b?null:!this.selectClause&&this._getFromEntityType(a,!1)},k._toUri=function(a){function b(){var a=k.wherePredicate;if(a)return k.entityType&&a.validate(k.entityType),Eb._next=0,a.toODataFragment(j)}function c(){return k.inlineCountEnabled?k.inlineCountEnabled?"allpages":"none":void 0}function d(){var a=k.orderByClause;if(a)return k.entityType&&a.validate(k.entityType),a.toODataFragment(j)}function e(){var a=k.selectClause;if(a)return k.entityType&&a.validate(k.entityType),a.toODataFragment(j)}function f(){var a=k.expandClause;if(a)return a.toODataFragment(j)}function g(){var a=k.skipCount;if(a)return a.toString()}function h(){var a=k.takeCount;if(null!=a)return a.toString()}function i(a){var b=[];for(var c in a){var d=a[c];void 0!==d&&(d instanceof Array?d.forEach(function(a){b.push(c+"="+encodeURIComponent(a))}):b.push(c+"="+encodeURIComponent(d)))}return b.length>0?"?"+b.join("&"):""}var j=this._getFromEntityType(a,!1);j||(j=new rb(a));var k=this,l={};l.$filter=b(),l.$orderby=d(),l.$skip=g(),l.$top=h(),l.$expand=f(),l.$select=e(),l.$inlinecount=c();var m=i(l);return this.resourceName+m},k._toFilterFunction=function(a){var b=this.wherePredicate;return b?(b.validate(a),b.toFunction(a)):null},k._toOrderByComparer=function(a){var b=this.orderByClause;return b?b.getComparer(a):null},j}(),Ab=function(){var a={toupper:{fn:function(a){return a.toUpperCase()},dataType:lb.String},tolower:{fn:function(a){return a.toLowerCase()},dataType:lb.String},substring:{fn:function(a,b,c){return a.substring(b,c)},dataType:lb.String},substringof:{fn:function(a,b){return b.indexOf(a)>=0},dataType:lb.Boolean},length:{fn:function(a){return a.length},dataType:lb.Int32},trim:{fn:function(a){return a.trim()},dataType:lb.String},concat:{fn:function(a,b){return a.concat(b)},dataType:lb.String},replace:{fn:function(a,b,c){return a.replace(b,c)},dataType:lb.String},startswith:{fn:function(a,b){return I(a,b)},dataType:lb.Boolean},endswith:{fn:function(a,b){return J(a,b)},dataType:lb.Boolean},indexof:{fn:function(a,b){return a.indexOf(b)},dataType:lb.Int32},round:{fn:function(a){return Math.round(a)},dataType:lb.Int32},ceiling:{fn:function(a){return Math.ceil(a)},dataType:lb.Int32},floor:{fn:function(a){return Math.floor(a)},dataType:lb.Int32},second:{fn:function(a){return a.getSeconds()},dataType:lb.Int32},minute:{fn:function(a){return a.getMinutes()},dataType:lb.Int32},day:{fn:function(a){return a.getDate()},dataType:lb.Int32},month:{fn:function(a){return a.getMonth()+1},dataType:lb.Int32},year:{fn:function(a){return a.getFullYear()},dataType:lb.Int32}};return a}(),Bb=function(){function a(a){var b=a.split(".");return 1===b.length?function(b){return b.getProperty(a)}:function(a){return Q(a,b)}}var b=/^[a-z_][\w.$]*$/i,c=/('[^']*'|[^,]+)/g,d=/("[^"]*"|[^,]+)/g,e=function(e,f,g){var h=e.split(":");if(this.isRealNode=!0,1===h.length){var i=h[0].trim();this.value=i;var j=i.substr(0,1),k=("'"===j||'"'===j)&&i.length>1&&i.substr(i.length-1)===j;if(k){var l=i.substr(1,i.length-2);this.fn=function(){return l},this.dataType=lb.String}else{var m=b.test(i);if(m){if(g&&null==g.getProperty(i,!1))return this.isRealNode=!1,void 0;this.propertyPath=i,this.fn=a(i)}else{if(g)return this.isRealNode=!1,void 0;this.fn=function(){return i},this.dataType=lb.fromValue(i)}}}else try{this.fnName=h[0].trim().toLowerCase();var n=Ab[this.fnName];this.localFn=n.fn,this.dataType=n.dataType;var o=this;this.fn=function(a){var b=o.fnNodes.map(function(b){var c=b.fn(a);return c}),c=o.localFn.apply(null,b);
return c};var p=f[h[1]].trim();"("===p.substr(0,1)&&(p=p.substr(1,p.length-2));var q=e.indexOf("'")>=0?c:d,r=p.match(q);this.fnNodes=r.map(function(a){return new Bb(a,f)})}catch(s){this.isRealNode=!1}},f=e.prototype;return e.create=function(a,b,c){if("string"!=typeof a)return null;for(var d,e=/\([^()]*\)/,f=[],g=0;d=e.exec(a);){var h=d[0];f.push(h);var i=":"+g++;a=a.replace(h,i)}var j=new Bb(a,f,c?null:b);return j.isRealNode?(!j.dataType&&c&&c.isStringFn&&(j.dataType=lb.String),j._validate(b),j):null},f.toString=function(){if(this.fnName){var a=this.fnNodes.map(function(a){return a.toString()}),b=this.fnName+"("+a.join(",")+")";return b}return this.value},f.toODataFragment=function(a){if(this._validate(a),this.fnName){var b=this.fnNodes.map(function(b){return b.toODataFragment(a)}),c=this.fnName+"("+b.join(",")+")";return c}var d=this.value.substr(0,1);return"'"===d||'"'===d?this.value:this.value==this.propertyPath?a._clientPropertyPathToServer(this.propertyPath):this.value},f._validate=function(a){if(!this.isValidated)if(this.isValidated=!0,this.propertyPath){if(a.isAnonymous)return;var b=a.getProperty(this.propertyPath,!0);if(!b){var c=K("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",a.name,this.propertyPath);throw new Error(c)}this.dataType=b.isDataProperty?b.dataType:b.entityType}else this.fnNodes&&this.fnNodes.forEach(function(b){b._validate(a)})},e}(),Cb=function(){var a=new $("FilterQueryOp");return a.Equals=a.addSymbol({operator:"eq",aliases:["=="]}),a.NotEquals=a.addSymbol({operator:"ne",aliases:["!="]}),a.GreaterThan=a.addSymbol({operator:"gt",aliases:[">"]}),a.LessThan=a.addSymbol({operator:"lt",aliases:["<"]}),a.GreaterThanOrEqual=a.addSymbol({operator:"ge",aliases:[">="]}),a.LessThanOrEqual=a.addSymbol({operator:"le",aliases:["<="]}),a.Contains=a.addSymbol({operator:"substringof",aliases:["contains"],isFunction:!0,isStringFn:!0}),a.StartsWith=a.addSymbol({operator:"startswith",isFunction:!0,isStringFn:!0}),a.EndsWith=a.addSymbol({operator:"endswith",isFunction:!0,isStringFn:!0}),a.Any=a.addSymbol({operator:"any",isAnyAll:!0,aliases:["some"]}),a.All=a.addSymbol({operator:"all",isAnyAll:!0,aliases:["every"]}),a.IsTypeOf=a.addSymbol({operator:"isof",isFunction:!0,aliases:["isTypeOf"]}),a.seal(),a._map=function(){var b={};return a.getSymbols().forEach(function(a){b[a.name.toLowerCase()]=a,b[a.operator.toLowerCase()]=a,a.aliases&&a.aliases.forEach(function(c){b[c.toLowerCase()]=a})}),b}(),a.from=function(b){return a.contains(b)?b:a._map[b.toLowerCase()]},a}(),Db=function(){var a=new $("BooleanQueryOp");return a.And=a.addSymbol({operator:"and",aliases:["&&"]}),a.Or=a.addSymbol({operator:"or",aliases:["||"]}),a.Not=a.addSymbol({operator:"not",aliases:["~","!"]}),a.seal(),a._map=function(){var b={};return a.getSymbols().forEach(function(a){b[a.name.toLowerCase()]=a,b[a.operator.toLowerCase()]=a,a.aliases&&a.aliases.forEach(function(c){b[c.toLowerCase()]=a})}),b}(),a.from=function(b){return a.contains(b)?b:a._map[b.toLowerCase()]},a}(),Eb=function(){function a(a){var b;if(1===a.length&&Array.isArray(a[0]))b=a[0];else{var b=U(a);b[0]instanceof Eb||(b=[Eb.create(b)])}return b.filter(function(a){return null!=a})}var b=function(){return arguments[0].prototype===!0?this:new Fb(U(arguments))},c=b.prototype;return b.create=function(a){var b=Array.isArray(a)&&1===arguments.length?a:U(arguments);return new Fb(b)},b.and=function(b){return b=a(arguments),0===b.length?null:1===b.length?b[0]:new Gb("and",b)},b.or=function(b){return b=a(arguments),0===b.length?null:1===b.length?b[0]:new Gb("or",b)},b.not=function(a){return new Gb("not",[a])},c.and=function(c){return c=a(arguments),c.unshift(this),b.and(c)},c.or=function(c){return c=a(arguments),c.unshift(this),b.or(c)},c.not=function(){return new Gb("not",[this])},b}(),Fb=function(){function a(a,f,g){var h,i=a.metadataStore.localQueryComparisonOptions,j=R(g);switch(f){case Cb.Equals:h=function(a,c){return a&&"string"==typeof a?b(a,c,i):j(a)==j(c)};break;case Cb.NotEquals:h=function(a,c){return a&&"string"==typeof a?!b(a,c,i):j(a)!=j(c)};break;case Cb.GreaterThan:h=function(a,b){return j(a)>j(b)};break;case Cb.GreaterThanOrEqual:h=function(a,b){return j(a)>=j(b)};break;case Cb.LessThan:h=function(a,b){return j(a)<j(b)};break;case Cb.LessThanOrEqual:h=function(a,b){return j(a)<=j(b)};break;case Cb.StartsWith:h=function(a,b){return c(a,b,i)};break;case Cb.EndsWith:h=function(a,b){return d(a,b,i)};break;case Cb.Contains:h=function(a,b){return e(a,b,i)};break;case Cb.Any:h=function(a,b){return a.some(function(a){return b(a)})};break;case Cb.All:h=function(a,b){return a.every(function(a){return b(a)})};break;default:throw new Error("Unknown FilterQueryOp: "+f)}return h}function b(a,b,c){return null==b?!1:("string"!=typeof b&&(b=b.toString()),c.usesSql92CompliantStringComparison&&(a=(a||"").trim(),b=(b||"").trim()),c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),a===b)}function c(a,b,c){return c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),I(a,b)}function d(a,b,c){return c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),J(a,b)}function e(a,b,c){return c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),a.indexOf(b)>=0}var f=function(a){if(1===a.length)return this._odataExpr=a[0],void 0;var b=a[0];X(b,"propertyOrExpr").isString().isOptional().check();var c=a[1];X(c,"operator").isEnumOf(Cb).or().isString().check();var d=Cb.from(c);if(!d)throw new Error("Unknown query operation: "+c);if(this._filterQueryOp=d,b)this._propertyOrExpr=b;else if(d!==Cb.IsTypeOf)throw new Error("propertyOrExpr cannot be null except when using the 'IsTypeOf' operator");var e=a[2];return d&&d.isAnyAll?(this._value=e instanceof Eb?e:new Fb(a.slice(2)),this._isLiteral=void 0,void 0):(X(e,"value").isRequired(!0).check(),null!=e&&"object"==typeof e&&void 0!==e.value?(this._dataType=e.dataType||lb.fromValue(e.value),this._value=e.value,this._isLiteral=e.isLiteral):(this._dataType=lb.fromValue(e),this._value=e,this._isLiteral=void 0),void 0)},g=new Eb({prototype:!0});return f.prototype=g,g.toODataFragment=function(a,b){if(this._odataExpr)return this._odataExpr;var c=this._filterQueryOp,d=this._value;if(c==Cb.IsTypeOf){var e=a.metadataStore.getEntityType(d),f=e.namespace+"."+e.shortName;return c.operator+"("+lb.String.fmtOData(f)+")"}this.validate(a);var g=this._fnNode1&&this._fnNode1.toODataFragment(a);if(b&&(g=b+"/"+g),Eb._next+=1,b="x"+Eb._next,c.isAnyAll)return g+"/"+c.operator+"("+b+": "+d.toODataFragment(this.dataType,b)+")";var h;if(this._fnNode2)h=this._fnNode2.toODataFragment(a);else{var i=this._fnNode1.dataType||this._dataType;h=i.fmtOData(d)}return c.isFunction?c==Cb.Contains?c.operator+"("+h+","+g+") eq true":c.operator+"("+g+","+h+") eq true":g+" "+c.operator+" "+h},g.toFunction=function(b){if(this._odataExpr)throw new Exception("OData predicateexpressions cannot be interpreted locally");this.validate(b);var c=this._fnNode1.dataType||this._dataType,d=a(b,this._filterQueryOp,c),e=this._fnNode1.fn;if(this._fnNode2){var f=this._fnNode2.fn;return function(a){return d(e(a),f(a))}}if(this._filterQueryOp&&this._filterQueryOp.isAnyAll){var g=this._value.toFunction(c);return function(a){return d(e(a),g)}}var h=this._value;return function(a){return d(e(a),h)}},g.toString=function(){return K("{%1} %2 {%3}",this._propertyOrExpr,this._filterQueryOp.operator,this._value)},g.validate=function(a){var b=this._filterQueryOp;return void 0===this._fnNode1&&this._propertyOrExpr&&(this._fnNode1=Bb.create(this._propertyOrExpr,a,b),this.dataType=this._fnNode1.dataType),b&&b.isAnyAll?(this._value.validate(this.dataType),void 0):(void 0!==this._fnNode2||this._isLiteral||(this._fnNode2=Bb.create(this._value,a)),void 0)},f}(),Gb=function(){function a(a,b,c){var d,e;switch(b){case Db.Not:return d=c[0].toFunction(a),function(a){return!d(a)};case Db.And:return e=c.map(function(b){return b.toFunction(a)}),function(a){var b=e.reduce(function(b,c){return b&&c(a)},!0);return b};case Db.Or:return e=c.map(function(b){return b.toFunction(a)}),function(a){var b=e.reduce(function(b,c){return b||c(a)},!1);return b};default:throw new Error("Invalid boolean operator:"+b)}}var b=function(a,b){if(!Array.isArray(b))throw new Error("predicates parameter must be an array");if(this._booleanQueryOp=Db.from(a),!this._booleanQueryOp)throw new Error("Unknown query operation: "+a);if(this._booleanQueryOp===Db.Not&&1!==b.length)throw new Error("Only a single predicate can be passed in with the 'Not' operator");this._predicates=b},c=new Eb({prototype:!0});return b.prototype=c,c.toODataFragment=function(a,b){if(1==this._predicates.length)return this._booleanQueryOp.operator+" ("+this._predicates[0].toODataFragment(a,b)+")";var c=this._predicates.map(function(c){return"("+c.toODataFragment(a,b)+")"}).join(" "+this._booleanQueryOp.operator+" ");return c},c.toFunction=function(b){return a(b,this._booleanQueryOp,this._predicates)},c.toString=function(){if(1==this._predicates.length)return this._booleanQueryOp.operator+" ("+this._predicates[0]+")";var a=this._predicates.map(function(a){return"("+a.toString()+")"}).join(" "+this._booleanQueryOp.operator+" ");return a},c.validate=function(a){this._isValidated||(this._predicates.every(function(b){b.validate(a)}),this._isValidated=!0)},b}(),Hb=function(){var a=function(b,c){return b.prototype===!0?this:a.create(b,c)},b=a.prototype;return a.create=function(a,b){if(a.length>1){var c=a.map(function(a){return new Ib(a,b)});return new Jb(c)}return new Ib(a[0],b)},a.combine=function(a){return new Jb(a)},a.isOrderByClause=function(a){return a instanceof Hb},b.addClause=function(a){return new Jb([this,a])},a}(),Ib=function(){var a=function(a,b){if("string"!=typeof a)throw new Error("propertyPath is not a string");a=a.trim();var c=a.split(" ");if(c.length>1&&b!==!0&&b!==!1&&(b=I(c[1].toLowerCase(),"desc"),!b)){var d=I(c[1].toLowerCase(),"asc");if(!d)throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'")}this.propertyPath=c[0],this.isDesc=b},b=new Hb({prototype:!0});return a.prototype=b,b.validate=function(a){a&&(this.lastProperty=a.getProperty(this.propertyPath,!0))},b.toODataFragment=function(a){return a._clientPropertyPathToServer(this.propertyPath)+(this.isDesc?" desc":"")},b.getComparer=function(a){if(this.lastProperty||this.validate(a),this.lastProperty)var b=this.lastProperty.dataType,c=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive;var d=this.propertyPath,e=this.isDesc;return function(a,f){var g=Q(a,d),h=Q(f,d),i=b||g&&lb.fromValue(g)||lb.fromValue(h);if(i===lb.String)c?(g=g||"",h=h||""):(g=(g||"").toLowerCase(),h=(h||"").toLowerCase());else{var j=R(i);g=j(g),h=j(h)}return g===h?0:g>h||void 0===h?e?-1:1:e?1:-1}},a}(),Jb=function(){var a=function(a){var b=[];a.forEach(function(a){if(a instanceof Jb)b=b.concat(a.orderByClauses);else{if(!(a instanceof Ib))throw new Error("Invalid argument to CompositeOrderByClause ctor.");b.push(a)}}),this._orderByClauses=b},b=new Hb({prototype:!0});return a.prototype=b,b.validate=function(a){this._orderByClauses.forEach(function(b){b.validate(a)})},b.toODataFragment=function(a){var b=this._orderByClauses.map(function(b){return b.toODataFragment(a)});return b.join(",")},b.getComparer=function(a){var b=this._orderByClauses.map(function(b){return b.getComparer(a)});return function(a,c){for(var d=0;d<b.length;d++){var e=b[d](a,c);if(0!==e)return e}return 0}},a}(),Kb=function(){var a=function(a){this.propertyPaths=a,this._pathNames=a.map(function(a){return a.replace(".","_")})},b=a.prototype;return b.validate=function(a){a&&this.propertyPaths.forEach(function(b){a.getProperty(b,!0)})},b.toODataFragment=function(a){var b=this.propertyPaths.map(function(b){return a._clientPropertyPathToServer(b)}).join(",");return b},b.toFunction=function(){var a=this;return function(b){var c={};return a.propertyPaths.forEach(function(d,e){c[a._pathNames[e]]=Q(b,d)}),c}},a}(),Lb=function(){var a=function(a){this.propertyPaths=a},b=a.prototype;return b.toODataFragment=function(a){var b=this.propertyPaths.map(function(b){return a._clientPropertyPathToServer(b)}).join(",");return b},a}();S.FilterQueryOp=Cb,S.Predicate=Eb,S.EntityQuery=zb,S.FnNode=Bb,S.OrderByClause=Hb;var Mb=function(){var a=new $("MergeStrategy");return a.PreserveChanges=a.addSymbol(),a.OverwriteChanges=a.addSymbol(),a.SkipMerge=a.addSymbol(),a.Disallowed=a.addSymbol(),a.seal(),a}(),Nb=function(){var a=new $("FetchStrategy");return a.FromServer=a.addSymbol(),a.FromLocalCache=a.addSymbol(),a.seal(),a}(),Ob=function(){function a(a,b){return b&&Z(b).whereParam("fetchStrategy").isEnumOf(Nb).isOptional().whereParam("mergeStrategy").isEnumOf(Mb).isOptional().applyAll(a),a}var b=function(b){a(this,b)},c=b.prototype;return c._$typeName="QueryOptions",b.resolve=function(a){return new Ob(l(a,["fetchStrategy","mergeStrategy"]))},b.defaultInstance=new b({fetchStrategy:Nb.FromServer,mergeStrategy:Mb.PreserveChanges}),c.using=function(b){if(!b)return this;var c=new Ob(this);return Mb.contains(b)?b={mergeStrategy:b}:Nb.contains(b)&&(b={fetchStrategy:b}),a(c,b)},c.setAsDefault=function(){return i(this,b)},c.toJSON=function(){return j(this,{fetchStrategy:null,mergeStrategy:null})},b.fromJSON=function(a){return new Ob({fetchStrategy:Nb.fromName(a.fetchStrategy),mergeStrategy:Mb.fromName(a.mergeStrategy)})},b}();S.QueryOptions=Ob,S.FetchStrategy=Nb,S.MergeStrategy=Mb;var Pb=function(){function a(a){if(a){if(1===a.length){var b=a[0];return function(a){return a?a.entityAspect.entityState===b:!1}}return function(b){return b?a.some(function(a){return b.entityAspect.entityState===a}):!1}}return function(a){return!!a}}var b=a([kb.Added,kb.Modified,kb.Deleted]),c=function(a,b){this.entityManager=a,this.entityType=b,this._indexMap={},this._entities=[],this._emptyIndexes=[]},d=c.prototype;return d.attachEntity=function(a,b,c){var d=a.entityAspect;d._initialized||this.entityType._initializeInstance(a),delete d._initialized;var e=d.getKey()._keyInGroup,f=this._indexMap[e];if(f>=0){var g=this._entities[f],h=g.entityAspect.entityState.isUnchanged();if(g===a)d.entityState=b;else{if(c===Mb.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' does not allow you to attach an entity when an entity with the same key is already attached: "+d.getKey());(c===Mb.OverwriteChanges||c===Mb.PreserveChanges&&h)&&(this.entityType._updateTargetFromRaw(g,a,tb.getRawValueFromClient),this.entityManager._checkStateChange(g,h,b.isUnchanged()))}return g}return 0===this._emptyIndexes.length?f=this._entities.push(a)-1:(f=this._emptyIndexes.pop(),this._entities[f]=a),this._indexMap[e]=f,d.entityState=b,d.entityGroup=this,d.entityManager=this.entityManager,a},d.detachEntity=function(a){var b=a.entityAspect,c=b.getKey()._keyInGroup,d=this._indexMap[c];if(void 0===d)throw new Error("internal error - entity cannot be found in group");return delete this._indexMap[c],this._emptyIndexes.push(d),this._entities[d]=null,a},d.findEntityByKey=function(a){var b;b=a instanceof jb?a._keyInGroup:jb.createKeyString(a);var c=this._indexMap[b];return void 0!==c?this._entities[c]:null},d.hasChanges=function(){return this._entities.some(b)},d.getEntities=function(b){var c=a(b);return this._entities.filter(c)},d._clear=function(){this._entities.forEach(function(a){null!=a&&a.entityAspect._detach()}),this._entities=null,this._indexMap=null,this._emptyIndexes=null},d._fixupKey=function(a,b){var c=this._indexMap[a];if(void 0===c)throw new Error("Internal Error in key fixup - unable to locate entity");var d=this._entities[c],e=d.entityType.keyProperties[0].name;d.setProperty(e,b),delete d.entityAspect.hasTempKey,delete this._indexMap[a],this._indexMap[b]=c},d._replaceKey=function(a,b){var c=this._indexMap[a._keyInGroup];delete this._indexMap[a._keyInGroup],this._indexMap[b._keyInGroup]=c},c}(),Qb=function(){function b(a,b,c){var d=c?Ob.defaultInstance:a.queryOptions,e=c?Sb.defaultInstance:a.saveOptions,f=c?fb.defaultInstance:a.validationOptions,g=Z(b).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(mb).whereParam("queryOptions").isInstanceOf(Ob).isOptional().withDefault(d).whereParam("saveOptions").isInstanceOf(Sb).isOptional().withDefault(e).whereParam("validationOptions").isInstanceOf(fb).isOptional().withDefault(f).whereParam("keyGeneratorCtor").isFunction().isOptional();c&&(g=g.whereParam("metadataStore").isInstanceOf(pb).isOptional().withDefault(new pb)),g.applyAll(a),h(a.queryOptions,d),h(a.saveOptions,e),h(a.validationOptions,f),b.serviceName&&(a.dataService=new mb({serviceName:a.serviceName})),a.serviceName=a.dataService&&a.dataService.serviceName,a.keyGeneratorCtor=a.keyGeneratorCtor||wb,(c||b.keyGeneratorCtor)&&(a.keyGenerator=new a.keyGeneratorCtor)}function c(b){b.forEach(function(b){var c=[],d=b.entityAspect._validationErrors;a(d,function(a,b){b.isServerError&&c.push(a)}),0!==c.length&&(c.forEach(function(a){delete d[a]}),b.hasValidationErrors=!G(d))})}function d(b){var c=[];return b.forEach(function(b){a(b.entityAspect._validationErrors,function(a,d){var e=g({entity:b,errorName:d.validator.name},d,["errorMessage","propertyName","isServerError"]);c.push(e)})}),c}function e(a,b){var c=b.entityErrors;if(c){var d=a.entityManager,e=d.metadataStore;b.entityErrors=c.map(function(a){var b=null;if(a.keyValues){var c=e._getEntityType(a.entityTypeName),f=new jb(c,a.keyValues);b=d.findEntityByKey(f)}if(b){var h=a.propertyName?{propertyName:a.propertyName,property:c.getProperty(a.propertyName)}:{},i=eb.getKey(a.errorName||a.errorMessage,a.propertyName),j=new eb(null,h,a.errorMessage,i);j.isServerError=!0,b.entityAspect.addValidationError(j)}var k=g({entity:b,isServerError:!0},a,["errorName","errorMessage","propertyName"]);return k})}}function i(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;d>c;c++)if(a[c]!==b[c])return!1;return!0}function j(a,b){return X(b,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(rb).or().isNonEmptyArray().isInstanceOf(rb).check(),"string"==typeof b?b=a.metadataStore._getEntityType(b,!1):Array.isArray(b)&&"string"==typeof b[0]&&(b=b.map(function(b){return a.metadataStore._getEntityType(b,!1)})),b}function l(a,b,c){var d,e=F(a,b);return e.forEach(function(a){if(a){var b=a.getEntities(c);d?d.push.apply(d,b):d=b}}),d||[]}function p(a,b){if(b[0]instanceof jb)return{entityKey:b[0],remainingArgs:U(b,1)};if("string"==typeof b[0]&&b.length>=2){var c=a.metadataStore._getEntityType(b[0],!1);return{entityKey:new jb(c,b[1]),remainingArgs:U(b,2)}}throw new Error("This method requires as its initial parameters either an EntityKey or an entityType name followed by a value or an array of values.")}function s(a,b){a.forEach(function(a){a.entityAspect.isBeingSaved=b})}function u(b,c){var d;c?(d={},c.forEach(function(a){var b=d[a.entityType.name];b||(b={},b.entityType=a.entityType,b._entities=[],d[a.entityType.name]=b),b._entities.push(a)})):d=b._entityGroupMap;var e=[],f={};return a(d,function(a,b){f[a]=v(b,e)}),{entityGroupMap:f,tempKeys:e}}function v(a,b){var c={},d=a.entityType,e=d.dataProperties,f=T(d),g=[];return a._entities.forEach(function(a){if(a){var c=y(a,e,f,b);g.push(c)}}),c.entities=g,c}function y(a,b,c,d){var e={};b.forEach(function(b){var d=b.name,f=a.getProperty(d);if(null!=f||null!=b.defaultValue){if(f&&b.isComplexProperty){var g=b.dataType.dataProperties;f=n(f,function(a){return y(a,g,c)})}else f=c?c(b,f):f,b.isUnmapped&&(f=k(f));void 0!==f&&(e[d]=f)}});var f,g;if(a.entityAspect){f=a.entityAspect;var h=f.entityState;g={tempNavPropNames:A(f,d),entityState:h.name},(h.isModified()||h.isDeleted())&&(g.originalValuesMap=f.originalValues),e.entityAspect=g}else f=a.complexAspect,g={},f.originalValues&&!G(f.originalValues)&&(g.originalValuesMap=f.originalValues),e.complexAspect=g;return e}function A(a,b){var c=a.entity;a.hasTempKey&&b.push(a.getKey().toJSON());var d;return c.entityType.navigationProperties.forEach(function(a){if(a.relatedDataProperties){var b=c.getProperty(a.name);b&&b.entityAspect.hasTempKey&&(d=d||[],d.push(a.name))}}),d}function B(a,b,c){var d=c.tempKeyMap,e=a.entityType,f=c.mergeStrategy,g=null,h=a.entityManager,i=h.entityChanged,j=[],k=tb.getRawValueFromClient;return b.entities.forEach(function(b){var c,l=b.entityAspect,m=e.getEntityKeyFromRawEntity(b,k),n=kb.fromName(l.entityState);if(n.isAdded()?(c=d[m.toString()],g=void 0===c?a.findEntityByKey(m):null):g=a.findEntityByKey(m),g)if(f===Mb.SkipMerge);else{if(f===Mb.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+m.toString()+" from being merged");var o=g.entityAspect.entityState.isUnchanged();(f===Mb.OverwriteChanges||o)&&(e._updateTargetFromRaw(g,b,k),g.entityAspect.entityState=n,i.publish({entityAction:gb.MergeOnImport,entity:g}),h._checkStateChange(g,o,n.isUnchanged()))}else g=e._createInstanceCore(),e._updateTargetFromRaw(g,b,k),void 0!==c&&(g.setProperty(e.keyProperties[0].name,c.values[0]),l.tempNavPropNames&&l.tempNavPropNames.forEach(function(a){var b=e.getNavigationProperty(a),c=b.relatedDataProperties[0].name,f=g.getProperty(c),h=new jb(b.entityType,[f]),i=d[h.toString()];g.setProperty(c,i.values[0])})),g=a.attachEntity(g,n),i.publish({entityAction:gb.AttachOnImport,entity:g}),n.isUnchanged()||h._notifyStateChange(g,!0);j.push(g)}),j}function C(a,b,c){return a=a.then(function(a){return b&&b(a),ob.resolve(a)},function(a){return c&&c(a),ob.reject(a)})}function D(a,b){var c;return c=b?b.filter(function(b){if(b.entityAspect.entityManager!==a)throw new Error("Only entities in this entityManager may be saved");return!b.entityAspect.entityState.isDetached()}):a.getChanges()}function E(a,b){a._inKeyFixup=!0,b.forEach(function(b){var c=a._entityGroupMap[b.entityTypeName];if(!c)throw new Error("Unable to locate the following fully qualified EntityType name: "+b.entityTypeName);c._fixupKey(b.tempValue,b.realValue)}),a._inKeyFixup=!1}function F(a,b){var c=a._entityGroupMap;return b?m(b).map(function(a){if(a instanceof rb)return c[a.name];throw new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null")}):f(c)}function H(a,b){var c=b.entityAspect.getKey(),d=r(b.entityType.keyProperties,c.values,function(a,b){return a.defaultValue===b?a:null}).filter(function(a){return null!==a});if(d.length)if(b.entityType.autoGeneratedKeyType!==vb.None)a.generateTempKeyValue(b);else if(d.length===c.values.length)throw new Error("Cannot attach an object of type  ("+b.entityType.name+") to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'")}function I(a,b){return b?(b=m(b),b.forEach(function(a){if(!kb.contains(a))throw new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates")}),b):null}function J(a,b,c,d){var e=b.entityType.navigationProperties;e.forEach(function(e){var f=b.getProperty(e.name);if(e.isScalar){if(!f)return;a.attachEntity(f,c,d)}else f.forEach(function(b){a.attachEntity(b,c,d)})})}function K(a,b,c,d){try{var e=a.metadataStore;if(e.isEmpty()&&d.hasServerMetadata)throw new Error("cannot execute _executeQueryCore until metadataStore is populated.");if(c.fetchStrategy===Nb.FromLocalCache)try{var f=a.executeQueryLocally(b);return ob.resolve({results:f,query:b})}catch(g){return ob.reject(g)}var h=new Rb({query:b,entityManager:a,dataService:d,mergeOptions:{mergeStrategy:c.mergeStrategy,noTracking:!!b.noTrackingEnabled}}),i=a.validationOptions.validateOnQuery;return d.adapterInstance.executeQuery(h).then(function(c){var e=x(function(){var b={isLoading:a.isLoading};return a.isLoading=!0,a._pendingPubs=[],b},function(c){a.isLoading=c.isLoading,a._pendingPubs.forEach(function(a){a()}),a._pendingPubs=null,b=null,h=null,c.error&&ob.reject(c.error)},function(){var e=d.jsonResultsAdapter.extractResults(c);e=m(e);var f=h.visitAndMerge(e,{nodeType:"root"});return i&&f.forEach(function(a){a.entityAspect&&a.entityAspect.validateEntity()}),h.processDeferred(),{results:f,query:b,entityManager:a,httpResponse:c.httpResponse,inlineCount:c.inlineCount}});return ob.resolve(e)},function(c){return c&&(c.query=b,c.entityManager=a),ob.reject(c)})}catch(g){return g&&(g.query=b),ob.reject(g)}}function L(a){var b=a.filter(function(a){return a.entityAspect.isBeingSaved=!0,a.entityAspect.entityState.isModified()&&a.entityType.concurrencyProperties.length>0});0!==b.length&&b.forEach(function(a){a.entityType.concurrencyProperties.forEach(function(b){M(a,b)})})}function M(a,b){if(!a.entityAspect.originalValues[b.name]){var c=a.getProperty(b.name);if(c||(c=b.dataType.defaultValue),b.dataType.isNumeric)a.setProperty(b.name,c+1);else if(b.dataType.isDate){for(var d=new Date,e=new Date;d.getTime()===e.getTime();)e=new Date;a.setProperty(b.name,e)}else{if(b.dataType!==lb.Guid){if(b.dataType===lb.Binary)return;throw new Error("Unable to update the value of concurrency property before saving: "+b.name)}a.setProperty(b.name,z())}}}function N(a,b){var c=a._entityGroupMap[b.name];return c||(c=new Pb(a,b),a._entityGroupMap[b.name]=c),c}function O(a,b){var c=b.getSelfAndSubtypes();return c.map(function(b){return N(a,b)})}function P(a,b){var c={},d=a.entityType||a.complexType,e=T(d),f={};return d.dataProperties.forEach(function(d){if(d.isComplexProperty)c[d.nameOnServer]=n(a.getProperty(d.name),function(a){return P(a,b)});else{var g=a.getProperty(d.name);if(g=b?b(d,g):g,void 0===g)return;g=e?e(d,g):g,void 0!==g&&(d.isUnmapped?f[d.name]=k(g):c[d.nameOnServer]=g)}}),G(f)||(c.__unmapped=f),c}function Q(b,c,d){var e=b.entityType||b.complexType,f=b.entityAspect||b.complexAspect,g=c.namingConvention.clientPropertyNameToServer,h={};return a(f.originalValues,function(a,b){var c=e.getProperty(a);b=d?d(c,b):b,void 0!==b&&(h[g(a,c)]=b)}),e.complexProperties.forEach(function(a){var e=b.getProperty(a.name);if(a.isScalar){var f=Q(e,c,d);G(f)||(h[g(a.name,a)]=f)}else{var i=e.map(function(a){return Q(a,c,d)});h[g(a.name,a)]=i}}),h}function R(b,c,d){var e=b.entityType||b.complexType,f=T(e),g=b.entityAspect||b.complexAspect,h=c.namingConvention.clientPropertyNameToServer,i={};return a(g.originalValues,function(a){var c=e.getProperty(a),g=b.getProperty(a);g=d?d(c,g):g,void 0!==g&&(g=f?f(dp,g):g,void 0!==g&&(i[h(a,c)]=g))}),e.complexProperties.forEach(function(a){var e=b.getProperty(a.name);if(a.isScalar){var f=R(e,c,d);G(f)||(i[h(a.name,a)]=f)}else{var g=e.map(function(a){return R(a,c,d)});i[h(a.name,a)]=g}}),i}function T(a){return a.serializerFn||a.metadataStore&&a.metadataStore.serializerFn}function V(){this.map={}}var W=function(a){if(arguments.length>1)throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");0===arguments.length?a={serviceName:""}:"string"==typeof a&&(a={serviceName:a}),b(this,a,!0),this.entityChanged=new _("entityChanged",this),this.validationErrorsChanged=new _("validationErrorsChanged",this),this.hasChangesChanged=new _("hasChangesChanged",this),this.clear()},Y=W.prototype;return Y._$typeName="EntityManager",_.bubbleEvent(Y,null),Y.setProperties=function(a){b(this,a,!1)},Y.createEntity=function(a,b,c,d){X(a,"entityType").isString().or().isInstanceOf(rb).check(),X(c,"entityState").isEnumOf(kb).isOptional().check(),X(d,"mergeStrategy").isEnumOf(Mb).isOptional().check(),"string"==typeof a&&(a=this.metadataStore._getEntityType(a)),c=c||kb.Added;var e;return w(this,"isLoading",!0,function(){e=a.createEntity(b)}),c!==kb.Detached&&(e=this.attachEntity(e,c,d)),e},W.importEntities=function(a,b){var c=new Qb;return c.importEntities(a,b),c},Y.acceptChanges=function(){this.getChanges().forEach(function(a){a.entityAspect.acceptChanges()})},Y.rejectChanges=function(){this.getChanges().forEach(function(a){a.entityAspect.rejectChanges()})},Y.exportEntities=function(a,b){X(b,"includeMetadata").isBoolean().isOptional().check(),b=null==b?!0:b;var c=u(this,a),d=g({},c,["tempKeys","entityGroupMap"]);b?(d=g(d,this,["dataService","saveOptions","queryOptions","validationOptions"]),d.metadataStore=this.metadataStore.exportMetadata()):(d.metadataVersion=S.metadataVersion,d.metadataStoreName=this.metadataStore.name);var e=JSON.stringify(d,null,ab.stringifyPad);return e},Y.importEntities=function(b,c){c=c||{},Z(c).whereParam("mergeStrategy").isEnumOf(Mb).isOptional().withDefault(this.queryOptions.mergeStrategy).whereParam("metadataVersionFn").isFunction().isOptional().applyAll(c);var d=this,e="string"==typeof b?JSON.parse(b):b;e.metadataStore?(this.metadataStore.importMetadata(e.metadataStore),this.dataService=e.dataService&&mb.fromJSON(e.dataService)||new mb({serviceName:e.serviceName}),this.saveOptions=new Sb(e.saveOptions),this.queryOptions=Ob.fromJSON(e.queryOptions),this.validationOptions=new fb(e.validationOptions)):c.metadataVersionFn&&c.metadataVersionFn({metadataVersion:e.metadataVersion,metadataStoreName:e.metadataStoreName});var f={};e.tempKeys.forEach(function(a){var b=jb.fromJSON(a,d.metadataStore);f[b.toString()]=new jb(b.entityType,d.keyGenerator.generateTempKeyValue(b.entityType,b.values[0]))});var g=[];return c.tempKeyMap=f,x(function(){d._pendingPubs=[]},function(){d._pendingPubs.forEach(function(a){a()}),d._pendingPubs=null},function(){a(e.entityGroupMap,function(a,b){var e=d.metadataStore._getEntityType(a,!0),f=N(d,e),h=B(f,b,c);Array.prototype.push.apply(g,h)}),g.forEach(function(a){d._linkRelatedEntities(a)})}),{entities:g,tempKeyMapping:f}},Y.clear=function(){a(this._entityGroupMap,function(a,b){b._clear()}),this._entityGroupMap={},this._unattachedChildrenMap=new V,this.keyGenerator=new this.keyGeneratorCtor,this.entityChanged.publish({entityAction:gb.Clear}),this._hasChanges&&(this._hasChanges=!1,this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},Y.createEmptyCopy=function(){var a=new W(g({},this,["dataService","metadataStore","queryOptions","saveOptions","validationOptions","keyGeneratorCtor"]));return a},Y.addEntity=function(a){return this.attachEntity(a,kb.Added)},Y.attachEntity=function(a,b,c){if(X(a,"entity").isRequired().check(),this.metadataStore._checkEntityType(a),b=X(b,"entityState").isEnumOf(kb).isOptional().check(kb.Unchanged),c=X(c,"mergeStrategy").isEnumOf(Mb).isOptional().check(Mb.Disallowed),a.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot attach this entity because the EntityType ("+a.entityType.name+") and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");var d=a.entityAspect;if(d){if(d._inProcessEntity)return d._inProcessEntity}else d=new hb(a);var e=d.entityManager;if(e){if(e===this)return a;throw new Error("This entity already belongs to another EntityManager")}var f,g=this;return w(this,"isLoading",!0,function(){b.isAdded()&&H(g,a),f=g._attachEntityCore(a,b,c),d._inProcessEntity=f;try{J(g,a,b,c)}finally{d._inProcessEntity=null}}),this.validationOptions.validateOnAttach&&f.entityAspect.validateEntity(),b.isUnchanged()||this._notifyStateChange(f,!0),this.entityChanged.publish({entityAction:gb.Attach,entity:f}),f},Y.detachEntity=function(a){X(a,"entity").isEntity().check();var b=a.entityAspect;if(!b)return!1;if(b.entityManager!==this)throw new Error("This entity does not belong to this EntityManager.");return b.setDetached()},Y.fetchMetadata=function(a,b,c){"function"==typeof a?(c=b,b=a,a=null):(X(a,"dataService").isInstanceOf(mb).isOptional().check(),X(b,"callback").isFunction().isOptional().check(),X(c,"errorCallback").isFunction().isOptional().check());var d=this.metadataStore.fetchMetadata(a||this.dataService);return C(d,b,c)},Y.executeQuery=function(a,b,c){X(a,"query").isInstanceOf(zb).or().isString().check(),X(b,"callback").isFunction().isOptional().check(),X(c,"errorCallback").isFunction().isOptional().check();var d,e=Ob.resolve([a.queryOptions,this.queryOptions,Ob.defaultInstance]),f=mb.resolve([a.dataService,this.dataService]);if(!f.hasServerMetadata||this.metadataStore.hasMetadataFor(f.serviceName))d=K(this,a,e,f);
else{var g=this;d=this.fetchMetadata(f).then(function(){return K(g,a,e,f)})}return C(d,b,c)},Y.executeQueryLocally=function(a){X(a,"query").isInstanceOf(zb).check();var b=this.metadataStore,c=a._getFromEntityType(b,!0),d=O(this,c),e=a._toFilterFunction(c);if(e)var f=function(a){return a&&!a.entityAspect.entityState.isDeleted()&&e(a)};else var f=function(a){return a&&!a.entityAspect.entityState.isDeleted()};var g=[];d.forEach(function(a){g.push.apply(g,a._entities.filter(f))});var h=a._toOrderByComparer(c);h&&g.sort(h);var i=a.skipCount;i&&(g=g.slice(i));var j=a.takeCount;j&&(g=g.slice(0,j));var k=a.selectClause;if(k){var l=k.toFunction();g=g.map(function(a){return l(a)})}return g},Y.saveChanges=function(a,b,f,g){X(a,"entities").isOptional().isArray().isEntity().check(),X(b,"saveOptions").isInstanceOf(Sb).isOptional().check(),X(f,"callback").isFunction().isOptional().check(),X(g,"errorCallback").isFunction().isOptional().check(),b=b||this.saveOptions||Sb.defaultInstance;var h=null==a,j=D(this,a);if(0===j.length){var k={entities:[],keyMappings:[]};return f&&f(k),ob.resolve(k)}if(!b.allowConcurrentSaves){var l=j.some(function(a){return a.entityAspect.isBeingSaved});if(l){var m=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false");return g&&g(m),ob.reject(m)}}if(c(j),this.validationOptions.validateOnSave){var n=j.filter(function(a){var b=a.entityAspect,c=b.entityState.isDeleted()||b.validateEntity();return!c});if(n.length>0){var o=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail");return o.entityErrors=d(n),g&&g(o),ob.reject(o)}}L(j);var p=mb.resolve([b.dataService,this.dataService]),q={entityManager:this,dataService:p,resourceName:b.resourceName||this.saveOptions.resourceName||"SaveChanges"},r={entities:j,saveOptions:b},t=this;return p.adapterInstance.saveChanges(q,r).then(function(a){E(t,a.keyMappings);var b=new Rb({query:null,entityManager:t,mergeOptions:{mergeStrategy:Mb.OverwriteChanges},dataService:p}),c=b.visitAndMerge(a.entities,{nodeType:"root"});return s(j,!1),t._hasChanges=h&&i(j,c)?!1:t._hasChangesCore(),t._hasChanges||t.hasChangesChanged.publish({entityManager:t,hasChanges:!1}),a.entities=c,f&&f(a),ob.resolve(a)},function(a){return e(q,a),s(j,!1),g&&g(a),ob.reject(a)})},Y._findEntityGroup=function(a){return this._entityGroupMap[a.name]},Y.getEntityByKey=function(){var a,b=p(this,arguments).entityKey,c=b._subtypes;if(!c)return a=this._findEntityGroup(b.entityType),a&&a.findEntityByKey(b);for(var d=0,e=c.length;e>d;d++){a=this._findEntityGroup(c[d]);var f=a&&a.findEntityByKey(b);if(f)return f}},Y.fetchEntityByKey=function(){var a,b=p(this,arguments),c=b.entityKey,d=0===b.remainingArgs.length?!1:!!b.remainingArgs[0],e=!1;return d&&(a=this.getEntityByKey(c),e=a&&a.entityAspect.entityState.isDeleted(),e&&(a=null,this.queryOptions.mergeStrategy===Mb.OverwriteChanges&&(e=!1))),a||e?ob.resolve({entity:a,entityKey:c,fromCache:!0}):zb.fromEntityKey(c).using(this).execute().then(function(b){return a=0===b.results.length?null:b.results[0],ob.resolve({entity:a,entityKey:c,fromCache:!1})})},Y.findEntityByKey=function(a){return this.getEntityByKey(a)},Y.generateTempKeyValue=function(a){X(a,"entity").isEntity().check();var b=a.entityType,c=this.keyGenerator.generateTempKeyValue(b),d=b.keyProperties[0];return a.setProperty(d.name,c),a.entityAspect.hasTempKey=!0,c},Y.hasChanges=function(a){return this._hasChanges?void 0===a?this._hasChanges:this._hasChangesCore(a):!1},Y._hasChangesCore=function(a){a=j(this,a);var b=F(this,a);return b.some(function(a){return a.hasChanges()})},Y.getChanges=function(a){a=j(this,a);var b=[kb.Added,kb.Modified,kb.Deleted];return l(this,a,b)},Y.rejectChanges=function(){if(!this._hasChanges)return[];var a=[kb.Added,kb.Modified,kb.Deleted],b=l(this,null,a);return this._hasChanges=!1,b.forEach(function(a){a.entityAspect.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),b},Y.getEntities=function(a,b){return a=j(this,a),X(b,"entityStates").isOptional().isEnumOf(kb).or().isNonEmptyArray().isEnumOf(kb).check(),b&&(b=I(this,b)),l(this,a,b)},Y._checkStateChange=function(a,b,c){b?c||this._notifyStateChange(a,!0):c&&this._notifyStateChange(a,!1)},Y._notifyStateChange=function(a,b){this.entityChanged.publish({entityAction:gb.EntityStateChange,entity:a}),b?this._hasChanges||(this._hasChanges=!0,this.hasChangesChanged.publish({entityManager:this,hasChanges:!0})):this._hasChanges&&(this._hasChanges=this._hasChangesCore(),this._hasChanges||this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},Y._linkRelatedEntities=function(a){var b=this,c=a.entityAspect;w(b,"isLoading",!0,function(){var d=b._unattachedChildrenMap,e=c.getKey(),f=d.getTuples(e);f&&f.forEach(function(b){var c,f,g=b.children.filter(function(a){return a.entityAspect.entityState!==kb.Detached}),h=b.navigationProperty;if(h.inverse)if(c=h,f=h.inverse,f.isScalar){var i=g[0];a.setProperty(f.name,i),i.setProperty(c.name,a)}else{var j=a.getProperty(f.name);g.forEach(function(b){j.push(b),b.setProperty(c.name,a)})}else if(h.parentType===a.entityType)if(f=h,f.isScalar)a.setProperty(f.name,g[0]);else{var j=a.getProperty(f.name);g.forEach(function(a){j._push(a)})}else c=h,g.forEach(function(b){b.setProperty(c.name,a)});d.removeChildren(e,c)}),a.entityType.navigationProperties.forEach(function(e){if(e.isScalar){var f=a.getProperty(e.name);if(f)return}var g=c.getParentKey(e);if(g){if(g._isEmpty())return;var h=b.findEntityByKey(g);h?a.setProperty(e.name,h):d.addChild(g,e,a)}}),a.entityType.foreignKeyProperties.forEach(function(c){var e=c.inverseNavigationProperty;if(e){var f=a.getProperty(c.name),g=new jb(e.parentType,[f]),h=b.findEntityByKey(g);h?e.isScalar?h.setProperty(e.name,a):b.isLoading?h.getProperty(e.name)._push(a):h.getProperty(e.name).push(a):d.addChild(g,e,a)}})})},Y._attachEntityCore=function(a,b,c){var d=N(this,a.entityType),e=d.attachEntity(a,b,c);return this._linkRelatedEntities(e),e},Y.helper={unwrapInstance:P,unwrapOriginalValues:Q,unwrapChangedValues:R},V.prototype.addChild=function(a,b,c){var d=this.getTuple(a,b);d||(d={navigationProperty:b,children:[]},t(this.map,a.toString()).push(d)),d.children.push(c)},V.prototype.removeChildren=function(a,b){var c=this.map[a.toString()];c&&(q(c,function(a){return a.navigationProperty===b}),c.length||delete this.map[a.toString()])},V.prototype.getChildren=function(a,b){var c=this.getTuple(a,b);return c?c.children.filter(function(a){return!a.entityAspect.entityState.isDetached()}):null},V.prototype.getTuple=function(a,b){var c=this.map[a.toString()];if(!c)return null;var d=o(c,function(a){return a.navigationProperty===b});return d},V.prototype.getTuples=function(a){return this.map[a.toString()]},W}();S.EntityManager=Qb;var Rb=function(){function b(a,b,e,g){if(e.ignore||null==b)return null;if(e.nodeRefId){var h=f(a,e.nodeRefId);return"function"==typeof h&&null!=g?(a.deferredFns.push(function(){g(h)}),void 0):h}if(e.entityType){var j=e.entityType;return a.mergeOptions.noTracking?(b=c(a,j,b),j.noTrackingFn&&(b=j.noTrackingFn(b,j)),e.nodeId&&(a.refMap[e.nodeId]=b),b):j.isComplexType?c(a,j,b):i(a,b,e)}return"object"!=typeof b||C(b)||(b=d(a,b)),e.nodeId&&(a.refMap[e.nodeId]=b),b}function c(a,b,d){var f={};return b.dataProperties.forEach(function(b){f[b.name]=b.isComplexProperty?n(d[b.nameOnServer],function(d){return c(a,b.dataType,d)}):u(d[b.nameOnServer],b.dataType)}),b.navigationProperties&&b.navigationProperties.forEach(function(b){var c={nodeType:"navProp",navigationProperty:b};e(d[b.nameOnServer],a,c,f,b.name)}),f}function d(b,c){var d=b.metadataStore.namingConvention.serverPropertyNameToClient,f={};return a(c,function(a,c){var g=d(a),h={nodeType:"anonProp",propertyName:g};e(c,b,h,f,g)}),f}function e(a,c,d,e,f){var g=c.jsonResultsAdapter,h=g.visitNode(a,c,d)||{};a=h.node||a,h.ignore||(Array.isArray(a)?(d.nodeType=d.nodeType+"Item",e[f]=a.map(function(a,i){return h=g.visitNode(a,c,d)||{},a=h.node||a,b(c,a,h,function(a){e[f][i]=a()})})):e[f]=b(c,a,h,function(a){e[f]=a()}))}function f(a,b){var c=a.refMap[b];return void 0===c?function(){return a.refMap[b]}:c}function h(a,b,c){var d=c._$meta.nodeId;null!=d&&(a.refMap[d]=b)}function i(a,b,c){b._$meta=c;var d=a.entityManager,e=c.entityType;"string"==typeof e&&(e=a.metadataStore._getEntityType(e,!1)),b.entityType=e;var f=a.mergeOptions.mergeStrategy,g=null==a.query,h=e.getEntityKeyFromRawEntity(b,a.rawValueFn),i=d.findEntityByKey(h);if(i){if(g&&i.entityAspect.entityState.isDeleted())return d.detachEntity(i),i;var l=i.entityAspect.entityState;if(f===Mb.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+h.toString()+" from being merged");if(f===Mb.SkipMerge)j(a,i,b);else if(f===Mb.OverwriteChanges||l.isUnchanged()){k(a,i,b),i.entityAspect.wasLoaded=!0,c.extra&&(i.entityAspect.extraMetadata=c.extra),i.entityAspect.entityState=kb.Unchanged,i.entityAspect.originalValues={},i.entityAspect.propertyChanged.publish({entity:i,propertyName:null});var m=g?gb.MergeOnSave:gb.MergeOnQuery;d.entityChanged.publish({entityAction:m,entity:i}),l.isUnchanged||d._notifyStateChange(i,!1)}else j(a,i,b)}else i=e._createInstanceCore(),k(a,i,b),c.extra&&(i.entityAspect.extraMetadata=c.extra),d._attachEntityCore(i,kb.Unchanged,Mb.Disallowed),i.entityAspect.wasLoaded=!0,d.entityChanged.publish({entityAction:gb.AttachOnQuery,entity:i});return i}function j(a,b,c){h(a,b,c),c.entityType.navigationProperties.forEach(function(b){b.isScalar?o(a,c,b):p(a,c,b)})}function k(a,b,c){h(a,b,c);var d=b.entityType;d._updateTargetFromRaw(b,c,a.rawValueFn),d.navigationProperties.forEach(function(d){d.isScalar?l(a,d,b,c):m(a,d,b,c)})}function l(a,b,c,d){var e=o(a,d,b);null!=e&&("function"==typeof e?a.deferredFns.push(function(){e=e(),q(e,c,b)}):q(e,c,b))}function m(a,b,c,d){var e=p(a,d,b);if(null!=e){var f=b.inverse;if(f){var g=c.getProperty(b.name);g.wasLoaded=!0,e.forEach(function(b){"function"==typeof b?a.deferredFns.push(function(){b=b(),r(b,g,c,f)}):r(b,g,c,f)})}}}function o(a,b,c){var d=b[c.nameOnServer];if(!d)return null;var e=a.visitAndMerge(d,{nodeType:"navProp",navigationProperty:c});return e}function p(a,b,c){var d=b[c.nameOnServer];if(!d)return null;if(!Array.isArray(d)&&(d=d.results,!d))return null;var e=a.visitAndMerge(d,{nodeType:"navPropItem",navigationProperty:c});return e}function q(a,b,c){if(a){var d=c.name,e=b.getProperty(d);if(e!==a){b.setProperty(d,a);var f=c.inverse;if(!f)return;if(f.isScalar)a.setProperty(f.name,b);else{var g=a.getProperty(f.name);g.push(b)}}}}function r(a,b,c,d){if(a){var e=a.getProperty(d.name);e!==c&&(b.push(a),a.setProperty(d.name,c))}}var s=function(a){g(this,a,["query","entityManager","dataService","mergeOptions"]),this.refMap={},this.deferredFns=[],this.jsonResultsAdapter=this.dataService.jsonResultsAdapter,this.metadataStore=this.entityManager.metadataStore,this.rawValueFn=tb.getRawValueFromServer},t=s.prototype,u=lb.parseRawValue;return t._$typeName="MappingContext",t.getUrl=function(){return this.dataService.makeUrl(this.metadataStore.toQueryString(this.query))},t.visitAndMerge=function(a,c){var d=this.query,e=this.jsonResultsAdapter;c=c||{};var f=this;return n(a,function(a){if(null==d&&a.entityAspect)return a.entityAspect.entityState.isDeleted()?f.entityManager.detachEntity(a):a.entityAspect.acceptChanges(),a;var g=e.visitNode(a,f,c)||{};return a=g.node||a,d&&"root"===c.nodeType&&!g.entityType&&(g.entityType=d._getToEntityType&&d._getToEntityType(f.metadataStore)),b(f,a,g)})},t.processDeferred=function(){this.deferredFns.length>0&&this.deferredFns.forEach(function(a){a()})},s}(),Sb=function(){function a(a,b){return b&&Z(b).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(mb).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(a),a}var b=function(b){a(this,b)},c=b.prototype;return c._$typeName="SaveOptions",c.setAsDefault=function(){return i(this,b)},c.using=function(b){return a(this,b)},b.defaultInstance=new b({allowConcurrentSaves:!1}),b}();S.SaveOptions=Sb,S.AbstractDataServiceAdapter=function(){function a(a,c,d){var e=b(c);return d&&(e.message=d+"; "+e.message),a.reject(e)}function b(a){var b=new Error;b.httpResponse=a,b.status=a.status;var e=a.data;if("string"==typeof e)try{e=JSON.parse(e)}catch(f){}if(e){var g=e.EntityErrors||e.entityErrors||e.Errors||e.errors;g&&a.saveContext?d(b,g,a.saveContext):b.message=c(e)}else b.message=a.error&&a.error.toString();return b}function c(a){for(;a.InnerException;)a=a.InnerException;return a.ExceptionMessage||a.Message||a.toString()}function d(a,b,c){a.message="Server side errors encountered - see the entityErrors collection on this object for more detail";var d=c.entityManager.metadataStore.namingConvention.serverPropertyNameToClient;a.entityErrors=b.map(function(a){return{errorName:a.ErrorName,entityTypeName:pb.normalizeTypeName(a.EntityTypeName),keyValues:a.KeyValues,propertyName:a.PropertyName&&d(a.PropertyName),errorMessage:a.ErrorMessage}})}var e,f=function(){};return f.prototype.checkForRecomposition=function(a){"ajax"===a.interfaceName&&a.isDefault&&this.initialize()},f.prototype.initialize=function(){if(e=S.config.getAdapterInstance("ajax"),!e)throw new Error("Unable to initialize ajax for WebApi.");var a=e.ajax;if(!a)throw new Error("Breeze was unable to find an 'ajax' adapter")},f.prototype.fetchMetadata=function(b,c){var d=c.serviceName,f=c.makeUrl("Metadata"),g=ob.defer();return e.ajax({type:"GET",url:f,dataType:"json",success:function(e){if(b.hasMetadataFor(d))return g.resolve("already fetched");var h=e.data;try{var i="string"==typeof h?JSON.parse(h):h;b.importMetadata(i)}catch(j){var k="Unable to either parse or import metadata: "+j.message;return a(g,e,"Metadata query failed for: "+f+". "+k)}b.hasMetadataFor(d)||b.addDataService(c),g.resolve(i)},error:function(b){a(g,b,"Metadata query failed for: "+f)}}),g.promise},f.prototype.executeQuery=function(b){var c=ob.defer(),d=b.getUrl(),f={type:"GET",url:d,params:b.query.parameters,dataType:"json",success:function(b){var d=b.data;try{var e;e=d&&d.Results?{results:d.Results,inlineCount:d.InlineCount,httpResponse:b}:{results:d,httpResponse:b},c.resolve(e)}catch(f){f instanceof Error?c.reject(f):a(b)}},error:function(b){a(c,b)}};return b.dataService.useJsonp&&(f.dataType="jsonp",f.crossDomain=!0),e.ajax(f),c.promise},f.prototype.saveChanges=function(b,c){var d=ob.defer();c=this._prepareSaveBundle(c,b);var f=JSON.stringify(c),g=b.dataService.makeUrl(b.resourceName),h=this;return e.ajax({type:"POST",url:g,dataType:"json",contentType:"application/json",data:f,success:function(c){var e=c.data;c.saveContext=b;var f=e.Errors||e.errors;if(f)a(d,c);else{var g=h._prepareSaveResult(b,e);d.resolve(g)}},error:function(c){c.saveContext=b,a(d,c)}}),d.promise},f.prototype._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle")},f.prototype._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult")},f.prototype.jsonResultsAdapter=new nb({name:"noop",visitNode:function(){return{}}}),f}(),function(a){S?a(S):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],a)}(function(a){function b(a){var c,d,e="";for(var f in a){var g=a[f];if(g instanceof Array)for(var h=0;h<g.length;++h)c=g[h],fullSubName=f+"["+h+"]",d={},d[fullSubName]=c,e+=b(d)+"&";else if(g instanceof Object)for(var i in g)c=g[i],fullSubName=f+"["+i+"]",d={},d[fullSubName]=c,e+=b(d)+"&";else void 0!==g&&(e+=encodeURIComponent(f)+"="+encodeURIComponent(g)+"&")}return e.length?e.substr(0,e.length-1):e}var c,d,e=a.core,f=function(){this.name="angular",this.defaultSettings={}};f.prototype.initialize=function(){var a=e.requireLib("angular");if(a){var b=a.injector(["ng"]);b.invoke(["$http","$rootScope",function(a,b){c=a,d=b}])}},f.prototype.setHttp=function(a){c=a,d=null},f.prototype.ajax=function(a){if(!c)throw new Error("Unable to locate angular for ajax adapter");var f={method:a.type,url:a.url,dataType:a.dataType,contentType:a.contentType,crossDomain:a.crossDomain};if(a.params){var g=f.url.indexOf("?")>=0?"&":"?";f.url=f.url+g+b(a.params)}if(a.data&&(f.data=a.data),!e.isEmpty(this.defaultSettings)){var h=e.extend({},this.defaultSettings);f=e.extend(h,f)}c(f).success(function(b,c,d){"null"===b&&(b=null);var e={data:b,status:c,getHeaders:d,config:a};a.success(e)}).error(function(b,c,d){var e={data:b,status:c,getHeaders:d,config:a};a.error(e)}),d&&d.$digest()},a.config.registerAdapter("ajax",f)}),function(a){S?a(S):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],a)}(function(a){function b(a){return function(b){return b&&b.length>0?a.getResponseHeader(b):a.getAllResponseHeaders()}}var c,d=a.core,e=function(){this.name="jQuery",this.defaultSettings={}};e.prototype.initialize=function(){c=d.requireLib("jQuery")},e.prototype.ajax=function(a){if(!c)throw new Error("Unable to locate jQuery");var e={type:a.type,url:a.url,data:a.params||a.data,dataType:a.dataType,contentType:a.contentType,crossDomain:a.crossDomain};if(!d.isEmpty(this.defaultSettings)){var f=d.extend({},this.defaultSettings);e=d.extend(f,e)}e.success=function(c,d,e){var f={data:c,status:e.status,getHeaders:b(e),config:a};a.success(f),e.onreadystatechange=null,e.abort=null},e.error=function(c,d,e){var f={data:c.responseText,status:c.status,getHeaders:b(c),error:e,config:a};a.error(f),c.onreadystatechange=null,c.abort=null},c.ajax(e)},a.config.registerAdapter("ajax",e)}),function(a){S?a(S):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!S&&define(["breeze"],a)}(function(a){function b(a,b){return a.isUnmapped?void 0:(a.dataType===lb.DateTimeOffset?b=b&&new Date(b.getTime()-6e4*b.getTimezoneOffset()):a.dataType.quoteJsonOData&&(b=null!=b?b.toString():b),b)}function c(a,c){var e=[],f=[],g=[],h=a.dataService.serviceName,i=a.entityManager,j=i.helper,k=0;return c.entities.forEach(function(a){var c=a.entityAspect;k+=1;var l={headers:{"Content-ID":k,DataServiceVersion:"2.0"}};if(g[k]=a,c.entityState.isAdded())l.requestUri=a.entityType.defaultResourceName,l.method="POST",l.data=j.unwrapInstance(a,b),f[k]=c.getKey();else if(c.entityState.isModified())d(l,c,h),l.method="MERGE",l.data=j.unwrapChangedValues(a,i.metadataStore,b);else{if(!c.entityState.isDeleted())return;d(l,c,h),l.method="DELETE"}e.push(l)}),a.contentKeys=g,a.tempKeys=f,{__batchRequests:[{__changeRequests:e}]}}function d(a,b,c){var d=b.extraMetadata,e=d.uri||d.id;h.stringStartsWith(e,c)&&(e=e.substring(c.length)),a.requestUri=e,d.etag&&(a.headers["If-Match"]=d.etag)}function e(a,b){var c=new Error,d=a.response;if(c.message=d.statusText,c.statusText=d.statusText,c.status=d.statusCode,b&&(c.url=b),c.body=d.body,d.body){var e;try{var g=JSON.parse(d.body);c.body=g,g["odata.error"]&&(g=g["odata.error"]);var h="";do e=g.error||g.innererror,e||(h+=f(g)),e=e||g.internalexception,g=e||g;while(e);h.length>0&&(c.message=h)}catch(i){}}return c}function f(a){var b=a.message||"";return("string"==typeof b?b:b.value)+"; "}var g,h=a.core,i=a.MetadataStore,j=a.JsonResultsAdapter,k=a.DataProperty,l=function(){this.name="OData"};l.prototype.initialize=function(){g=h.requireLib("OData","Needed to support remote OData services"),g.jsonHandler.recognizeDates=!0},l.prototype.executeQuery=function(a){var b=ob.defer(),c=a.getUrl();return g.read({requestUri:c,headers:{DataServiceVersion:"2.0"}},function(a){var c;return a.__count&&(c=parseInt(a.__count,10)),b.resolve({results:a.results,inlineCount:c})},function(a){return b.reject(e(a,c))}),b.promise},l.prototype.fetchMetadata=function(a,b){var c=ob.defer(),d=b.serviceName,f=b.makeUrl("$metadata");return g.read(f,function(e){if(!e||!e.dataServices){var g=new Error("Metadata query failed for: "+f);return c.reject(g)}var h=e.dataServices;if(!a.hasMetadataFor(d)){try{a.importMetadata(h)}catch(i){return c.reject(new Error("Metadata query failed for "+f+"; Unable to process returned metadata: "+i.message))}a.addDataService(b)}return c.resolve(h)},function(a){var b=e(a,f);return b.message="Metadata query failed for: "+f+"; "+(b.message||""),c.reject(b)},g.metadataHandler),c.promise},l.prototype.saveChanges=function(a,b){var d=ob.defer(),f=(a.entityManager.helper,a.dataService.makeUrl("$batch")),h=c(a,b),i=a.tempKeys,j=a.contentKeys;return g.request({headers:{DataServiceVersion:"2.0"},requestUri:f,method:"POST",data:h},function(a){var b=[],c=[],g={entities:b,keyMappings:c};return a.__batchResponses.forEach(function(a){a.__changeResponses.forEach(function(a){var g=a.response||a,h=g.statusCode;if(!h||h>=400)return d.reject(e(a,f));var l=a.headers["Content-ID"],m=a.data;if(m){var n=i[l];if(n){var o=n.entityType;if(o.autoGeneratedKeyType!==vb.None){var p=n.values[0],q=o.getEntityKeyFromRawEntity(m,k.getRawValueFromServer),r={entityTypeName:o.name,tempValue:p,realValue:q.values[0]};c.push(r)}}b.push(m)}else{var s=j[l];b.push(s)}})}),d.resolve(g)},function(a){return d.reject(e(a,f))},g.batchHandler),d.promise},l.prototype.jsonResultsAdapter=new j({name:"OData_default",visitNode:function(a,b,c){var d={};if(null==a)return d;if(null!=a.__metadata){var e=i.normalizeTypeName(a.__metadata.type),f=e&&b.entityManager.metadataStore.getEntityType(e,!0);f&&f._mappedPropertiesCount<=Object.keys(a).length-1&&(d.entityType=f,d.extra=a.__metadata)}a.results&&(d.node=a.results);var g=c.propertyName;return d.ignore=null!=a.__deferred||"__metadata"===g||"EntityKey"===g&&a.$type&&h.stringStartsWith(a.$type,"System.Data"),d}}),a.config.registerAdapter("dataService",l)}),function(a){S?a(S):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!S&&define(["breeze"],a)}(function(a){var b=(a.core,a.MetadataStore),c=a.JsonResultsAdapter,d=a.AbstractDataServiceAdapter,e=function(){this.name="webApi"};e.prototype=new d,e.prototype._prepareSaveBundle=function(a,b){var c=b.entityManager,d=c.metadataStore,e=c.helper;return a.entities=a.entities.map(function(a){var b=e.unwrapInstance(a),c=null;a.entityType.autoGeneratedKeyType!==vb.None&&(c={propertyName:a.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:a.entityType.autoGeneratedKeyType.name});var f=e.unwrapOriginalValues(a,d);return b.entityAspect={entityTypeName:a.entityType.name,defaultResourceName:a.entityType.defaultResourceName,entityState:a.entityAspect.entityState.name,originalValuesMap:f,autoGeneratedKey:c},b}),a.saveOptions={tag:a.saveOptions.tag},a},e.prototype._prepareSaveResult=function(a,c){var d=c.KeyMappings.map(function(a){var c=b.normalizeTypeName(a.EntityTypeName);return{entityTypeName:c,tempValue:a.TempValue,realValue:a.RealValue}});return{entities:c.Entities,keyMappings:d,httpResponse:c.httpResponse}},e.prototype.jsonResultsAdapter=new c({name:"webApi_default",visitNode:function(a,c,d){if(null==a)return{};var e=b.normalizeTypeName(a.$type),f=e&&c.entityManager.metadataStore._getEntityType(e,!0),g=d.propertyName,h=g&&"$"===g.substr(0,1);return{entityType:f,nodeId:a.$id,nodeRefId:a.$ref,ignore:h}}}),a.config.registerAdapter("dataService",e)}),function(a){S?a(S):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!S&&define(["breeze"],a)}(function(a){var b,c,d,e,f=a.core,g=(a.ComplexAspect,Object.prototype.hasOwnProperty),h=function(){this.name="backbone"};h.prototype.initialize=function(){b=f.requireLib("Backbone"),c=f.requireLib("_;underscore"),d=b.Model.prototype.set,e=b.Model.prototype.get},h.prototype.createCtor=function(c){var d={};c.dataProperties.forEach(function(a){d[a.name]=a.defaultValue});var e=b.Model.extend({defaults:d,initialize:function(){if(c.navigationProperties){var d=this;c.navigationProperties.forEach(function(c){if(!c.isScalar){var e=a.makeRelationArray([],d,c);b.Model.prototype.set.call(d,c.name,e)}})}}});return e},h.prototype.getTrackablePropertyNames=function(a){var b=[];for(var c in a.attributes)b.push(c);return b},h.prototype.initializeEntityPrototype=function(a){a.getProperty=function(a){return this.get(a)},a.setProperty=function(a,b){return this.set(a,b),this},a.set=function(a,b,f){var h=this.entityAspect||this.complexAspect;if(!h)return d.call(this,a,b,f);var i,j,k,l=this,m=this.entityType||this.complexType;if(c.isObject(a)||null==a){if(i=a,f=b,!this._validate(i,f))return!1;for(k in i)if(g.call(i,k)){if(j=m.getProperty(k),null==j)throw new Error("Unknown property: "+a);var n=function(a){return function(b){return 0===arguments.length?e.call(l,a):d.call(l,a,b,f)}}(k);this._$interceptor(j,i[k],n)}}else{if(i={},i[a]=b,f||(f={}),!this._validate(i,f))return!1;if(j=m.getProperty(a),null==j)throw new Error("Unknown property: "+a);k=a,this._$interceptor(j,b,function(a){return 0===arguments.length?e.call(l,k):d.call(l,k,a,f)})}return this}},h.prototype.startTracking=function(c){if(!(c instanceof b.Model))throw new Error("This entity is not an Backbone.Model instance");var g=c.entityType||c.complexType,h=c.attributes;g.dataProperties.forEach(function(b){var e=b.name,f=h[e];b.isComplexProperty?f=b.isScalar?b.dataType._createInstanceCore(c,b):a.makeComplexArray([],c,b):b.isScalar?void 0===f&&(f=b.defaultValue):f=a.makePrimitiveArray([],c,b),d.call(c,e,f)}),g.navigationProperties&&g.navigationProperties.forEach(function(b){var g;if(b.name in h){var i=e.call(c,b.name);if(b.isScalar){if(i&&!i.entityType)throw g=f.formatString("The value of the '%1' property for entityType: '%2' must be either null or another entity",b.name,c.entityType.name),new Error(g)}else if(i){if(!i.parentEntity)throw g=f.formatString("The value of the '%1' property for entityType: '%2' must be either null or a Breeze relation array",b.name,c.entityType.name),new Error(g)}else i=a.makeRelationArray([],c,b),d.call(c,b.name,i)}else b.isScalar?d.call(c,b.name,null):(i=a.makeRelationArray([],c,b),d.call(c,b.name,i))})},a.config.registerAdapter("modelLibrary",h)}),function(a){S?a(S):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!S&&define(["breeze"],a)}(function(a){function b(a){var b=a.entityType||a.complexType,c=b._extra,e=c.alreadyWrappedProps||{};b.getProperties().forEach(function(b){var c=b.name;e[c]||(c in a?f(a,b):d(a,b),e[c]=!0)}),c.alreadyWrappedProps=e}function c(a){var b=g(a),c=Object.getPrototypeOf(a),d=c.entityType||c.complexType;return d.getProperties().forEach(function(b){var c=b.name;if(a.hasOwnProperty(c)){var d=a[c];delete a[c],a[c]=d}}),b}function d(a,b){var c=b.name,d=a._pendingBackingStores;d||(d=[],a._pendingBackingStores=d);var f={get:function(){var a=this._backingStore||g(this);return a[c]},set:function(a){var d=this._backingStore||h(this),f=e(d,c);this._$interceptor(b,a,f)},enumerable:!0,configurable:!0};Object.defineProperty(a,c,f)}function e(a,b){return function(){return 0==arguments.length?a[b]:(a[b]=arguments[0],void 0)}}function f(a,b){if(!a.hasOwnProperty(b.name)){var c=Object.getPrototypeOf(a);return f(c,b),void 0}var d=Object.getOwnPropertyDescriptor(a,b.name);if(d.configurable&&!d.value&&d.set){var e=function(a){return function(){return 0==arguments.length?d.get.bind(a)():(d.set.bind(a)(arguments[0]),void 0)}},g={get:function(){return d.get.bind(this)()},set:function(a){this._$interceptor(b,a,e(this))},enumerable:d.enumerable,configurable:!0};Object.defineProperty(a,b.name,g)}}function g(a){var b=Object.getPrototypeOf(a);i(b);var c=a._backingStore;return c||(c={},a._backingStore=c),c}function h(a){var b=Object.getPrototypeOf(a),c=b._pendingBackingStores,d=j.arrayFirst(c,function(b){return b.entity===a});return d?d.backingStore:(bs={},c.push({entity:a,backingStore:bs}),bs)}function i(a){var b=a._pendingBackingStores;b&&(b.forEach(function(a){a.entity._backingStore=a.backingStore}),b.length=0)}var j=a.core,k=function(){this.name="backingStore"};k.prototype.initialize=function(){},k.prototype.getTrackablePropertyNames=function(a){var b=[];for(var c in a)if("entityType"!==c&&"_$typeName"!==c&&"_pendingSets"!==c&&"_backingStore"!==c){var d=a[c];j.isFunction(d)||b.push(c)}return b},k.prototype.initializeEntityPrototype=function(a){a.getProperty=function(a){return this[a]},a.setProperty=function(a,b){return this[a]=b,this},b(a)},k.prototype.startTracking=function(b){var d=c(b),e=b.entityType||b.complexType;e.getProperties().forEach(function(c){var e=c.name,f=b[e];if(c.isDataProperty)c.isComplexProperty?f=c.isScalar?c.dataType._createInstanceCore(b,c):a.makeComplexArray([],b,c):c.isScalar?void 0===f&&(f=c.defaultValue):f=a.makePrimitiveArray([],b,c);else{if(!c.isNavigationProperty)throw new Error("unknown property: "+e);if(void 0!==f)throw new Error("Cannot assign a navigation property in an entity ctor.: "+c.Name);f=c.isScalar?null:a.makeRelationArray([],b,c)}d[e]=f})},a.config.registerAdapter("modelLibrary",k)}),function(a){S?a(S):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!S&&define(["breeze"],a)}(function(a){function b(){try{return Object.getPrototypeOf&&Object.defineProperty({},"x",{})}catch(a){return!1}}function c(a){var b=a.entityType||a.complexType;if(es5Descriptors={},b.getProperties().forEach(function(b){propDescr=d(a,b.name),propDescr&&(es5Descriptors[b.name]=propDescr)}),!G(es5Descriptors)){var c=b._extra;c.es5Descriptors=es5Descriptors,b._koDummy=h.observable(null)}}function d(a,c){if(!b())return null;if(a.hasOwnProperty(c))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(a,c);var e=Object.getPrototypeOf(a);return e?d(e,c):null}function e(b,c,d){if(c.isDataProperty)c.isComplexProperty?d=c.isScalar?c.dataType._createInstanceCore(b,c):a.makeComplexArray([],b,c):c.isScalar?void 0===d&&(d=c.defaultValue):d=a.makePrimitiveArray([],b,c);else{if(!c.isNavigationProperty)throw new Error("unknown property: "+c.name);if(void 0!==d)throw new Error("Cannot assign a navigation property in an entity ctor.: "+c.name);d=c.isScalar?null:a.makeRelationArray([],b,c)}return d}function f(a){a._koObj._suppressBreeze=!0}function g(a){var b=a.array._koObj;b._suppressBreeze?b._suppressBreeze=!1:b.valueHasMutated()}var h,i=a.core,j=function(){this.name="ko"};j.prototype.initialize=function(){h=i.requireLib("ko","The Knockout library"),h.extenders.intercept=function(a,b){var c,d=b.instance,e=b.property;return c=a.splice?h.computed({read:a}):h.computed({read:a,write:function(b){return d._$interceptor(e,b,a),d}})}},j.prototype.getTrackablePropertyNames=function(a){var b=[];for(var c in a)if("entityType"!==c&&"_$typeName"!==c){var e=d(a,c);if(e&&e.get)b.push(c);else{var f=a[c];h.isObservable(f)?b.push(c):i.isFunction(f)||b.push(c)}}return b},j.prototype.initializeEntityPrototype=function(a){a.getProperty=function(a){return this[a]()},a.setProperty=function(a,b){return this[a](b),this},b()&&c(a)},j.prototype.startTracking=function(a){var b=a.entityType||a.complexType,c=b._extra.es5Descriptors||{};b.getProperties().sort(function(a,b){var c=a.isUnmapped?1:0,d=b.isUnmapped?1:0;return c-d}).forEach(function(d){var i,j=d.name,k=a[j],l=c[j];if(l){var m=l.get.bind(a);if(l.set){var n=l.set.bind(a),o=function(a){return 0===arguments.length?m():(n(a),void 0)};i=h.computed({read:function(){return b._koDummy(),m()},write:function(c){return a._$interceptor(d,c,o),b._koDummy.valueHasMutated(),a}})}else i=h.computed({read:m,write:function(){}})}else if(h.isObservable(k)){if(d.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+j);i=k}else{var k=e(a,d,k);i=d.isScalar?h.observable(k):h.observableArray(k)}if(d.isScalar)if(l)Object.defineProperty(a,j,{enumerable:!0,configurable:!0,writable:!0,value:i});
else{var p=i.extend({intercept:{instance:a,property:d}});a[j]=p}else k._koObj=i,i.subscribe(f,null,"beforeChange"),k.arrayChanged.subscribe(g),i.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.")},a[j]=i})},a.config.registerAdapter("modelLibrary",j)}),S.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery"});var Tb=v("ko");return Tb?S.config.initializeAdapterInstance("modelLibrary","ko"):S.config.initializeAdapterInstance("modelLibrary","backingStore"),this.window&&(this.window.breeze=S),S});
>>>>>>> 9fe7264a8ea74100b2ba57719bc9e8f615dc7393
